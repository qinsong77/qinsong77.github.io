import{_ as l,r as c,o as r,c as u,a as n,b as a,w as e,F as i,e as s,d as o}from"./app.a96f585b.js";var k="/assets/fiber_node.2375f242.png",d="/assets/howReactFiberWork.14b80839.png",b="/assets/react-lifeCircle-old.7b6af575.png",m="/assets/react-lifecircle1.7b51196f.png",h="/assets/react-lifecircle2.e78f6ef0.png",g="/assets/domVsReact.276feb9f.png",f="/assets/oneNodeDiff.cd47bf1a.png",y="/assets/react_all.88656121.png",w="/assets/model.55276fcf.png";const _={},x={href:"https://zh-hans.reactjs.org/",target:"_blank",rel:"noopener noreferrer"},v=s("react"),R={href:"https://react.iamkasong.com/",target:"_blank",rel:"noopener noreferrer"},C=s("React\u6280\u672F\u63ED\u79D8"),P={href:"https://juejin.cn/post/7010539227284766751",target:"_blank",rel:"noopener noreferrer"},S=s("React \u8FD0\u884C\u65F6\u4F18\u5316\u65B9\u6848\u7684\u6F14\u8FDB"),F={href:"https://mp.weixin.qq.com/s/ifLP36rFhYJsU2RCAi7OZQ",target:"_blank",rel:"noopener noreferrer"},j=s("React \u662F\u5982\u4F55\u5DE5\u4F5C\u7684"),M={href:"https://7kms.github.io/react-illustration-series/",target:"_blank",rel:"noopener noreferrer"},D=s("\u56FE\u89E3React"),I={href:"https://github.com/typescript-cheatsheets/react",target:"_blank",rel:"noopener noreferrer"},E=s("react+typescript"),O={href:"https://mp.weixin.qq.com/s?__biz=MzUxMzcxMzE5Ng==&mid=2247505750&idx=2&sn=a31164ddf69f49e3761d2a6d660cf316&chksm=f9526215ce25eb031cbb1f8e0137b3fb3e30f6305fb183f028ab12419699695173b51c44b49d&scene=132#wechat_redirect",target:"_blank",rel:"noopener noreferrer"},T=s("2021\u5E74React\u5B66\u4E60\u8DEF\u7EBF\u56FE"),z={href:"https://pomb.us/build-your-own-react/",target:"_blank",rel:"noopener noreferrer"},A=s("Build your own React"),N=s(" | "),L={href:"https://github.com/defpis/build-your-own-react",target:"_blank",rel:"noopener noreferrer"},q=s("Build your own React-\u4E2D\u6587"),U={href:"https://github.com/semlinker/reactjs-interview-questions",target:"_blank",rel:"noopener noreferrer"},W=s("react-\u9762\u8BD5\u9898"),B=n("hr",null,null,-1),J={class:"table-of-contents"},V=s("\u6982\u8FF0"),Y=s("React15\u67B6\u6784"),G=s("Reconciler"),H=s("Renderer\uFF08\u6E32\u67D3\u5668\uFF09"),X=s("React16\u67B6\u6784"),$=s("React16\u7684\u7EC4\u4EF6\u7C7B\u578B"),Q=s("\u51FD\u6570\u5F0F\u7EC4\u4EF6"),Z=s("JSX\u7B80\u4ECB"),K=s("Fiber"),nn=s("\u53CC\u7F13\u5B58Fiber\u6811"),sn=s("Fiber\u662F\u5982\u4F55\u5DE5\u4F5C\u7684"),an=s("\u751F\u547D\u5468\u671F"),pn=s("React16.3.0\u4E4B\u524D\u751F\u547D\u5468\u671F"),en=s("React16.3.0\u4E4B\u540E\u7684\u751F\u547D\u5468\u671F"),tn=s("\u53D7\u63A7\u4E0E\u975E\u53D7\u63A7\u7EC4\u4EF6"),on=s("note"),cn=s("setState"),ln=s("react\u5408\u6210\u4E8B\u4EF6"),rn=s("React.PureComponent\u4E0EReact.memo()"),un=s("React\u7EC4\u4EF6\u5230\u5E95\u4EC0\u4E48\u65F6\u5019render"),kn=s("\u9AD8\u9636\u7EC4\u4EF6"),dn=s("render props"),bn=s("\u771F\u5B9EDOM\u64CD\u4F5C\u548CVirtual Dom"),mn=s("Diff\u7B97\u6CD5"),hn=s("\u7B14\u8BB0"),gn=s("React\u61D2\u52A0\u8F7D"),fn=s("1.\u4EE3\u7801\u5206\u5272"),yn=s("2.React\u7684\u61D2\u52A0\u8F7D"),wn=s("3. import() \u539F\u7406"),_n=s("4. React.lazy \u539F\u7406"),xn=s("5. Suspense \u539F\u7406"),vn=s("React17/18\u65B0\u7279\u6027"),Rn=s("React17"),Cn=s("React 18"),Pn=s("React fast refresh"),Sn=s("re-render"),Fn=s("forwardRef"),jn=o('<h2 id="\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#\u6982\u8FF0" aria-hidden="true">#</a> \u6982\u8FF0</h2><p>React\u7528\u4E8E\u6784\u5EFA\u7528\u6237\u754C\u9762\u7684 JavaScript \u5E93</p><p>\u5355\u9879\u6570\u636E\u6D41\uFF1A \u628A\u7EC4\u4EF6\u76F8\u5F53\u4E8E\u4E00\u4E2A\u51FD\u6570\uFF0Cprops \u76F8\u5F53\u4E8E\u51FD\u6570\u7684\u4F20\u53C2\u3002\u5982\u679C\u7EC4\u4EF6\u5185\u90E8\u53EF\u4EE5\u6539\u53D8 props \u5C31\u76F8\u5F53\u4E8E\uFF0C\u5728\u51FD\u6570\u5185\u90E8\u6539\u53D8\u53C2\u6570\u3002\u90A3\u4E48\u8FD9\u4E2A\u51FD\u6570\u5C31\u4EA7\u751F\u4E86\u526F\u4F5C\u7528\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u51FD\u6570\u5C31\u4E0D\u662F\u4E00\u4E2A <code>pure function</code>\u3002\u8FD9\u4F1A\u4F7F\u51FD\u6570\u53D8\u7684\u4E0D\u53EF\u6D4B\u8BD5\uFF0C\u4E0D\u53EF\u6D4B\u8BD5\u4E5F\u5C31\u4E0D\u80FD\u9884\u6D4B\u6267\u884C\u7ED3\u679C\uFF0C\u4ECE\u800C\u964D\u4F4E\u4EE3\u7801\u53EF\u7EF4\u62A4\u6027\u3002</p><p>React\u91C7\u7528\u81EA\u4E0A\u800C\u4E0B\u5355\u5411\u6570\u636E\u6D41\u7684\u65B9\u5F0F\uFF0C\u7BA1\u7406\u81EA\u8EAB\u7684\u6570\u636E\u4E0E\u72B6\u6001\u3002\u5728\u5355\u5411\u6570\u636E\u6D41\u4E2D\uFF0C\u6570\u636E\u53EA\u80FD\u7531\u7236\u7EC4\u4EF6\u89E6\u53D1\uFF0C\u5411\u4E0B\u4F20\u9012\u5230\u5B50\u7EC4\u4EF6\u3002</p><p>\u53EF\u4EE5\u5728\u7236\u7EC4\u4EF6\u4E2D\u5B9A\u4E49state\uFF0C\u5E76\u901A\u8FC7props\u7684\u65B9\u5F0F\u4F20\u9012\u5230\u5B50\u7EC4\u4EF6\u3002\u5982\u679C\u5B50\u7EC4\u4EF6\u60F3\u8981\u4FEE\u6539\u7236\u7EC4\u4EF6\u4F20\u9012\u800C\u6765\u7684\u72B6\u6001\uFF0C\u5219<strong>\u53EA\u80FD\u7ED9\u7236\u7EC4\u4EF6\u53D1\u9001\u6D88\u606F\uFF0C\u7531\u7236\u7EC4\u4EF6\u6539\u53D8\uFF0C\u518D\u91CD\u65B0\u4F20\u9012\u7ED9\u5B50\u7EC4\u4EF6</strong>\u3002</p><p>\u5728React\u4E2D\uFF0C<strong>state\u4E0Eprops\u7684\u6539\u53D8\uFF0C\u90FD\u4F1A\u5F15\u53D1\u7EC4\u4EF6\u91CD\u65B0\u6E32\u67D3\u3002\u5982\u679C\u662F\u7236\u7EC4\u4EF6\u7684\u53D8\u5316\uFF0C\u5219\u7236\u7EC4\u4EF6\u4E0B\u6240\u6709\u5B50\u7EC4\u4EF6\u90FD\u4F1A\u91CD\u65B0\u6E32\u67D3</strong>\u3002</p><p>\u5728class\u7EC4\u4EF6\u4E2D\uFF0C\u7EC4\u4EF6\u91CD\u65B0\u6E32\u67D3\uFF0C\u662F\u6267\u884Crender\u65B9\u6CD5\u3002</p><p><strong>\u800C\u5728\u51FD\u6570\u5F0F\u7EC4\u4EF6\u4E2D\uFF0C\u662F\u6574\u4E2A\u51FD\u6570\u91CD\u65B0\u6267\u884C\u3002</strong></p><h2 id="react15\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#react15\u67B6\u6784" aria-hidden="true">#</a> React15\u67B6\u6784</h2><p>React15\u67B6\u6784\u53EF\u4EE5\u5206\u4E3A\u4E24\u5C42\uFF1A</p><ul><li>Reconciler\uFF08\u534F\u8C03\u5668\uFF09\u2014\u2014 \u8D1F\u8D23\u627E\u51FA\u53D8\u5316\u7684\u7EC4\u4EF6</li><li>Renderer\uFF08\u6E32\u67D3\u5668\uFF09\u2014\u2014 \u8D1F\u8D23\u5C06\u53D8\u5316\u7684\u7EC4\u4EF6\u6E32\u67D3\u5230\u9875\u9762\u4E0A</li></ul><h3 id="reconciler" tabindex="-1"><a class="header-anchor" href="#reconciler" aria-hidden="true">#</a> Reconciler</h3><p>\u5373\u4FBF React DOM \u548C React Native \u6E32\u67D3\u5668\u7684\u533A\u522B\u5F88\u5927\uFF0C\u4F46\u4E5F\u9700\u8981\u5171\u4EAB\u4E00\u4E9B\u903B\u8F91\u3002\u7279\u522B\u662F\u534F\u8C03\u7B97\u6CD5\u9700\u8981\u5C3D\u53EF\u80FD\u76F8\u4F3C\uFF0C\u8FD9\u6837\u53EF\u4EE5\u8BA9\u58F0\u660E\u5F0F\u6E32\u67D3\uFF0C\u81EA\u5B9A\u4E49\u7EC4\u4EF6\uFF0Cstate\uFF0C\u751F\u547D\u5468\u671F\u65B9\u6CD5\u548C refs \u7B49\u7279\u6027\uFF0C\u4FDD\u6301\u8DE8\u5E73\u53F0\u5DE5\u4F5C\u4E00\u81F4\u3002</p><p>\u5728React\u4E2D\u53EF\u4EE5\u901A\u8FC7<code>this.setState</code>\u3001<code>this.forceUpdate</code>\u3001<code>ReactDOM.render</code>\u7B49API\u89E6\u53D1\u66F4\u65B0\u3002</p><p>\u6BCF\u5F53\u6709\u66F4\u65B0\u53D1\u751F\u65F6\uFF0C<code>Reconciler</code>\u4F1A\u505A\u5982\u4E0B\u5DE5\u4F5C\uFF1A</p><ul><li>\u8C03\u7528\u51FD\u6570\u7EC4\u4EF6\u3001\u6216class\u7EC4\u4EF6\u7684render\u65B9\u6CD5\uFF0C\u5C06\u8FD4\u56DE\u7684JSX\u8F6C\u5316\u4E3A\u865A\u62DFDOM</li><li>\u5C06\u865A\u62DFDOM\u548C\u4E0A\u6B21\u66F4\u65B0\u65F6\u7684\u865A\u62DFDOM\u5BF9\u6BD4</li><li>\u901A\u8FC7\u5BF9\u6BD4\u627E\u51FA\u672C\u6B21\u66F4\u65B0\u4E2D\u53D8\u5316\u7684\u865A\u62DFDOM</li><li>\u901A\u77E5Renderer\u5C06\u53D8\u5316\u7684\u865A\u62DFDOM\u6E32\u67D3\u5230\u9875\u9762\u4E0A</li></ul><h3 id="renderer-\u6E32\u67D3\u5668" tabindex="-1"><a class="header-anchor" href="#renderer-\u6E32\u67D3\u5668" aria-hidden="true">#</a> Renderer\uFF08\u6E32\u67D3\u5668\uFF09</h3><p>\u7531\u4E8EReact\u652F\u6301\u8DE8\u5E73\u53F0\uFF0C\u6240\u4EE5\u4E0D\u540C\u5E73\u53F0\u6709\u4E0D\u540C\u7684<code>Renderer</code>\u3002\u6700\u719F\u6089\u7684\u662F\u8D1F\u8D23\u5728\u6D4F\u89C8\u5668\u73AF\u5883\u6E32\u67D3\u7684Renderer \u2014\u2014 ReactDOM</p><p>\u9664\u6B64\u4E4B\u5916\uFF0C\u8FD8\u6709\uFF1A</p><ul><li>ReactNative\u6E32\u67D3\u5668\uFF0C\u6E32\u67D3App\u539F\u751F\u7EC4\u4EF6</li><li>ReactTest\u6E32\u67D3\u5668\uFF0C\u6E32\u67D3\u51FA\u7EAFJs\u5BF9\u8C61\u7528\u4E8E\u6D4B\u8BD5</li><li>ReactArt\u6E32\u67D3\u5668\uFF0C\u6E32\u67D3\u5230Canvas, SVG \u6216 VML (IE8)</li></ul><p>\u5728\u6BCF\u6B21\u66F4\u65B0\u53D1\u751F\u65F6\uFF0CRenderer\u63A5\u5230<code>Reconciler</code>\u901A\u77E5\uFF0C\u5C06\u53D8\u5316\u7684\u7EC4\u4EF6\u6E32\u67D3\u5728\u5F53\u524D\u5BBF\u4E3B\u73AF\u5883\u3002</p><p>\u5728<code>Reconciler</code>\u4E2D\uFF0Cmount\u7684\u7EC4\u4EF6\u4F1A\u8C03\u7528<code>mountComponent</code>\uFF0Cupdate\u7684\u7EC4\u4EF6\u4F1A\u8C03\u7528<code>updateComponent</code>\u3002\u8FD9\u4E24\u4E2A\u65B9\u6CD5\u90FD\u4F1A\u9012\u5F52\u66F4\u65B0\u5B50\u7EC4\u4EF6\u3002</p><p>\u7531\u4E8E\u9012\u5F52\u6267\u884C\uFF0C\u6240\u4EE5\u66F4\u65B0\u4E00\u65E6\u5F00\u59CB\uFF0C<strong>\u4E2D\u9014\u5C31\u65E0\u6CD5\u4E2D\u65AD</strong>\u3002\u5F53\u5C42\u7EA7\u5F88\u6DF1\u65F6\uFF0C\u9012\u5F52\u66F4\u65B0\u65F6\u95F4\u8D85\u8FC7\u4E8616ms\uFF0C\u7528\u6237\u4EA4\u4E92\u5C31\u4F1A\u5361\u987F\u3002</p><h2 id="react16\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#react16\u67B6\u6784" aria-hidden="true">#</a> React16\u67B6\u6784</h2><p>React16\u67B6\u6784\u53EF\u4EE5\u5206\u4E3A\u4E09\u5C42\uFF1A</p><ul><li>Scheduler\uFF08\u8C03\u5EA6\u5668\uFF09\u2014\u2014 \u8C03\u5EA6\u4EFB\u52A1\u7684\u4F18\u5148\u7EA7\uFF0C\u9AD8\u4F18\u4EFB\u52A1\u4F18\u5148\u8FDB\u5165Reconciler</li><li>Reconciler\uFF08\u534F\u8C03\u5668\uFF09\u2014\u2014 \u8D1F\u8D23\u627E\u51FA\u53D8\u5316\u7684\u7EC4\u4EF6</li><li>Renderer\uFF08\u6E32\u67D3\u5668\uFF09\u2014\u2014 \u8D1F\u8D23\u5C06\u53D8\u5316\u7684\u7EC4\u4EF6\u6E32\u67D3\u5230\u9875\u9762\u4E0A</li></ul><p>Scheduler\u5B9E\u9645\u4E0A\u5C31\u662F<code>requestIdleCallback</code> \u7684polyfill\uFF0C\u4EE5\u6D4F\u89C8\u5668\u662F\u5426\u6709\u5269\u4F59\u65F6\u95F4\u4F5C\u4E3A\u4EFB\u52A1\u4E2D\u65AD\u7684\u6807\u51C6\uFF0C\u5B9E\u73B0\u4E86\u4E00\u79CD\u673A\u5236\uFF0C\u5F53\u6D4F\u89C8\u5668\u6709\u5269\u4F59\u65F6\u95F4\u65F6\u901A\u77E5<code>Reconciler</code>\u3002</p><p>\u6574\u4E2A<code>Scheduler</code>\u4E0E<code>Reconciler</code>\u7684\u5DE5\u4F5C\u90FD\u5728\u5185\u5B58\u4E2D\u8FDB\u884C\u3002<strong>\u53EA\u6709\u5F53\u6240\u6709\u7EC4\u4EF6\u90FD\u5B8C\u6210Reconciler\u7684\u5DE5\u4F5C</strong>\uFF0C\u624D\u4F1A\u7EDF\u4E00\u4EA4\u7ED9<code>Renderer</code>\u3002</p>',28),Mn={href:"http://www.ayqy.net/blog/dive-into-react-fiber/",target:"_blank",rel:"noopener noreferrer"},Dn=s("\u5B8C\u5168\u7406\u89E3React Fiber"),In=o(`<p>reconcile\u8FC7\u7A0B\u5206\u4E3A2\u4E2A\u9636\u6BB5\uFF08phase\uFF09\uFF1A</p><ol><li><strong>reconciliation</strong>\uFF08diff\u9636\u6BB5\uFF09, \uFF08\u53EF\u4E2D\u65AD\uFF09render/reconciliation \u901A\u8FC7\u6784\u9020workInProgress tree\u5F97\u51FAchange</li><li><strong>commit</strong>\uFF1A\uFF08\u4E0D\u53EF\u4E2D\u65AD\uFF09commit \u5E94\u7528\u8FD9\u4E9BDOM change</li></ol><ul><li>reconciliation\u9636\u6BB5\uFF1A\u5305\u542B\u7684\u4E3B\u8981\u5DE5\u4F5C\u662F\u5BF9<code>current tree</code> \u548C <code>new tree</code>(<code>workInProgress</code>) \u505Adiff\u8BA1\u7B97\uFF0C\u627E\u51FA\u53D8\u5316\u90E8\u5206\u3002\u8FDB\u884C\u904D\u5386\u3001\u5BF9\u6BD4\u7B49\u662F\u53EF\u4EE5\u4E2D\u65AD\uFF0C\u6B47\u4E00\u4F1A\u513F\u63A5\u7740\u518D\u6765\u3002</li><li>commit\u9636\u6BB5\uFF1A\u5BF9\u4E0A\u4E00\u9636\u6BB5\u83B7\u53D6\u5230\u7684\u53D8\u5316\u90E8\u5206\u5E94\u7528\u5230\u771F\u5B9E\u7684DOM\u6811\u4E2D\uFF0C\u662F\u4E00\u7CFB\u5217\u7684DOM\u64CD\u4F5C\u3002\u4E0D\u4EC5\u8981\u7EF4\u62A4\u66F4\u590D\u6742\u7684DOM\u72B6\u6001\uFF0C\u800C\u4E14\u4E2D\u65AD\u540E\u518D\u7EE7\u7EED\uFF0C\u4F1A\u5BF9\u7528\u6237\u4F53\u9A8C\u9020\u6210\u5F71\u54CD\u3002\u5728\u666E\u904D\u7684\u5E94\u7528\u573A\u666F\u4E0B\uFF0C\u6B64\u9636\u6BB5\u7684\u8017\u65F6\u6BD4diff\u8BA1\u7B97\u7B49\u8017\u65F6\u76F8\u5BF9\u77ED\u3002 \u6240\u4EE5\uFF0CFiber\u9009\u62E9\u5728reconciliation\u9636\u6BB5\u62C6\u5206</li></ul><p>\u5982\u4F55\u62C6\u5206\uFF1A</p><ul><li>\u7528\u6237\u8C03\u7528ReactDOM.render\u4F20\u5165\u7EC4\u4EF6\uFF0CReact\u521B\u5EFAElement\u6811;</li><li>\u5728\u7B2C\u4E00\u6B21\u6E32\u67D3\u65F6\uFF0C\u521B\u5EFAvdom\u6811\uFF0C\u7528\u6765\u7EF4\u62A4\u7EC4\u4EF6\u72B6\u6001\u548Cdom\u8282\u70B9\u7684\u4FE1\u606F\u3002</li><li>\u5F53\u540E\u7EED\u64CD\u4F5C\u5982render\u6216setState\u65F6\u9700\u8981\u66F4\u65B0\uFF0C\u901A\u8FC7diff\u7B97\u51FA\u53D8\u5316\u7684\u90E8\u5206\u3002</li><li>\u6839\u636E\u53D8\u5316\u7684\u90E8\u5206\u66F4\u65B0vdom\u6811\u3001\u8C03\u7528\u7EC4\u4EF6\u751F\u547D\u5468\u671F\u51FD\u6570\u7B49\uFF0C\u540C\u6B65\u5E94\u7528\u5230\u771F\u5B9E\u7684DOM\u8282\u70B9\u4E2D\u3002</li></ul><p><strong>reconciliation\u5177\u4F53\u8FC7\u7A0B\u5982\u4E0B\uFF1A</strong></p><p>\u4EE5<code>fiber tree</code>\u4E3A\u84DD\u672C\uFF0C\u628A\u6BCF\u4E2A<code>fiber</code>\u4F5C\u4E3A\u4E00\u4E2A\u5DE5\u4F5C\u5355\u5143\uFF0C\u81EA\u9876\u5411\u4E0B\u9010\u8282\u70B9\u6784\u9020<code>workInProgress tree</code>\uFF08\u6784\u5EFA\u4E2D\u7684\u65B0<code>fiber tree</code>\uFF09</p><p>\u4EE5\u7EC4\u4EF6\u8282\u70B9\u4E3A\u4F8B</p><ul><li><ol><li>\u5982\u679C\u5F53\u524D\u8282\u70B9\u4E0D\u9700\u8981\u66F4\u65B0\uFF0C\u76F4\u63A5\u628A\u5B50\u8282\u70B9clone\u8FC7\u6765\uFF0C\u8DF3\u52305\uFF1B\u8981\u66F4\u65B0\u7684\u8BDD\u6253\u4E2Atag</li></ol></li><li><ol start="2"><li>\u66F4\u65B0\u5F53\u524D\u8282\u70B9\u72B6\u6001\uFF08props, state, context\u7B49\uFF09</li></ol></li><li><ol start="3"><li>\u8C03\u7528<code>shouldComponentUpdate()</code>\uFF0Cfalse\u7684\u8BDD\uFF0C\u8DF3\u52305</li></ol></li><li><ol start="4"><li>\u8C03\u7528render()\u83B7\u5F97\u65B0\u7684\u5B50\u8282\u70B9\uFF0C\u5E76\u4E3A\u5B50\u8282\u70B9\u521B\u5EFAfiber\uFF08\u521B\u5EFA\u8FC7\u7A0B\u4F1A\u5C3D\u91CF\u590D\u7528\u73B0\u6709fiber\uFF0C\u5B50\u8282\u70B9\u589E\u5220\u4E5F\u53D1\u751F\u5728\u8FD9\u91CC\uFF09</li></ol></li><li><ol start="5"><li>\u5982\u679C\u6CA1\u6709\u4EA7\u751F<code>child fiber</code>\uFF0C\u8BE5\u5DE5\u4F5C\u5355\u5143\u7ED3\u675F\uFF0C\u628A<code>effect list</code>\u5F52\u5E76\u5230<code>return</code>\uFF0C\u5E76\u628A\u5F53\u524D\u8282\u70B9\u7684<code>sibling</code>\u4F5C\u4E3A\u4E0B\u4E00\u4E2A\u5DE5\u4F5C\u5355\u5143\uFF1B\u5426\u5219\u628Achild\u4F5C\u4E3A\u4E0B\u4E00\u4E2A\u5DE5\u4F5C\u5355\u5143</li></ol></li><li><ol start="6"><li>\u5982\u679C\u6CA1\u6709\u5269\u4F59\u53EF\u7528\u65F6\u95F4\u4E86\uFF0C\u7B49\u5230\u4E0B\u4E00\u6B21\u4E3B\u7EBF\u7A0B\u7A7A\u95F2\u65F6\u624D\u5F00\u59CB\u4E0B\u4E00\u4E2A\u5DE5\u4F5C\u5355\u5143\uFF1B\u5426\u5219\uFF0C\u7ACB\u5373\u5F00\u59CB\u505A</li></ol></li><li><ol start="7"><li>\u5982\u679C\u6CA1\u6709\u4E0B\u4E00\u4E2A\u5DE5\u4F5C\u5355\u5143\u4E86\uFF08\u56DE\u5230\u4E86workInProgress tree\u7684\u6839\u8282\u70B9\uFF09\uFF0C\u7B2C1\u9636\u6BB5\u7ED3\u675F\uFF0C\u8FDB\u5165pending Commit\u72B6\u6001</li></ol></li></ul><p>\u5B9E\u9645\u4E0A\u662F1-6\u7684<strong>\u5DE5\u4F5C\u5FAA\u73AF</strong>\uFF0C7\u662F\u51FA\u53E3\uFF0C\u5DE5\u4F5C\u5FAA\u73AF\u6BCF\u6B21\u53EA\u505A\u4E00\u4EF6\u4E8B\uFF0C\u505A\u5B8C\u770B\u8981\u4E0D\u8981\u5598\u53E3\u6C14\u3002\u5DE5\u4F5C\u5FAA\u73AF\u7ED3\u675F\u65F6\uFF0C<code>workInProgress tree</code>\u7684\u6839\u8282\u70B9\u8EAB\u4E0A\u7684effect list\u5C31\u662F\u6536\u96C6\u5230\u7684\u6240\u6709side effect\uFF08\u56E0\u4E3A\u6BCF\u505A\u5B8C\u4E00\u4E2A\u90FD\u5411\u4E0A\u5F52\u5E76\uFF09</p><p>\u6240\u4EE5\uFF0C\u6784\u5EFA<code>workInProgress tree</code>\u7684\u8FC7\u7A0B\u5C31\u662F<code>diff</code>\u7684\u8FC7\u7A0B\uFF0C\u901A\u8FC7<code>requestIdleCallback</code>\u6765\u8C03\u5EA6\u6267\u884C\u4E00\u7EC4\u4EFB\u52A1\uFF0C\u6BCF\u5B8C\u6210\u4E00\u4E2A\u4EFB\u52A1\u540E\u56DE\u6765\u770B\u770B\u6709\u6CA1\u6709\u63D2\u961F\u7684\uFF08\u66F4\u7D27\u6025\u7684\uFF09\uFF0C\u6BCF\u5B8C\u6210\u4E00\u7EC4\u4EFB\u52A1\uFF0C\u628A\u65F6\u95F4\u63A7\u5236\u6743\u4EA4\u8FD8\u7ED9\u4E3B\u7EBF\u7A0B\uFF0C\u76F4\u5230\u4E0B\u4E00\u6B21<code>requestIdleCallback</code>\u56DE\u8C03\u518D\u7EE7\u7EED\u6784\u5EFA<code>workInProgress tree</code>\u3002</p><p><strong>commit\u5177\u4F53\u8FC7\u7A0B\u5982\u4E0B\uFF1A</strong></p><ol><li>\u5904\u7406<code>effect list</code>\uFF08\u5305\u62EC3\u79CD\u5904\u7406\uFF1A\u66F4\u65B0DOM\u6811\u3001\u8C03\u7528\u7EC4\u4EF6\u751F\u547D\u5468\u671F\u51FD\u6570\u4EE5\u53CA\u66F4\u65B0ref\u7B49\u5185\u90E8\u72B6\u6001\uFF09</li><li>\u5904\u7406\u7ED3\u675F\uFF0C\u7B2C2\u9636\u6BB5\u7ED3\u675F\uFF0C\u6240\u6709\u66F4\u65B0\u90FDcommit\u5230DOM\u6811\u4E0A\u4E86</li></ol><p>\u6CE8\u610F\uFF0C\u771F\u7684\u662F<strong>\u4E00\u53E3\u6C14\u505A\u5B8C</strong>\uFF08\u540C\u6B65\u6267\u884C\uFF0C\u4E0D\u80FD\u558A\u505C\uFF09\u7684\uFF0C\u8FD9\u4E2A\u9636\u6BB5\u7684\u5B9E\u9645\u5DE5\u4F5C\u91CF\u662F\u6BD4\u8F83\u5927\u7684\uFF0C\u6240\u4EE5\u5C3D\u91CF\u4E0D\u8981\u5728\u540E3\u4E2A\u751F\u547D\u5468\u671F\u51FD\u6570\u91CC\u5E72\u91CD\u6D3B\u513F</p><p><strong>\u751F\u547D\u5468\u671Fhook</strong></p><p>\u751F\u547D\u5468\u671F\u51FD\u6570\u4E5F\u88AB\u5206\u4E3A2\u4E2A\u9636\u6BB5\u4E86\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// \u7B2C1\u9636\u6BB5 render/reconciliation
componentWillMount
componentWillReceiveProps
shouldComponentUpdate
componentWillUpdate

// \u7B2C2\u9636\u6BB5 commit
componentDidMount
componentDidUpdate
componentWillUnmount
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u7B2C1\u9636\u6BB5\u7684\u751F\u547D\u5468\u671F\u51FD\u6570\u53EF\u80FD\u4F1A\u88AB<strong>\u591A\u6B21\u8C03\u7528</strong>\uFF0C\u9ED8\u8BA4\u4EE5low\u4F18\u5148\u7EA7\uFF08\u540E\u9762\u4ECB\u7ECD\u76846\u79CD\u4F18\u5148\u7EA7\u4E4B\u4E00\uFF09\u6267\u884C\uFF0C\u88AB\u9AD8\u4F18\u5148\u7EA7\u4EFB\u52A1\u6253\u65AD\u7684\u8BDD\uFF0C\u7A0D\u540E\u91CD\u65B0\u6267\u884C</p><p><strong>fiber tree\u4E0EworkInProgress tree</strong></p>`,19),En=n("code",null,"\u53CC\u7F13\u51B2",-1),On=s("\u6280\u672F\uFF08double buffering\uFF09\uFF0C\u5C31\u50CF"),Tn={href:"http://www.ayqy.net/blog/redux%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/#articleHeader7",target:"_blank",rel:"noopener noreferrer"},zn=s("redux"),An=s("\u91CC\u7684"),Nn=n("code",null,"nextListeners",-1),Ln=s("\uFF0C\u4EE5"),qn=n("code",null,"fiber tree",-1),Un=s("\u4E3A\u4E3B\uFF0CworkInProgress tree\u4E3A\u8F85"),Wn=o(`<p>\u53CC\u7F13\u51B2\u5177\u4F53\u6307\u7684\u662FworkInProgress tree\u6784\u9020\u5B8C\u6BD5\uFF0C\u5F97\u5230\u7684\u5C31\u662F\u65B0\u7684fiber tree\uFF0C\u7136\u540E\u559C\u65B0\u538C\u65E7\uFF08\u628Acurrent\u6307\u9488\u6307\u5411workInProgress tree\uFF0C\u4E22\u6389\u65E7\u7684fiber tree\uFF09\u5C31\u597D\u4E86</p><p>\u8FD9\u6837\u505A\u7684\u597D\u5904\uFF1A</p><ul><li><p>\u80FD\u591F\u590D\u7528\u5185\u90E8\u5BF9\u8C61\uFF08fiber\uFF09</p></li><li><p>\u8282\u7701\u5185\u5B58\u5206\u914D\u3001GC\u7684\u65F6\u95F4\u5F00\u9500</p></li></ul><p>\u6BCF\u4E2Afiber\u4E0A\u90FD\u6709\u4E2Aalternate\u5C5E\u6027\uFF0C\u4E5F\u6307\u5411\u4E00\u4E2Afiber\uFF0C\u521B\u5EFAworkInProgress\u8282\u70B9\u65F6\u4F18\u5148\u53D6alternate\uFF0C\u6CA1\u6709\u7684\u8BDD\u5C31\u521B\u5EFA\u4E00\u4E2A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> workInProgress <span class="token operator">=</span> current<span class="token punctuation">.</span>alternate<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgress <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...\u8FD9\u91CC\u5F88\u6709\u610F\u601D</span>
  workInProgress<span class="token punctuation">.</span>alternate <span class="token operator">=</span> current<span class="token punctuation">;</span>
  current<span class="token punctuation">.</span>alternate <span class="token operator">=</span> workInProgress<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// We already have an alternate.</span>
  <span class="token comment">// Reset the effect tag.</span>
  workInProgress<span class="token punctuation">.</span>effectTag <span class="token operator">=</span> NoEffect<span class="token punctuation">;</span>

  <span class="token comment">// The effect list is no longer valid.</span>
  workInProgress<span class="token punctuation">.</span>nextEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  workInProgress<span class="token punctuation">.</span>firstEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  workInProgress<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>\u5982\u6CE8\u91CA\u6307\u51FA\u7684\uFF0Cfiber\u4E0EworkInProgress\u4E92\u76F8\u6301\u6709\u5F15\u7528\uFF0C\u201C\u559C\u65B0\u538C\u65E7\u201D\u4E4B\u540E\uFF0C\u65E7fiber\u5C31\u4F5C\u4E3A\u65B0fiber\u66F4\u65B0\u7684\u9884\u7559\u7A7A\u95F4\uFF0C\u8FBE\u5230\u590D\u7528fiber\u5B9E\u4F8B\u7684\u76EE\u7684</p><p><strong>\u4F18\u5148\u7EA7\u7B56\u7565</strong></p><p>\u6BCF\u4E2A\u5DE5\u4F5C\u5355\u5143\u8FD0\u884C\u65F6\u67096\u79CD\u4F18\u5148\u7EA7\uFF1A</p><ol><li>synchronous \u4E0E\u4E4B\u524D\u7684Stack reconciler\u64CD\u4F5C\u4E00\u6837\uFF0C\u540C\u6B65\u6267\u884C</li><li>task \u5728next tick\u4E4B\u524D\u6267\u884C</li><li>animation \u4E0B\u4E00\u5E27\u4E4B\u524D\u6267\u884C</li><li>high \u5728\u4E0D\u4E45\u7684\u5C06\u6765\u7ACB\u5373\u6267\u884C</li><li>low \u7A0D\u5FAE\u5EF6\u8FDF\uFF08100-200ms\uFF09\u6267\u884C\u4E5F\u6CA1\u5173\u7CFB</li><li>offscreen \u4E0B\u4E00\u6B21render\u65F6\u6216scroll\u65F6\u624D\u6267\u884C</li></ol><p><code>synchronous</code>\u9996\u5C4F\uFF08\u9996\u6B21\u6E32\u67D3\uFF09\u7528\uFF0C\u8981\u6C42\u5C3D\u91CF\u5FEB\uFF0C\u4E0D\u7BA1\u4F1A\u4E0D\u4F1A\u963B\u585EUI\u7EBF\u7A0B\u3002<code>animation</code>\u901A\u8FC7<code>requestAnimationFrame</code>\u6765\u8C03\u5EA6\uFF0C\u8FD9\u6837\u5728\u4E0B\u4E00\u5E27\u5C31\u80FD\u7ACB\u5373\u5F00\u59CB\u52A8\u753B\u8FC7\u7A0B\uFF1B\u540E3\u4E2A\u90FD\u662F\u7531<code>requestIdleCallback</code>\u56DE\u8C03\u6267\u884C\u7684\uFF1B<code>offscreen</code>\u6307\u7684\u662F\u5F53\u524D\u9690\u85CF\u7684\u3001\u5C4F\u5E55\u5916\u7684\uFF08\u770B\u4E0D\u89C1\u7684\uFF09\u5143\u7D20</p><p>\u9AD8\u4F18\u5148\u7EA7\u7684\u6BD4\u5982\u952E\u76D8\u8F93\u5165\uFF08\u5E0C\u671B\u7ACB\u5373\u5F97\u5230\u53CD\u9988\uFF09\uFF0C\u4F4E\u4F18\u5148\u7EA7\u7684\u6BD4\u5982\u7F51\u7EDC\u8BF7\u6C42\uFF0C\u8BA9\u8BC4\u8BBA\u663E\u793A\u51FA\u6765\u7B49\u7B49\u3002\u53E6\u5916\uFF0C<strong>\u7D27\u6025\u7684\u4E8B\u4EF6\u5141\u8BB8\u63D2\u961F</strong></p><p>\u8FD9\u6837\u7684\u4F18\u5148\u7EA7\u673A\u5236\u5B58\u57282\u4E2A\u95EE\u9898\uFF1A</p><ol><li><p>\u751F\u547D\u5468\u671F\u51FD\u6570\u600E\u4E48\u6267\u884C\uFF08\u53EF\u80FD\u88AB\u9891\u9891\u4E2D\u65AD\uFF09\uFF1A\u89E6\u53D1\u987A\u5E8F\u3001\u6B21\u6570\u6CA1\u6709\u4FDD\u8BC1\u4E86</p></li><li><p>starvation\uFF08\u4F4E\u4F18\u5148\u7EA7\u997F\u6B7B\uFF09\uFF1A\u5982\u679C\u9AD8\u4F18\u5148\u7EA7\u4EFB\u52A1\u5F88\u591A\uFF0C\u90A3\u4E48\u4F4E\u4F18\u5148\u7EA7\u4EFB\u52A1\u6839\u672C\u6CA1\u673A\u4F1A\u6267\u884C\uFF08\u5C31\u997F\u6B7B\u4E86\uFF09</p></li></ol>`,13),Bn={id:"react16\u7684\u7EC4\u4EF6\u7C7B\u578B",tabindex:"-1"},Jn=n("a",{class:"header-anchor",href:"#react16\u7684\u7EC4\u4EF6\u7C7B\u578B","aria-hidden":"true"},"#",-1),Vn=s(),Yn={href:"https://zhuanlan.zhihu.com/p/55000793",target:"_blank",rel:"noopener noreferrer"},Gn=s("React16\u7684\u7EC4\u4EF6\u7C7B\u578B"),Hn=o(`<h2 id="\u51FD\u6570\u5F0F\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u51FD\u6570\u5F0F\u7EC4\u4EF6" aria-hidden="true">#</a> \u51FD\u6570\u5F0F\u7EC4\u4EF6</h2><p>\u51FD\u6570\u5F0F\u7EC4\u4EF6\u4E0E\u666E\u901A\u7684\u51FD\u6570\u51E0\u4E4E\u5B8C\u5168\u4E00\u6837\u3002\u53EA\u4E0D\u8FC7\u51FD\u6570\u6267\u884C\u5B8C\u6BD5\u65F6\uFF0C\u8FD4\u56DE\u7684\u662F\u4E00\u4E2AJSX\u7ED3\u6784\u3002</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello world.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><strong>1. \u51FD\u6570\u5F0F\u7EC4\u4EF6\u63A5\u6536props\u4F5C\u4E3A\u81EA\u5DF1\u7684\u53C2\u6570</strong></li></ul><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>name<span class="token operator">:</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>age<span class="token operator">:</span> <span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Demo<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li><ol start="2"><li><strong>props\u7684\u6BCF\u6B21\u53D8\u52A8\uFF0C\u7EC4\u4EF6\u90FD\u4F1A\u91CD\u65B0\u6E32\u67D3\u4E00\u6B21\uFF0C\u51FD\u6570\u91CD\u65B0\u6267\u884C\u3002</strong></li></ol></li><li><ol start="3"><li><strong>\u6CA1\u6709this\u3002\u90A3\u4E48\u4E5F\u5C31\u610F\u5473\u7740\uFF0C\u4E4B\u524D\u5728class\u4E2D\u7531\u4E8Ethis\u5E26\u6765\u7684\u56F0\u6270\u5C31\u81EA\u7136\u6D88\u5931\u4E86\u3002</strong></li></ol></li></ul>`,6),Xn={href:"https://juejin.cn/post/6844903735412391944",target:"_blank",rel:"noopener noreferrer"},$n=s("React\u662F\u600E\u4E48\u5206\u8FA8class\u6216\u8005function \u7EC4\u4EF6\u7684"),Qn=s(":"),Zn=o(`<div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// \u7C7B\u7EC4\u4EF6</span>
<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u51FD\u6570\u5F0F\u7EC4\u4EF6</span>
<span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u8C03\u7528</span>
<span class="token comment">// Class or function \u2014 whatever.</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Greeting</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">// \u4F46\u5728react\u5185\u90E8</span>
<span class="token comment">// Inside React</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">Greeting</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;p&gt;Hello&lt;/p&gt;</span>
<span class="token comment">// Inside React</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Greeting {}</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;p&gt;Hello&lt;/p&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>\u51FD\u6570\u7EC4\u4EF6\u76F4\u63A5\u8FD0\u884C\uFF0C\u800C\u7C7B\u7EC4\u4EF6\u9700\u8981<code>new</code>\u5B9E\u4F8B\u5316</strong>\uFF0C \u6240\u4EE5\u51FD\u6570\u7EC4\u4EF6\u6CA1\u6709<code>this</code>\uFF0C\u5E94\u7528\u662F\u72EC\u7ACB\u8C03\u7528\u7684\uFF0C\u800C<code>new</code>\u4F1A\u5F3A\u5236\u7ED1\u5B9A<code>this</code></p><p>\u5B9E\u9645\u4E0AReact\u5BF9\u57FA\u7840\u7684\u7EC4\u4EF6\u4E5F\u5C31\u662F<code>React.Component</code><strong>\u6DFB\u52A0\u4E86\u4E00\u4E2A\u6807\u8BB0</strong>\uFF0C\u5E76\u901A\u8FC7\u8FD9\u4E2A\u6807\u8BB0\u6765\u533A\u5206\u4E00\u4E2A\u7EC4\u4EF6\u662F\u5426\u662F\u4E00\u4E2A\u7C7B\u7EC4\u4EF6\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Inside React</span>
<span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isReactComponent <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// We can check it like this</span>
<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Greeting</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isReactComponent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u2705 Yes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="jsx\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#jsx\u7B80\u4ECB" aria-hidden="true">#</a> JSX\u7B80\u4ECB</h2>`,5),Kn={href:"https://mp.weixin.qq.com/s?__biz=MzI3ODU4MzQ1MA==&mid=2247484766&idx=1&sn=a4f15894db4076c43a7859a5bc77542f&chksm=eb5584abdc220dbd222c5eeb239e0db1cff1385a89381da651476a7730f455f43c9c8d465478&mpshare=1&scene=23&srcid=0205epPsZMYOfNhALNtvAldy&sharer_sharetime=1612515049758&sharer_shareid=1958dfa2b35b63c7a7463d11712f39df#rd",target:"_blank",rel:"noopener noreferrer"},ns=s("React \u662F\u5982\u4F55\u521B\u5EFA vdom \u548C fiber tree"),ss=o(`<p>JSX\u5728\u7F16\u8BD1\u65F6\u4F1A\u88AB<code>Babel</code>\u7F16\u8BD1\u4E3A<code>React.createElement</code>\u65B9\u6CD5\u3002</p><p><code>React.createElement</code>\u6700\u7EC8\u4F1A\u8C03\u7528<code>ReactElement</code>\u65B9\u6CD5\u8FD4\u56DE\u4E00\u4E2A\u5305\u542B\u7EC4\u4EF6\u6570\u636E\u7684\u5BF9\u8C61\uFF0C\u8BE5\u5BF9\u8C61\u6709\u4E2A\u53C2\u6570<code>$$typeof: REACT_ELEMENT_TYPE</code>\u6807\u8BB0\u4E86\u8BE5\u5BF9\u8C61\u662F\u4E2A<code>React Element</code>\u3002</p><p><code>props.children</code>\u6253\u5370\u51FA\u6765\u662F\u4E2A<code>React.element</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> config<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> propName<span class="token punctuation">;</span>

  <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> ref <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> source <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>config <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5C06 config \u5904\u7406\u540E\u8D4B\u503C\u7ED9 props</span>
    <span class="token comment">// ...\u7701\u7565</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> childrenLength <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token comment">// \u5904\u7406 children\uFF0C\u4F1A\u88AB\u8D4B\u503C\u7ED9props.children</span>
  <span class="token comment">// ...\u7701\u7565</span>

  <span class="token comment">// \u5904\u7406 defaultProps</span>
  <span class="token comment">// ...\u7701\u7565</span>

  <span class="token keyword">return</span> <span class="token function">ReactElement</span><span class="token punctuation">(</span>
    type<span class="token punctuation">,</span>
    key<span class="token punctuation">,</span>
    ref<span class="token punctuation">,</span>
    self<span class="token punctuation">,</span>
    source<span class="token punctuation">,</span>
    ReactCurrentOwner<span class="token punctuation">.</span>current<span class="token punctuation">,</span>
    props<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">ReactElement</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> key<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> self<span class="token punctuation">,</span> source<span class="token punctuation">,</span> owner<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6807\u8BB0\u8FD9\u662F\u4E2A React Element</span>
    $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token constant">REACT_ELEMENT_TYPE</span><span class="token punctuation">,</span> <span class="token comment">// \u6307\u5411 Symbol(React.element)\uFF0C\u4E5F\u627F\u62C5\u4E86\u5B89\u5168\u65B9\u9762\u7684\u529F\u80FD\u3002</span>

    <span class="token literal-property property">type</span><span class="token operator">:</span> type<span class="token punctuation">,</span> <span class="token comment">// \u8FD9\u4E2A\u5143\u7D20\u662F\u4E00\u4E2A\u7EAF html \u6807\u7B7E\u5143\u7D20\uFF0C\u4F8B\u5982 div \uFF0C\u90A3\u4E48 type \u5C06\u4F1A\u662F\u5B57\u7B26\u4E32 div, \u5982\u679C\u662F\u4E00\u4E2A\u51FD\u6570\u7EC4\u4EF6\u6216\u8005ClassComponent\uFF0C\u5219\u662F\u6307\u5411\u81EA\u8EAB\uFF0C</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span> key<span class="token punctuation">,</span> <span class="token comment">// key \u5728\u6570\u7EC4\u7684\u5904\u7406\u548C diff \u8FC7\u7A0B\u4E2D\u6709\u91CD\u8981\u4F5C\u7528</span>
    <span class="token literal-property property">ref</span><span class="token operator">:</span> ref<span class="token punctuation">,</span> <span class="token comment">// \u5F15\u7528\u6807\u8BC6</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> props<span class="token punctuation">,</span> <span class="token comment">// \u5305\u542Bid \u3001 className \u3001 style \u3001 children \u3001\u70B9\u51FB\u4E8B\u4EF6\u7B49\u7B49</span>
    <span class="token literal-property property">_owner</span><span class="token operator">:</span> owner<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>React\u63D0\u4F9B\u4E86\u9A8C\u8BC1\u5408\u6CD5React Element\u7684\u5168\u5C40API<code>React.isValidElement</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isValidElement</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token keyword">typeof</span> object <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">&amp;&amp;</span>
    object <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
    object<span class="token punctuation">.</span>$$<span class="token keyword">typeof</span> <span class="token operator">===</span> <span class="token constant">REACT_ELEMENT_TYPE</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C<code>$$typeof === REACT_ELEMENT_TYPE</code>\u7684\u975Enull\u5BF9\u8C61\u5C31\u662F\u4E00\u4E2A\u5408\u6CD5\u7684<code>React Element</code>\u3002\u6362\u8A00\u4E4B\uFF0C\u5728React\u4E2D\uFF0C\u6240\u6709JSX\u5728\u8FD0\u884C\u65F6\u7684\u8FD4\u56DE\u7ED3\u679C\uFF08\u5373<code>React.createElement()</code>\u7684\u8FD4\u56DE\u503C\uFF09\u90FD\u662F<code>React Element</code>\u3002</p><h2 id="fiber" tabindex="-1"><a class="header-anchor" href="#fiber" aria-hidden="true">#</a> Fiber</h2><p>Fiber\u662F\u94FE\u8868\u7ED3\u6784</p><ul><li>child \u6307\u5411\u5F53\u524D\u8282\u70B9\u7684\u7B2C\u4E00\u4E2A\u5B50\u5143\u7D20</li><li>return \u6307\u5411\u5F53\u524D\u8282\u70B9\u7684\u7236\u5143\u7D20</li><li>sibling \u6307\u5411\u540C\u7EA7\u7684\u4E0B\u4E00\u4E2A\u5144\u5F1F\u8282\u70B9</li></ul><p>\u5982\u679C\u662F React16 \u4E4B\u524D\u7684\u6811\u72B6\u7ED3\u6784\uFF0C\u5C31\u9700\u8981\u901A\u8FC7 <code>DFS</code> \u6DF1\u5EA6\u904D\u5386\u6765\u67E5\u627E\u6BCF\u4E00\u4E2A\u8282\u70B9\u3002\u800C\u73B0\u5728\u53EA\u9700\u8981\u5C06\u6307\u9488\u6309\u7167 <code>child \u2192 sibling \u2192 return</code> \u7684\u4F18\u5148\u7EA7\u79FB\u52A8\uFF0C\u5C31\u53EF\u4EE5\u5904\u7406\u6240\u6709\u7684\u8282\u70B9\u3002</p><p><img src="`+k+`" alt=""></p><p>\u8FD9\u6837\u8BBE\u8BA1\u8FD8\u6709\u4E00\u4E2A\u597D\u5904\u5C31\u662F\u5728 React \u5DE5\u4F5C\u7684\u65F6\u5019\u53EA\u9700\u8981\u4F7F\u7528\u4E00\u4E2A\u5168\u5C40\u53D8\u91CF\u4F5C\u4E3A\u6307\u9488\u5728\u94FE\u8868\u4E2D\u4E0D\u65AD\u79FB\u52A8\uFF0C\u5982\u679C\u51FA\u73B0\u7528\u6237\u8F93\u5165\u6216\u5176\u4ED6\u4F18\u5148\u7EA7\u66F4\u9AD8\u7684\u4EFB\u52A1\u5C31\u53EF\u4EE5 <code>\u6682\u505C</code> \u5F53\u524D\u5DE5\u4F5C\uFF0C\u5176\u4ED6\u4EFB\u52A1\u7ED3\u675F\u540E\u53EA\u9700\u8981\u6839\u636E\u6307\u9488\u7684\u4F4D\u7F6E\u7EE7\u7EED\u5411\u4E0B\u79FB\u52A8\u5C31\u53EF\u4EE5\u7EE7\u7EED\u4E4B\u524D\u7684\u5DE5\u4F5C\u3002\u6307\u9488\u79FB\u52A8\u7684\u89C4\u5F8B\u53EF\u4EE5\u5F52\u7EB3\u4E3A <strong>\u81EA\u9876\u5411\u4E0B\uFF0C\u4ECE\u5DE6\u5230\u53F3</strong> \u3002</p><p>fiber\u53EF\u4EE5\u5212\u5206\u4E3A3\u5C42\u542B\u4E49\u5206\u7C7B\uFF1A</p><ol><li>\u4F5C\u4E3AFiber\u6811\u7ED3\u6784\u7684\uFF0C\u94FE\u8868\u7ED3\u6784\u76843\u4E2A\u6307\u9488</li><li>\u4F5C\u4E3A\u4E00\u79CD\u9759\u6001\u7684\u6570\u636E\u7ED3\u6784\uFF0C\u4FDD\u5B58\u4E86\u7EC4\u4EF6\u76F8\u5173\u7684\u4FE1\u606F</li><li>\u4F5C\u4E3A\u52A8\u6001\u7684\u5DE5\u4F5C\u5355\u5143\u7684\u5C5E\u6027</li></ol><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">FiberNode</span><span class="token punctuation">(</span>
  tag<span class="token operator">:</span> WorkTag<span class="token punctuation">,</span>
  pendingProps<span class="token operator">:</span> mixed<span class="token punctuation">,</span>
  key<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> TypeOfMode<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u4F5C\u4E3A\u9759\u6001\u6570\u636E\u7ED3\u6784\u7684\u5C5E\u6027</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">=</span> tag<span class="token punctuation">;</span> <span class="token comment">//Fiber\u5BF9\u5E94\u7EC4\u4EF6\u7684\u7C7B\u578B Function/Class/Host...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span> <span class="token comment">// key\u5C5E\u6027</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>elementType <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// \u5927\u90E8\u5206\u60C5\u51B5\u540Ctype\uFF0C\u67D0\u4E9B\u60C5\u51B5\u4E0D\u540C\uFF0C\u6BD4\u5982FunctionComponent\u4F7F\u7528React.memo\u5305\u88F9</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// \u5BF9\u4E8E FunctionComponent\uFF0C\u6307\u51FD\u6570\u672C\u8EAB\uFF0C\u5BF9\u4E8EClassComponent\uFF0C\u6307class\uFF0C\u5BF9\u4E8EHostComponent\uFF0C\u6307DOM\u8282\u70B9tagName</span>
  <span class="token comment">// stateNode \u4EE3\u8868\u8FD9\u4E2A fiber \u8282\u70B9\u5BF9\u5E94\u7684\u771F\u5B9E\u72B6\u6001</span>
  <span class="token comment">// \u5BF9\u4E8E\u539F\u751F\u7EC4\u4EF6\uFF0C\u8FD9\u4E2A\u503C\u6307\u5411\u4E00\u4E2A dom \u8282\u70B9\uFF08\u867D\u7136\u5DF2\u7ECF\u88AB\u521B\u5EFA\u4E86\uFF0C\u4F46\u4E0D\u4EE3\u8868\u5C31\u88AB\u63D2\u5165\u4E86 document \uFF09</span>
  <span class="token comment">// \u5BF9\u4E8E\u7C7B\u7EC4\u4EF6\uFF0C\u8FD9\u4E2A\u503C\u6307\u5411\u5BF9\u5E94\u7684\u7C7B\u5B9E\u4F8B</span>
  <span class="token comment">// \u5BF9\u4E8E\u51FD\u6570\u7EC4\u4EF6\uFF0C\u8FD9\u4E2A\u503C\u6307\u5411 Null</span>
  <span class="token comment">// \u5BF9\u4E8E RootFiber\uFF0C\u8FD9\u4E2A\u503C\u6307\u5411 FiberRoot</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>stateNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// Fiber\u5BF9\u5E94\u7684\u771F\u5B9EDOM\u8282\u70B9</span>

  <span class="token comment">// \u7528\u4E8E\u8FDE\u63A5\u5176\u4ED6Fiber\u8282\u70B9\u5F62\u6210Fiber\u6811</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>return <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// \u6307\u5411\u7236\u7EA7Fiber\u8282\u70B9</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// \u6307\u5411\u5B50Fiber\u8282\u70B9</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sibling <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// \u6307\u5411\u53F3\u8FB9\u7B2C\u4E00\u4E2A\u5144\u5F1FFiber\u8282\u70B9</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>ref <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">// \u4F5C\u4E3A\u52A8\u6001\u7684\u5DE5\u4F5C\u5355\u5143\u7684\u5C5E\u6027</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pendingProps <span class="token operator">=</span> pendingProps<span class="token punctuation">;</span> <span class="token comment">// memorizeState \u548C memorizeProps \u4EE3\u8868\u5728\u4E0A\u6B21\u6E32\u67D3\u4E2D\u7EC4\u4EF6\u7684 props \u548C state \u3002\u5982\u679C\u6210\u529F\u66F4\u65B0\uFF0C\u90A3\u4E48\u65B0\u7684 pendingProps \u548C newState \u5C06\u4F1A\u66FF\u4EE3\u8FD9\u4E24\u4E2A\u53D8\u91CF\u7684\u503C</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>memoizedProps <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">=</span> mode<span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>effectTag <span class="token operator">=</span> NoEffect<span class="token punctuation">;</span> <span class="token comment">// \u4EE3\u8868\u8FD9\u4E2A fiber \u5728\u4E0B\u4E00\u6B21\u6E32\u67D3\u4E2D\u5C06\u4F1A\u88AB\u5982\u4F55\u5904\u7406\u3002\u4F8B\u5982\u53EA\u9700\u8981\u63D2\u5165\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u503C\u4E2D\u4F1A\u5305\u542B Placement \uFF0C\u5982\u679C\u9700\u8981\u88AB\u5220\u9664\uFF0C\u90A3\u4E48\u5C06\u4F1A\u5305\u542B Deletion \u3002</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>nextEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>firstEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// firstEffect \u548C lastEffect \u7684\u7C7B\u578B\u90FD\u548C fiber \u4E00\u6837\uFF0C\u540C\u6837\u662F\u94FE\u8868\u7ED3\u6784\uFF0C\u901A\u8FC7 nextEffect \u6765\u8FDE\u63A5\u3002\u4EE3\u8868\u7740\u5373\u5C06\u66F4\u65B0\u7684 fiber \u72B6\u6001</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">// \u8C03\u5EA6\u4F18\u5148\u7EA7\u76F8\u5173</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>lanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>childLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>

  <span class="token comment">// \u6307\u5411\u8BE5fiber\u5728\u53E6\u4E00\u6B21\u66F4\u65B0\u65F6\u5BF9\u5E94\u7684fiber</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>alternate <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="\u53CC\u7F13\u5B58fiber\u6811" tabindex="-1"><a class="header-anchor" href="#\u53CC\u7F13\u5B58fiber\u6811" aria-hidden="true">#</a> \u53CC\u7F13\u5B58Fiber\u6811</h3><p>\u5728React\u4E2D\u6700\u591A\u4F1A\u540C\u65F6\u5B58\u5728\u4E24\u68F5<code>Fiber</code>\u6811\u3002\u5F53\u524D\u5C4F\u5E55\u4E0A\u663E\u793A\u5185\u5BB9\u5BF9\u5E94\u7684Fiber\u6811\u79F0\u4E3A<code>current Fiber</code>\u6811\uFF0C\u6B63\u5728\u5185\u5B58\u4E2D\u6784\u5EFA\u7684Fiber\u6811\u79F0\u4E3A<code>workInProgress Fiber</code>\u6811\u3002</p><p><code>current Fiber</code>\u6811\u4E2D\u7684Fiber\u8282\u70B9\u88AB\u79F0\u4E3Acurrent fiber\uFF0CworkInProgress Fiber\u6811\u4E2D\u7684Fiber\u8282\u70B9\u88AB\u79F0\u4E3AworkInProgress fiber\uFF0C\u4ED6\u4EEC\u901A\u8FC7<code>alternate</code>\u5C5E\u6027\u8FDE\u63A5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>currentFiber<span class="token punctuation">.</span>alternate <span class="token operator">===</span> workInProgressFiber<span class="token punctuation">;</span>
workInProgressFiber<span class="token punctuation">.</span>alternate <span class="token operator">===</span> currentFiber<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>React\u5E94\u7528\u7684\u6839\u8282\u70B9\u901A\u8FC7current\u6307\u9488\u5728\u4E0D\u540CFiber\u6811\u7684rootFiber\u95F4\u5207\u6362\u6765\u5B9E\u73B0Fiber\u6811\u7684\u5207\u6362\u3002</p><p>\u5F53workInProgress Fiber\u6811\u6784\u5EFA\u5B8C\u6210\u4EA4\u7ED9Renderer\u6E32\u67D3\u5728\u9875\u9762\u4E0A\u540E\uFF0C\u5E94\u7528\u6839\u8282\u70B9\u7684current\u6307\u9488\u6307\u5411workInProgress Fiber\u6811\uFF0C\u6B64\u65F6workInProgress Fiber\u6811\u5C31\u53D8\u4E3Acurrent Fiber\u6811\u3002</p><p>\u6BCF\u6B21\u72B6\u6001\u66F4\u65B0\u90FD\u4F1A\u4EA7\u751F\u65B0\u7684workInProgress Fiber\u6811\uFF0C\u901A\u8FC7current\u4E0EworkInProgress\u7684\u66FF\u6362\uFF0C\u5B8C\u6210DOM\u66F4\u65B0\u3002</p><p>\u9996\u6B21\u6267\u884CReactDOM.render\u4F1A\u521B\u5EFAfiberRootNode\uFF08\u6E90\u7801\u4E2D\u53EBfiberRoot\uFF09\u548C<code>rootFiber</code>\u3002\u5176\u4E2D<code>fiberRootNode</code>\u662F\u6574\u4E2A\u5E94\u7528\u7684\u6839\u8282\u70B9\uFF0C<code>rootFiber</code>\u662F<code>&lt;App/&gt;</code>\u6240\u5728\u7EC4\u4EF6\u6811\u7684\u6839\u8282\u70B9\u3002</p><h3 id="fiber\u662F\u5982\u4F55\u5DE5\u4F5C\u7684" tabindex="-1"><a class="header-anchor" href="#fiber\u662F\u5982\u4F55\u5DE5\u4F5C\u7684" aria-hidden="true">#</a> Fiber\u662F\u5982\u4F55\u5DE5\u4F5C\u7684</h3><ol><li><p>ReactDOM.render() \u548C setState \u7684\u65F6\u5019\u5F00\u59CB\u521B\u5EFA\u66F4\u65B0\u3002</p></li><li><p>\u5C06\u521B\u5EFA\u7684\u66F4\u65B0\u52A0\u5165\u4EFB\u52A1\u961F\u5217\uFF0C\u7B49\u5F85\u8C03\u5EA6\u3002</p></li><li><p>\u5728 requestIdleCallback \u7A7A\u95F2\u65F6\u6267\u884C\u4EFB\u52A1\u3002</p></li><li><p>\u4ECE\u6839\u8282\u70B9\u5F00\u59CB\u904D\u5386 Fiber Node\uFF0C\u5E76\u4E14\u6784\u5EFA WokeInProgress Tree\u3002</p></li><li><p>\u751F\u6210 effectList\u3002</p></li><li><p>\u6839\u636E EffectList \u66F4\u65B0 DOM\u3002</p></li></ol><p><img src="`+d+'" alt=""></p>',27),as={id:"\u751F\u547D\u5468\u671F",tabindex:"-1"},ps=n("a",{class:"header-anchor",href:"#\u751F\u547D\u5468\u671F","aria-hidden":"true"},"#",-1),es=s(),ts={href:"https://zh-hans.reactjs.org/docs/react-component.html",target:"_blank",rel:"noopener noreferrer"},os=s("\u751F\u547D\u5468\u671F"),cs=n("h3",{id:"react16-3-0\u4E4B\u524D\u751F\u547D\u5468\u671F",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#react16-3-0\u4E4B\u524D\u751F\u547D\u5468\u671F","aria-hidden":"true"},"#"),s(" React16.3.0\u4E4B\u524D\u751F\u547D\u5468\u671F")],-1),ls={href:"https://juejin.cn/post/6844904021233238024",target:"_blank",rel:"noopener noreferrer"},rs=s("\u6587\u7AE0"),us=o('<p><img src="'+b+'" alt=""></p><h4 id="\u521B\u5EFA\u671F" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u671F" aria-hidden="true">#</a> \u521B\u5EFA\u671F:</h4><ul><li>constructor(props, context)</li><li>componentWillMount()</li><li>render()</li><li>componentDidMount()</li></ul><h4 id="\u8FD0\u884C\u65F6" tabindex="-1"><a class="header-anchor" href="#\u8FD0\u884C\u65F6" aria-hidden="true">#</a> \u8FD0\u884C\u65F6:</h4><h4 id="props\u53D1\u751F\u53D8\u5316\u65F6" tabindex="-1"><a class="header-anchor" href="#props\u53D1\u751F\u53D8\u5316\u65F6" aria-hidden="true">#</a> props\u53D1\u751F\u53D8\u5316\u65F6</h4><ul><li>componentWillReceiveProps(nextProps, nextContext)</li><li>shouldComponentUpdate(nextProps, nextState, nextContext)</li><li>componentWillUpdate(nextProps, nextState, nextContext)</li><li>render</li><li>componentDidUpdate(prevProps, prevState, snapshot)</li></ul><h4 id="state\u53D1\u751F\u53D8\u5316\u65F6" tabindex="-1"><a class="header-anchor" href="#state\u53D1\u751F\u53D8\u5316\u65F6" aria-hidden="true">#</a> state\u53D1\u751F\u53D8\u5316\u65F6</h4><ul><li>shouldComponentUpdate(nextProps, nextState, nextContext)</li><li>componentWillUpdate(nextProps, nextState, nextContext)</li><li>render</li><li>componentDidUpdate(prevProps, prevState, snapshot)</li></ul><h4 id="\u5378\u8F7D\u65F6" tabindex="-1"><a class="header-anchor" href="#\u5378\u8F7D\u65F6" aria-hidden="true">#</a> \u5378\u8F7D\u65F6</h4><ul><li>componentWillUnmount()</li></ul><h3 id="react16-3-0\u4E4B\u540E\u7684\u751F\u547D\u5468\u671F" tabindex="-1"><a class="header-anchor" href="#react16-3-0\u4E4B\u540E\u7684\u751F\u547D\u5468\u671F" aria-hidden="true">#</a> React16.3.0\u4E4B\u540E\u7684\u751F\u547D\u5468\u671F</h3><h4 id="\u521B\u5EFA\u671F-1" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u671F-1" aria-hidden="true">#</a> \u521B\u5EFA\u671F:</h4><ul><li>constructor(props, context)</li><li>static getDerivedStateFromProps(props, status)</li><li>render()</li><li>componentDidMount()</li></ul><p>\u6216\u8005\u5982\u4E0B\u751F\u547D\u5468\u671F:</p><ul><li>constructor(props, context)</li><li>componentWillMount() / UNSAFE_componentWillMount()</li><li>render()</li><li>componentDidMount() \u6CE8\u610F: <code>getDerivedStateFromProps</code>/<code>getSnapshotBeforeUpdate</code> \u548C <code>componentWillMount</code>/<code>componentWillReceiveProps</code>/<code>componentWillUpdate</code> \u5982\u679C\u540C\u65F6\u5B58\u5728\uFF0CReact\u4F1A\u5728\u63A7\u5236\u53F0\u7ED9\u51FA\u8B66\u544A\u4FE1\u606F\uFF0C\u4E14\u4EC5\u6267\u884C getDerivedStateFromProps/getSnapshotBeforeUpdate \u3010React@16.7.0\u3011</li></ul><h4 id="\u8FD0\u884C\u65F6-1" tabindex="-1"><a class="header-anchor" href="#\u8FD0\u884C\u65F6-1" aria-hidden="true">#</a> \u8FD0\u884C\u65F6:</h4><h4 id="props\u53D1\u751F\u53D8\u5316\u65F6-1" tabindex="-1"><a class="header-anchor" href="#props\u53D1\u751F\u53D8\u5316\u65F6-1" aria-hidden="true">#</a> props\u53D1\u751F\u53D8\u5316\u65F6</h4><ul><li>static getDerivedStateFromProps(props, status)</li><li>shouldComponentUpdate(nextProps, nextState, nextContext)</li><li>render</li><li>getSnapshotBeforeUpdate(prevProps, prevState)</li><li>componentDidUpdate(prevProps, prevState, snapshot)</li></ul><p>\u6216\u8005\u5982\u4E0B\u751F\u547D\u5468\u671F:</p><ul><li>componentWillReceiveProps(nextProps, nextContext)/UNSAFE_componentWillReceiveProps</li><li>shouldComponentUpdate(nextProps, nextState, nextContext)</li><li>componentWillUpdate(nextProps, nextState, nextContext)</li><li>render</li><li>componentDidUpdate(prevProps, prevState, snapshot)</li></ul><h4 id="state\u53D1\u751F\u53D8\u5316\u65F6-1" tabindex="-1"><a class="header-anchor" href="#state\u53D1\u751F\u53D8\u5316\u65F6-1" aria-hidden="true">#</a> state\u53D1\u751F\u53D8\u5316\u65F6</h4><ul><li><p>static getDerivedStateFromProps(props, status)</p></li><li><p>shouldComponentUpdate(nextProps, nextState, nextContext)</p></li><li><p>render</p></li><li><p>getSnapshotBeforeUpdate(prevProps, prevState)</p></li><li><p>componentDidUpdate(prevProps, prevState, snapshot) \u6216\u8005\u5982\u4E0B\u751F\u547D\u5468\u671F:</p></li><li><p>shouldComponentUpdate(nextProps, nextState, nextContext)</p></li><li><p>componentWillUpdate(nextProps, nextState, nextContext)/UNSAFE_componentWillUpdate</p></li><li><p>render</p></li><li><p>componentDidUpdate(prevProps, prevState, snapshot)</p></li></ul><h4 id="\u9500\u6BC1\u65F6" tabindex="-1"><a class="header-anchor" href="#\u9500\u6BC1\u65F6" aria-hidden="true">#</a> \u9500\u6BC1\u65F6</h4><ul><li>componentWillUnmount()</li></ul><p>\u7531\u4E8E <code>reconciliation</code> \u9636\u6BB5\u662F\u53EF\u4E2D\u65AD\u7684\uFF0C\u4E00\u65E6\u4E2D\u65AD\u4E4B\u540E\u6062\u590D\u7684\u65F6\u5019\u53C8\u4F1A\u91CD\u65B0\u6267\u884C\uFF0C\u6240\u4EE5\u5F88\u53EF\u80FD <code>reconciliation</code> \u9636\u6BB5\u7684\u751F\u547D\u5468\u671F\u65B9\u6CD5\u4F1A\u88AB\u591A\u6B21\u8C03\u7528\uFF0C\u6240\u4EE5\u5728 <code>reconciliation</code> \u9636\u6BB5\u7684\u751F\u547D\u5468\u671F\u7684\u65B9\u6CD5\u662F\u4E0D\u7A33\u5B9A\u7684\uFF0C \u6211\u60F3\u8FD9\u4E5F\u662F React \u4E3A\u4EC0\u4E48\u8981\u5E9F\u5F03 <code>componentWillMount</code> \u548C <code>componentWillReceiveProps</code>\u65B9\u6CD5\u800C\u6539\u4E3A\u9759\u6001\u65B9\u6CD5 <code>getDerivedStateFromProps</code>\u7684\u539F\u56E0\u5427\u3002</p>',25),is={href:"https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/",target:"_blank",rel:"noopener noreferrer"},ks=s("\u793A\u610F\u56FE"),ds=o('<p>\u65B0\u7684\u751F\u547D\u5468\u671F\u56FE\u793A:</p><p><img src="'+m+'" alt=""></p><p><img src="'+h+`" alt=""></p><h2 id="\u53D7\u63A7\u4E0E\u975E\u53D7\u63A7\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u53D7\u63A7\u4E0E\u975E\u53D7\u63A7\u7EC4\u4EF6" aria-hidden="true">#</a> \u53D7\u63A7\u4E0E\u975E\u53D7\u63A7\u7EC4\u4EF6</h2><p>\u53D7\u63A7\u7EC4\u4EF6\uFF1A\u5728 HTML \u4E2D\uFF0C\u8868\u5355\u5143\u7D20\uFF08\u5982<code>&lt;input&gt;\u3001 &lt;textarea&gt;\u3001&lt;select&gt;</code>)\u901A\u5E38\u81EA\u5DF1\u7EF4\u62A4 state\uFF0C\u5E76\u6839\u636E\u7528\u6237\u8F93\u5165\u8FDB\u884C\u66F4\u65B0\u3002 \u5373\u5982Input\u7684value\u7ED1\u5B9A\u4E86state\uFF0C\u800ConChange\u65F6\u4F7F\u7528<code>setState</code>\u66F4\u65B0\u3002</p><p>\u4E5F\u53EF\u4EE5\u8BF4\u662F\u7EC4\u4EF6\u5916\u90E8\u80FD\u63A7\u5236\u7EC4\u4EF6\u5185\u90E8\u7684\u72B6\u6001\uFF0C\u5219\u8868\u793A\u8BE5\u7EC4\u4EF6\u4E3A\u53D7\u63A7\u7EC4\u4EF6\u3002</p><p>\u5916\u90E8\u60F3\u8981\u63A7\u5236\u5185\u90E8\u7684\u7EC4\u4EF6\uFF0C\u5C31\u5FC5\u987B\u8981\u5F80\u7EC4\u4EF6\u5185\u90E8\u4F20\u5165props\u3002\u800C\u901A\u5E38\u60C5\u51B5\u4E0B\uFF0C\u53D7\u63A7\u7EC4\u4EF6\u5185\u90E8\u53C8\u81EA\u5DF1\u7EF4\u62A4\u81EA\u5DF1\u7684\u72B6\u6001\u3002\u4F8B\u5982input\u7EC4\u4EF6\u3002</p><p>\u5982\u4E0B\u5B9E\u73B0</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>

<span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span>
	value<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
	maxLength<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">InputItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>value<span class="token punctuation">,</span> maxLength<span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
	<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		value <span class="token operator">&amp;&amp;</span> <span class="token function">setState</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment">// \u8FD9\u91CC\u80FD\u901A\u8FC7props\u63A7\u5236state</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">function</span> <span class="token function">updateValue</span><span class="token punctuation">(</span>inputValue<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>maxLength <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> inputValue<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> maxLength<span class="token punctuation">)</span> <span class="token keyword">return</span>
		<span class="token keyword">else</span> <span class="token function">setState</span><span class="token punctuation">(</span>inputValue<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&#39;input-item&#39;</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span> onInput<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> <span class="token function">updateValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> paddingRight<span class="token operator">:</span> maxLength <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token string">&#39;36px&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;10px&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token punctuation">{</span> maxLength <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span>
				<span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span> state<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">&#39;/&#39;</span> <span class="token operator">+</span> maxLength<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
			<span class="token punctuation">}</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>\u5728\u5927\u591A\u6570\u60C5\u51B5\u4E0B\uFF0C\u63A8\u8350\u4F7F\u7528 <code>\u53D7\u63A7\u7EC4\u4EF6</code> \u6765\u5904\u7406\u8868\u5355\u6570\u636E\u3002</p><p>\u5728\u4E00\u4E2A\u53D7\u63A7\u7EC4\u4EF6\u4E2D\uFF0C\u8868\u5355\u6570\u636E\u662F\u7531 <code>React</code> \u7EC4\u4EF6\u6765\u7BA1\u7406\u7684\u3002\u53E6\u4E00\u79CD\u66FF\u4EE3\u65B9\u6848\u662F\u4F7F\u7528\u975E\u53D7\u63A7\u7EC4\u4EF6\uFF0C\u8FD9\u65F6\u8868\u5355\u6570\u636E\u5C06\u4EA4<strong>\u7531 <code>DOM</code> \u8282\u70B9\u6765\u5904\u7406</strong>\u3002</p><p>\u5199\u4E00\u4E2A\u975E\u53D7\u63A7\u7EC4\u4EF6\uFF0C\u800C\u4E0D\u662F\u4E3A\u6BCF\u4E2A\u72B6\u6001\u66F4\u65B0\u90FD\u7F16\u5199\u6570\u636E\u5904\u7406\u51FD\u6570\uFF0C\u4F7F\u7528 <code>ref</code> \u6765\u4ECE <code>DOM</code>\u8282\u70B9\u4E2D\u83B7\u53D6\u8868\u5355\u6570\u636E\u3002</p><p>\u5982input\u662Ffile\u7C7B\u578B\u7684\uFF0C\u5B83\u7684value\u662F\u53EA\u53D6\u7684\uFF0C\u6240\u4EE5\u5B83\u662F React \u4E2D\u7684\u4E00\u4E2A\u975E\u53D7\u63A7\u7EC4\u4EF6</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">NameForm</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleSubmit</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>input <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;A name was submitted: &#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          Name:
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Submit<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="note" tabindex="-1"><a class="header-anchor" href="#note" aria-hidden="true">#</a> note</h3><ol><li>\u5982\u679C <code>input</code> \u7684 <code>value</code> \u662F <code>undefined</code> \uFF0C\u5219\u8FD9\u4E2A<code>input</code>\u662F<strong>\u975E\u53D7\u63A7\u7EC4\u4EF6</strong>\u3002</li></ol>`,16),bs={id:"setstate",tabindex:"-1"},ms=n("a",{class:"header-anchor",href:"#setstate","aria-hidden":"true"},"#",-1),hs=s(),gs={href:"https://zhuanlan.zhihu.com/p/39512941",target:"_blank",rel:"noopener noreferrer"},fs=s("setState"),ys=n("ul",null,[n("li",null,[s("setState \u53EA\u5728\u5408\u6210\u4E8B\u4EF6\u548C\u94A9\u5B50\u51FD\u6570\u4E2D\u662F\u201C\u5F02\u6B65\u201D\u7684\uFF0C\u5728\u539F\u751F\u4E8B\u4EF6\u548C"),n("code",null,"setTimeout"),s("\u4E2D\u90FD\u662F\u540C\u6B65\u7684\u3002")]),n("li",null,"setState \u7684\u201C\u5F02\u6B65\u201D\u5E76\u4E0D\u662F\u8BF4\u5185\u90E8\u7531\u5F02\u6B65\u4EE3\u7801\u5B9E\u73B0\uFF0C\u5176\u5B9E\u672C\u8EAB\u6267\u884C\u7684\u8FC7\u7A0B\u548C\u4EE3\u7801\u90FD\u662F\u540C\u6B65\u7684\uFF0C\u53EA\u662F\u5408\u6210\u4E8B\u4EF6\u548C\u94A9\u5B50\u51FD\u6570\u7684\u8C03\u7528\u987A\u5E8F\u5728\u66F4\u65B0\u4E4B\u524D\uFF0C\u5BFC\u81F4\u5728\u5408\u6210\u4E8B\u4EF6\u548C\u94A9\u5B50\u51FD\u6570\u4E2D\u6CA1\u6CD5\u7ACB\u9A6C\u62FF\u5230\u66F4\u65B0\u540E\u7684\u503C\uFF0C\u5F62\u6210\u4E86\u6240\u8C13\u7684\u201C\u5F02\u6B65\u201D\uFF0C\u5F53\u7136\u53EF\u4EE5\u901A\u8FC7\u7B2C\u4E8C\u4E2A\u53C2\u6570 setState(partialState, callback) \u4E2D\u7684callback\u62FF\u5230\u66F4\u65B0\u540E\u7684\u7ED3\u679C\u3002"),n("li",null,"setState \u7684\u6279\u91CF\u66F4\u65B0\u4F18\u5316\u4E5F\u662F\u5EFA\u7ACB\u5728\u201C\u5F02\u6B65\u201D\uFF08\u5408\u6210\u4E8B\u4EF6\u3001\u94A9\u5B50\u51FD\u6570\uFF09\u4E4B\u4E0A\u7684\uFF0C\u5728\u539F\u751F\u4E8B\u4EF6\u548CsetTimeout \u4E2D\u4E0D\u4F1A\u6279\u91CF\u66F4\u65B0\uFF0C\u5728\u201C\u5F02\u6B65\u201D\u4E2D\u5982\u679C\u5BF9\u540C\u4E00\u4E2A\u503C\u8FDB\u884C\u591A\u6B21setState\uFF0CsetState\u7684\u6279\u91CF\u66F4\u65B0\u7B56\u7565\u4F1A\u5BF9\u5176\u8FDB\u884C\u8986\u76D6\uFF0C\u53D6\u6700\u540E\u4E00\u6B21\u7684\u6267\u884C\uFF0C\u5982\u679C\u662F\u540C\u65F6setState\u591A\u4E2A\u4E0D\u540C\u7684\u503C\uFF0C\u5728\u66F4\u65B0\u65F6\u4F1A\u5BF9\u5176\u8FDB\u884C\u5408\u5E76\u6279\u91CF\u66F4\u65B0\u3002")],-1),ws=n("h2",{id:"react\u5408\u6210\u4E8B\u4EF6",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#react\u5408\u6210\u4E8B\u4EF6","aria-hidden":"true"},"#"),s(" react\u5408\u6210\u4E8B\u4EF6")],-1),_s={href:"https://juejin.cn/post/6955837254250004511",target:"_blank",rel:"noopener noreferrer"},xs=s("\u4E00\u6587\u5403\u900Freact\u4E8B\u4EF6\u7CFB\u7EDF\u539F\u7406"),vs=o(`<p>\u9996\u5148\uFF0CReact Jsx\u4E2D\u5199\u7684\u4E8B\u4EF6\uFF0C\u7ECF\u8FC7<code>babel</code>\u8F6C\u6362\u6210<code>React.createElement</code>\u5F62\u5F0F\uFF0C\u653E\u5728\u4E86props\u53C2\u6570<code>onClick</code>\u4E2D\uFF0C\u6700\u7EC8\u8F6C\u6210fiber\u5BF9\u8C61\u653E\u5728\u4E86<code>memoizedProps</code> \u548C <code>pendingProps</code>\u3002 \u771F\u5B9E\u7684dom\u4E0A\u7684click\u4E8B\u4EF6\u88AB\u5355\u72EC\u5904\u7406\uFF0C\u5DF2\u7ECF\u88ABreact\u5E95\u5C42\u66FF\u6362\u6210\u7A7A\u51FD\u6570\u3002</p><p>\u5408\u6210\u4E8B\u4EF6\u662F\u6307\u5728react\u4E2D\uFF0C\u7ED1\u5B9A\u7684\u4E8B\u4EF6onClick\u7B49\uFF0C\u5E76\u4E0D\u662F\u539F\u751F\u4E8B\u4EF6\uFF0C\u800C\u662F\u7531\u539F\u751F\u4E8B\u4EF6\u5408\u6210\u7684React\u4E8B\u4EF6\uFF0C\u6BD4\u5982 click\u4E8B\u4EF6\u5408\u6210\u4E3AonClick\u4E8B\u4EF6\u3002\u6BD4\u5982blur , change , input , keydown , keyup\u7B49 , \u5408\u6210\u4E3AonChange\u3002\u7ED1\u5B9A\u5728document\u4E0A\u7EDF\u4E00\u7BA1\u7406\u7684\u3002</p><p>\u4E00\u65B9\u9762\uFF0C\u5C06\u4E8B\u4EF6\u7ED1\u5B9A\u5728document\u7EDF\u4E00\u7BA1\u7406\uFF0C\u9632\u6B62\u5F88\u591A\u4E8B\u4EF6\u76F4\u63A5\u7ED1\u5B9A\u5728\u539F\u751F\u7684dom\u5143\u7D20\u4E0A\u3002\u9020\u6210\u4E00\u4E9B\u4E0D\u53EF\u63A7\u7684\u60C5\u51B5</p><p>\u53E6\u4E00\u65B9\u9762\uFF0C React \u60F3\u5B9E\u73B0\u4E00\u4E2A\u5168\u6D4F\u89C8\u5668\u7684\u6846\u67B6\uFF0C \u4E3A\u4E86\u5B9E\u73B0\u8FD9\u79CD\u76EE\u6807\u5C31\u9700\u8981\u63D0\u4F9B\u5168\u6D4F\u89C8\u5668\u4E00\u81F4\u6027\u7684\u4E8B\u4EF6\u7CFB\u7EDF\uFF0C\u4EE5\u6B64\u62B9\u5E73\u4E0D\u540C\u6D4F\u89C8\u5668\u7684\u5DEE\u5F02\u3002</p><h2 id="react-purecomponent\u4E0Ereact-memo" tabindex="-1"><a class="header-anchor" href="#react-purecomponent\u4E0Ereact-memo" aria-hidden="true">#</a> React.PureComponent\u4E0EReact.memo()</h2><p>\u4E00\u4E2A\u7EC4\u4EF6\u91CD\u65B0\u91CD\u65B0\u6E32\u67D3\uFF0C\u4E00\u822C\u4E09\u79CD\u60C5\u51B5\uFF1A</p><ol><li>\u8981\u4E48\u662F\u7EC4\u4EF6\u81EA\u5DF1\u7684\u72B6\u6001\u6539\u53D8</li><li>\u8981\u4E48\u662F\u7236\u7EC4\u4EF6\u91CD\u65B0\u6E32\u67D3\uFF0C\u5BFC\u81F4\u5B50\u7EC4\u4EF6\u91CD\u65B0\u6E32\u67D3\uFF0C\u4F46\u662F\u7236\u7EC4\u4EF6\u7684 props \u6CA1\u6709\u6539\u53D8</li><li>\u8981\u4E48\u662F\u7236\u7EC4\u4EF6\u91CD\u65B0\u6E32\u67D3\uFF0C\u5BFC\u81F4\u5B50\u7EC4\u4EF6\u91CD\u65B0\u6E32\u67D3\uFF0C\u4F46\u662F\u7236\u7EC4\u4EF6\u4F20\u9012\u7684 props \u6539\u53D8</li></ol><p>React.PureComponent \u4E2D\u4EE5\u6D45\u5C42\u5BF9\u6BD4 prop \u548C state \u7684\u65B9\u5F0F\u6765\u5B9E\u73B0<code>shouldComponentUpdate(nextProps, nextState)</code>\u3002\u4EC5\u4F5C\u5BF9\u8C61\u7684\u6D45\u5C42\u6BD4\u8F83\u3002\u5982\u679C\u5BF9\u8C61\u4E2D\u5305\u542B\u590D\u6742\u7684\u6570\u636E\u7ED3\u6784\uFF0C\u5219\u6709\u53EF\u80FD\u56E0\u4E3A\u65E0\u6CD5\u68C0\u67E5\u6DF1\u5C42\u7684\u5DEE\u522B\uFF0C\u4EA7\u751F\u9519\u8BEF\u7684\u6BD4\u5BF9\u7ED3\u679C\u3002</p><p>\u5176\u5B9E\u5C31\u662F\u9ED8\u8BA4\u5B9E\u73B0\u4E86<code>shouldComponentUpdate</code>\uFF0C\u53EF\u4EE5\u5224\u65AD\u662F\u5426\u91CD\u65B0\u6E32\u67D3\u3002\u800Cmemo\u662F\u5BF9\u51FD\u6570\u5F0F\u7EC4\u4EF6\u7684\u9AD8\u9636\u8FD0\u7528\u3002</p><p><code>React.memo</code> \u4EC5\u68C0\u67E5 <code>props</code> \u53D8\u66F4\u3002\u5982\u679C\u51FD\u6570\u7EC4\u4EF6\u88AB<code>React.memo</code>\u5305\u88F9\uFF0C\u4E14\u5176\u5B9E\u73B0\u4E2D\u62E5\u6709 <code>useState </code>\u6216 <code>useContext</code> \u7684 Hook\uFF0C\u5F53 context \u53D1\u751F\u53D8\u5316\u65F6\uFF0C\u5B83\u4ECD\u4F1A\u91CD\u65B0\u6E32\u67D3\u3002 \u9ED8\u8BA4\u60C5\u51B5\u4E0B\u5176\u53EA\u4F1A\u5BF9\u590D\u6742\u5BF9\u8C61\u505A\u6D45\u5C42\u5BF9\u6BD4\uFF0C\u5982\u679C\u60F3\u8981\u63A7\u5236\u5BF9\u6BD4\u8FC7\u7A0B\uFF0C\u90A3\u4E48\u53EF\u4EE5\u5C06\u81EA\u5B9A\u4E49\u7684\u6BD4\u8F83\u51FD\u6570\u901A\u8FC7\u7B2C\u4E8C\u4E2A\u53C2\u6570\u4F20\u5165\u6765\u5B9E\u73B0\u3002</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* \u4F7F\u7528 props \u6E32\u67D3 */</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">areEqual</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/*
  \u5982\u679C\u628A nextProps \u4F20\u5165 render \u65B9\u6CD5\u7684\u8FD4\u56DE\u7ED3\u679C\u4E0E
  \u5C06 prevProps \u4F20\u5165 render \u65B9\u6CD5\u7684\u8FD4\u56DE\u7ED3\u679C\u4E00\u81F4\u5219\u8FD4\u56DE true\uFF0C
  \u5426\u5219\u8FD4\u56DE false
  */</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> areEqual<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
	<span class="token comment">// shouldComponentUpdate(nextProps, nextState, nextContext) {</span>
	<span class="token comment">// 	return nextProps.seconds !== this.props.seconds</span>
	<span class="token comment">// }</span>
	
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;I am rendering&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">I am update every </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>seconds<span class="token punctuation">}</span><span class="token plain-text"> seconds</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="react\u7EC4\u4EF6\u5230\u5E95\u4EC0\u4E48\u65F6\u5019render" tabindex="-1"><a class="header-anchor" href="#react\u7EC4\u4EF6\u5230\u5E95\u4EC0\u4E48\u65F6\u5019render" aria-hidden="true">#</a> React\u7EC4\u4EF6\u5230\u5E95\u4EC0\u4E48\u65F6\u5019render</h2><p>example\uFF1A\u70B9\u51FBParent\u7EC4\u4EF6\u7684div\uFF0C\u89E6\u53D1\u66F4\u65B0\uFF0CSon\u7EC4\u4EF6\u4F1A\u6253\u5370child render!\u4E48\uFF1F</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;child render!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Son</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      count:</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Parent</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Parent</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> rootEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> rootEl<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>\u4E0D\u4F1A</strong></p><h4 id="render\u9700\u8981\u6EE1\u8DB3\u7684\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#render\u9700\u8981\u6EE1\u8DB3\u7684\u6761\u4EF6" aria-hidden="true">#</a> render\u9700\u8981\u6EE1\u8DB3\u7684\u6761\u4EF6</h4><p>React\u521B\u5EFA<code>Fiber</code>\u6811\u65F6\uFF0C\u6BCF\u4E2A\u7EC4\u4EF6\u5BF9\u5E94\u7684<code>fiber</code>\u90FD\u662F\u901A\u8FC7\u5982\u4E0B\u4E24\u4E2A\u903B\u8F91\u4E4B\u4E00\u521B\u5EFA\u7684\uFF1A</p><ul><li>render\u3002\u5373\u8C03\u7528<code>render</code>\u51FD\u6570\uFF0C\u6839\u636E\u8FD4\u56DE\u7684JSX\u521B\u5EFA\u65B0\u7684<code>fiber</code>\u3002</li><li>bailout\u3002\u5373\u6EE1\u8DB3\u4E00\u5B9A\u6761\u4EF6\u65F6\uFF0CReact\u5224\u65AD\u8BE5\u7EC4\u4EF6\u5728\u66F4\u65B0\u524D\u540E\u6CA1\u6709\u53D1\u751F\u53D8\u5316\uFF0C\u5219\u590D\u7528\u8BE5\u7EC4\u4EF6\u5728\u4E0A\u4E00\u6B21\u66F4\u65B0\u7684fiber\u4F5C\u4E3A\u672C\u6B21\u66F4\u65B0\u7684fiber\u3002</li></ul><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5F53\u547D\u4E2D<code>bailout</code>\u903B\u8F91\u65F6\uFF0C\u662F\u4E0D\u4F1A\u8C03\u7528<code>render</code>\u51FD\u6570\u7684\u3002</p><p>\u6240\u4EE5\uFF0CSon\u7EC4\u4EF6\u4E0D\u4F1A\u6253\u5370child render!\u662F\u56E0\u4E3A\u547D\u4E2D\u4E86bailout\u903B\u8F91\u3002</p><h4 id="bailout\u9700\u8981\u6EE1\u8DB3\u7684\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#bailout\u9700\u8981\u6EE1\u8DB3\u7684\u6761\u4EF6" aria-hidden="true">#</a> bailout\u9700\u8981\u6EE1\u8DB3\u7684\u6761\u4EF6</h4><p>\u4EC0\u4E48\u60C5\u51B5\u4E0B\u4F1A\u8FDB\u5165bailout\u903B\u8F91\uFF1F\u5F53\u540C\u65F6\u6EE1\u8DB3\u5982\u4E0B4\u4E2A\u6761\u4EF6\u65F6\uFF1A</p><ul><li><ol><li>oldProps === newProps \uFF1F \u5373\u672C\u6B21\u66F4\u65B0\u7684props\uFF08newProps\uFF09\u4E0D\u7B49\u4E8E\u4E0A\u6B21\u66F4\u65B0\u7684props\uFF08oldProps\uFF09\u3002\u6CE8\u610F\u8FD9\u91CC\u662F<strong>\u5168\u7B49\u6BD4\u8F83</strong>\u3002</li></ol></li></ul><p>\u7EC4\u4EF6<code>render</code>\u4F1A\u8FD4\u56DE<code>JSX</code>\uFF0C<code>JSX</code>\u662F<code>React.createElement</code>\u7684\u8BED\u6CD5\u7CD6\u3002</p><p>\u6240\u4EE5<code>render</code>\u7684\u8FD4\u56DE\u7ED3\u679C\u5B9E\u9645\u4E0A\u662F<code>React.createElement</code>\u7684\u6267\u884C\u7ED3\u679C\uFF0C\u5373\u4E00\u4E2A\u5305\u542B<code>props</code>\u5C5E\u6027\u7684\u5BF9\u8C61\u3002</p><p>\u5373\u4F7F\u672C\u6B21\u66F4\u65B0\u4E0E\u4E0A\u6B21\u66F4\u65B0<code>props</code>\u4E2D\u6BCF\u4E00\u9879\u53C2\u6570\u90FD\u6CA1\u6709\u53D8\u5316\uFF0C\u4F46\u662F\u672C\u6B21\u66F4\u65B0\u662F<code>React.createElement</code>\u7684\u6267\u884C\u7ED3\u679C\uFF0C\u662F\u4E00\u4E2A\u5168\u65B0\u7684<code>props</code>\u5F15\u7528\uFF0C\u6240\u4EE5<code>oldProps !== newProps</code>\u3002</p><p>\u5982\u679C\u4F7F\u7528\u4E86<code>PureComponent</code>\u6216<code>Memo</code>\uFF0C\u90A3\u4E48\u5728\u5224\u65AD\u662F\u8FDB\u5165<code>render</code>\u8FD8\u662F<code>bailout</code>\u65F6\uFF0C\u4E0D\u4F1A\u5224\u65AD<code>oldProps</code>\u4E0E<code>newProps</code>\u662F\u5426\u5168\u7B49\uFF0C\u800C\u662F\u4F1A\u5BF9<code>props</code>\u5185\u6BCF\u4E2A\u5C5E\u6027\u8FDB\u884C\u6D45\u6BD4\u8F83\u3002</p><ol start="2"><li>context\u6CA1\u6709\u53D8\u5316 \u5373<code>context</code>\u7684<code>value</code>\u6CA1\u6709\u53D8\u5316\u3002</li><li>workInProgress.type === current.type \uFF1F \u66F4\u65B0\u524D\u540E<code>fiber.type</code>\u662F\u5426\u53D8\u5316\uFF0C\u6BD4\u5982<code>div</code>\u662F\u5426\u53D8\u4E3A<code>p</code>\uFF0C<code>functionComponent</code>\u53D8\u6210\u4E86<code>ClassComponent</code></li><li>!includesSomeLane(renderLanes, updateLanes) \uFF1F \u5F53\u524D<code>fiber\u4E0A</code>\u662F\u5426\u5B58\u5728\u66F4\u65B0\uFF0C\u5982\u679C\u5B58\u5728\u90A3\u4E48<code>\u66F4\u65B0</code>\u7684<code>\u4F18\u5148\u7EA7</code>\u662F\u5426\u548C\u672C\u6B21\u6574\u68F5<code>fiber\u6811</code>\u8C03\u5EA6\u7684\u4F18\u5148\u7EA7\u4E00\u81F4\uFF1F</li></ol><p>\u5982\u679C\u4E00\u81F4\u5219\u8FDB\u5165<code>render</code>\u903B\u8F91\u3002</p><p>\u5C31example\u6765\u8BF4\uFF0C<code>Parent</code>\u662F\u6574\u68F5\u6811\u4E2D\u552F\u4E00\u80FD\u89E6\u53D1\u66F4\u65B0\u7684\u7EC4\u4EF6\uFF08\u901A\u8FC7\u8C03\u7528<code>setCount</code>\uFF09\u3002</p><p>\u6240\u4EE5Parent\u5BF9\u5E94\u7684fiber\u662F\u552F\u4E00\u6EE1\u8DB3\u6761\u4EF64\u7684fiber\u3002</p><p>example\u7684\u8BE6\u7EC6\u6267\u884C\u903B\u8F91</p><p>\u6240\u4EE5\uFF0CDemo\u4E2DSon\u8FDB\u5165bailout\u903B\u8F91\uFF0C\u4E00\u5B9A\u662F\u540C\u65F6\u6EE1\u8DB3\u4EE5\u4E0A4\u4E2A\u6761\u4EF6\u3002</p><p>\u6761\u4EF62\uFF0CDemo\u4E2D\u6CA1\u6709\u7528\u5230context\uFF0C\u6EE1\u8DB3\u3002</p><p>\u6761\u4EF63\uFF0C\u66F4\u65B0\u524D\u540Etype\u90FD\u4E3ASon\u5BF9\u5E94\u7684\u51FD\u6570\u7EC4\u4EF6\uFF0C\u6EE1\u8DB3\u3002</p><p>\u6761\u4EF64\uFF0CSon\u672C\u8EAB\u65E0\u6CD5\u89E6\u53D1\u66F4\u65B0\uFF0C\u6EE1\u8DB3\u3002</p><p>\u6240\u4EE5\uFF0C\u91CD\u70B9\u662F\u6761\u4EF61\u3002</p><p>\u672C\u6B21\u66F4\u65B0\u5F00\u59CB\u65F6\uFF0CFiber\u6811\u5B58\u5728\u5982\u4E0B2\u4E2Afiber\uFF1AFiberRootNode --- RootFiber</p><p>\u5176\u4E2D<code>FiberRootNode</code>\u662F\u6574\u4E2A\u5E94\u7528\u7684\u6839\u8282\u70B9\uFF0C<code>RootFiber</code>\u662F\u8C03\u7528<code>ReactDOM.rende</code>r\u521B\u5EFA\u7684fiber\u3002</p><p>\u9996\u5148\uFF0C<code>RootFiber</code>\u4F1A\u8FDB\u5165<code>bailout\u7684</code>\u903B\u8F91\uFF0C\u6240\u4EE5\u8FD4\u56DE\u7684<code>App fiber</code>\u548C\u66F4\u65B0\u524D\u662F\u4E00\u81F4\u7684\u3002FiberRootNode--RootFiber-- App fiber</p><p>\u7531\u4E8E<code>App fiber</code>\u662F<code>RootFiber</code>\u8D70<code>bailout</code>\u903B\u8F91\u8FD4\u56DE\u7684\uFF0C\u6240\u4EE5\u5BF9\u4E8E<code>App fiber</code>\uFF0C<code>oldProps === newProps</code>\u3002\u5E76\u4E14<code>bailout</code>\u5269\u4E0B3\u4E2A\u6761\u4EF6\u4E5F\u6EE1\u8DB3\u3002</p><p>\u6240\u4EE5App fiber\u4E5F\u4F1A\u8D70bailout\u903B\u8F91\uFF0C\u8FD4\u56DEParent fiber\u3002FiberRootNode -- RootFiber -- App fiber -- Parent fiber</p><p>\u7531\u4E8E\u66F4\u65B0\u662F<code>Parent fiber</code>\u89E6\u53D1\u7684\uFF0C\u6240\u4EE5\u4ED6\u4E0D\u6EE1\u8DB3\u6761\u4EF64\uFF0C\u4F1A\u8D70render\u7684\u903B\u8F91\u3002</p><p><strong>\u63A5\u4E0B\u6765\u662F\u5173\u952E</strong></p><p>\u5982\u679Crender\u8FD4\u56DE\u7684Son\u662F\u5982\u4E0B\u5F62\u5F0F\uFF1A<code>&lt;Son/&gt;</code>, \u4F1A\u7F16\u8BD1\u4E3A<code>React.createElement(Son, null)</code>\uFF0C\u6267\u884C\u540E\u8FD4\u56DE<code>JSX</code>\u3002</p><p>\u7531\u4E8E<code>props</code>\u7684\u5F15\u7528\u6539\u53D8\uFF0C<code>oldProps !== newProps</code>\u3002\u4F1A\u8D70<code>render</code>\u903B\u8F91\u3002</p><p>\u4F46\u662F\u5728<code>example</code>\u4E2D<code>Son</code>\u662F\u5982\u4E0B\u5F62\u5F0F\uFF1A<code>{props.children}</code></p><p>\u5176\u4E2D\uFF0C<code>props.children</code>\u662FSon\u5BF9\u5E94\u7684JSX\uFF0C\u800C\u8FD9\u91CC\u7684<code>props</code>\u662F<code>App fiber</code>\u8D70<code>bailout</code>\u903B\u8F91\u540E\u8FD4\u56DE\u7684\u3002</p><p>\u6240\u4EE5<code>Son</code>\u5BF9\u5E94\u7684<code>JSX</code>\u4E0E\u4E0A\u6B21\u66F4\u65B0\u65F6\u4E00\u81F4\uFF0C<code>JSX</code>\u4E2D\u4FDD\u5B58\u7684<code>props</code>\u4E5F\u5C31\u4E00\u81F4\uFF0C\u6EE1\u8DB3\u6761\u4EF61\u3002</p><p>\u53EF\u4EE5\u770B\u5230\uFF0C<code>Son</code>\u6EE1\u8DB3<code>bailout</code>\u7684\u6240\u6709\u6761\u4EF6\uFF0C\u6240\u4EE5\u4E0D\u4F1A<code>render</code>\u3002</p><h2 id="\u9AD8\u9636\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u9AD8\u9636\u7EC4\u4EF6" aria-hidden="true">#</a> \u9AD8\u9636\u7EC4\u4EF6</h2>`,52),Rs=s("\u597D\u6587\u7AE0-"),Cs={href:"https://blog.csdn.net/qq_40962320/article/details/87043581",target:"_blank",rel:"noopener noreferrer"},Ps=s("React\u65B0\u7279\u6027Hooks\u4F7F\u7528\u6559\u5B66\uFF0C\u4EE5\u53CA\u4E0E\u9AD8\u9636\u7EC4\u4EF6\u3001renderProps\u6A21\u5F0F\u7684\u5BF9\u6BD4"),Ss=o(`<p>\u9AD8\u9636\u7EC4\u4EF6\u662F\u53C2\u6570\u4E3A\u7EC4\u4EF6\uFF0C\u8FD4\u56DE\u503C\u4E3A\u65B0\u7EC4\u4EF6\u7684\u51FD\u6570\u3002\u7EC4\u4EF6\u662F\u5C06 props \u8F6C\u6362\u4E3A UI\uFF0C\u800C\u9AD8\u9636\u7EC4\u4EF6\u662F\u5C06\u7EC4\u4EF6\u8F6C\u6362\u4E3A\u53E6\u4E00\u4E2A\u7EC4\u4EF6\u3002</p><p>HOC \u662F\u7EAF\u51FD\u6570\uFF0C\u6CA1\u6709\u526F\u4F5C\u7528\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> EnhancedComponent <span class="token operator">=</span> <span class="token function">higherOrderComponent</span><span class="token punctuation">(</span>WrappedComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>example\uFF1A</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code>
<span class="token keyword">const</span> <span class="token function-variable function">withMouse</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>

    <span class="token function-variable function">handleMouseMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">x</span><span class="token operator">:</span> event<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
        <span class="token literal-property property">y</span><span class="token operator">:</span> event<span class="token punctuation">.</span>clientY
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onMouseMove</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleMouseMove<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Component</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>\u4F7F\u7528</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">const</span> App2<span class="token operator">=</span> <span class="token function">withMouse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">&#39;100%&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">x: </span><span class="token punctuation">{</span>position<span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token plain-text">, y: </span><span class="token punctuation">{</span>position<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u95EE\u9898:</p><ul><li>\u5D4C\u5957\u5730\u72F1\uFF0C\u6BCF\u4E00\u6B21HOC\u8C03\u7528\u90FD\u4F1A\u4EA7\u751F\u4E00\u4E2A\u7EC4\u4EF6\u5B9E\u4F8B</li><li>\u53EF\u4EE5\u4F7F\u7528\u7C7B\u88C5\u9970\u5668\u7F13\u89E3\u7EC4\u4EF6\u5D4C\u5957\u5E26\u6765\u7684\u53EF\u7EF4\u62A4\u6027\u95EE\u9898(\u94FE\u5F0F\u8C03\u7528\u7684\u65F6\u5019\u5D4C\u5957\u592A\u591A)\uFF0C\u4F46\u88C5\u9970\u5668\u672C\u8D28\u4E0A\u8FD8\u662FHOC</li><li>\u5305\u88F9\u592A\u591A\u5C42\u7EA7\u4E4B\u540E\uFF0C\u53EF\u80FD\u4F1A\u5E26\u6765props\u5C5E\u6027\u7684\u8986\u76D6\u95EE\u9898</li></ul><p>\u5F53\u5D4C\u5957\u4F7F\u7528\u591A\u4E2A\u9AD8\u9636\u7EC4\u4EF6\u65F6\uFF0C\u5728\u4EE3\u7801\u4E2D\u65E0\u6CD5\u8BC6\u522Bprops\u4E2D\u7684\u53C2\u6570\uFF0C\u662F\u54EA\u91CC\u6765\u7684\u3002\u5E76\u4E14\u5F53\u53C2\u6570\u547D\u540D\u91CD\u590D\u65F6\u4E00\u6837\u65E0\u6CD5\u89E3\u51B3\u3002\u56E0\u6B64\u9AD8\u9636\u7EC4\u4EF6\u5728\u4F7F\u7528\u65F6\u4F1A\u975E\u5E38\u5C0F\u5FC3\uFF0C\u4EE5\u81F3\u4E8E\u5728\u5F88\u591A\u573A\u666F\u4E0B\uFF0C\u6211\u4EEC\u653E\u5F03\u5171\u540C\u903B\u8F91\u7247\u6BB5\u7684\u5C01\u88C5\uFF0C\u56E0\u4E3A\u8FD9\u4F1A\u5F88\u5BB9\u6613\u9020\u6210\u6EE5\u7528\u3002</p><p>example</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span>
<span class="token keyword">import</span> GetRandomColor <span class="token keyword">from</span> <span class="token string">&#39;./util&#39;</span>

<span class="token comment">// \u5C5E\u6027\u88AB\u5199\u6B7B\u4E86\u3002\u5982\u679C\u5B50\u7EC4\u4EF6\u9700\u6C42\u7684\u5C5E\u6027\u540D\u5199\u5F97\u4E0D\u4E00\u6837\uFF0C\u9AD8\u9636\u7EC4\u4EF6\u5C31\u65E0\u80FD\u4E3A\u529B\u4E86 =\u300B\u53EF\u4EE5\u7528es6\u89E3\u6784\u91CD\u547D\u540D\u89E3\u51B3\u7684\u6837\u5B50</span>
<span class="token keyword">function</span> <span class="token function">Count</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> newCount<span class="token punctuation">,</span> add<span class="token punctuation">,</span> minus<span class="token punctuation">,</span> theme<span class="token punctuation">,</span> changeTheme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
            <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> theme<span class="token punctuation">,</span>
                <span class="token literal-property property">flex</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token literal-property property">alignItems</span><span class="token operator">:</span> <span class="token string">&#39;center&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">justifyContent</span><span class="token operator">:</span> <span class="token string">&#39;center&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">10</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>newCount<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>add<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">add</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>minus<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">minus</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>changeTheme<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">changeTheme</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">countNumber</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">initNumber</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">class</span> <span class="token class-name">CountNumber</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> initNumber <span class="token punctuation">}</span>

        <span class="token comment">// eslint-disable-next-line no-invalid-this</span>
        <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// eslint-disable-next-line no-invalid-this</span>
        <span class="token function-variable function">minus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">WrappedComponent</span></span>
                    <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span></span>
                    <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span></span>
                    <span class="token attr-name">add</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>add<span class="token punctuation">}</span></span>
                    <span class="token attr-name">minus</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>minus<span class="token punctuation">}</span></span>
                <span class="token punctuation">/&gt;</span></span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">changeTheme</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">initColor</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">ChangeTheme</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">theme</span><span class="token operator">:</span> initColor
        <span class="token punctuation">}</span>
        <span class="token function-variable function">changeTheme</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token function">GetRandomColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">WrappedComponent</span></span>
                    <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span></span>
                    <span class="token attr-name">theme</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme<span class="token punctuation">}</span></span>
                    <span class="token attr-name">changeTheme</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeTheme</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
                <span class="token punctuation">/&gt;</span></span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// \u9AD8\u9636\u7EC4\u4EF6\u4F1A\u521B\u9020\u4E00\u4E2A\u65B0\u7684\u7EC4\u4EF6\uFF0C\u5F53\u7A0B\u5E8F\u62A5\u9519\u7684\u65F6\u5019\uFF0C\u51FA\u73B0\u5728\u5F02\u5E38\u4FE1\u606F\u91CC\u7684\u4F1A\u662F\u8FD9\u4E2A\u65B0\u521B\u5EFA\u7684\u7EC4\u4EF6\u800C\u4E0D\u662F\u539F\u672C\u7684\u65E0\u72B6\u6001\u7EC4\u4EF6\u2014\u2014\u60F3\u60F3\u5728\u51E0\u5341\u4E2A\u5730\u65B9\u90FD\u8C03\u7528\u4E86\u8FD9\u4E2A\u9AD8\u9636\u7EC4\u4EF6\u7684\u65F6\u5019\uFF0C\u8BE5\u5982\u4F55\u77E5\u9053\u9519\u8BEF\u5728\u54EA\u91CC\uFF1F</span>
       
   <span class="token comment">//\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u7684\u65B9\u6CD5\u662F\u7ED9\u9AD8\u9636\u7EC4\u4EF6\u8BBE\u7F6EdisplayName</span>
    ChangeTheme<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">changeTheme(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>
        WrappedComponent<span class="token punctuation">.</span>displayName <span class="token operator">||</span> WrappedComponent<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">&#39;Component&#39;</span>
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">\`</span></span>
    <span class="token keyword">return</span> ChangeTheme
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">changeTheme</span><span class="token punctuation">(</span><span class="token string">&#39;white&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">countNumber</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Count<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// \u94FE\u5F0F\u8C03\u7528</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><h2 id="render-props" tabindex="-1"><a class="header-anchor" href="#render-props" aria-hidden="true">#</a> render props</h2><p>\u5177\u6709 <code>render prop</code> \u7684\u7EC4\u4EF6\u63A5\u53D7\u4E00\u4E2A\u51FD\u6570\uFF0C\u8BE5\u51FD\u6570\u8FD4\u56DE\u4E00\u4E2A React \u5143\u7D20\u5E76\u8C03\u7528\u5B83\u800C\u4E0D\u662F\u5B9E\u73B0\u81EA\u5DF1\u7684\u6E32\u67D3\u903B\u8F91\u3002</p><p>\u5176\u5B9E\u5C31\u662F<code>props</code>\u8BBE\u7F6E\u4E00\u4E2A\u5C5E\u6027\u662F\u51FD\u6570\uFF0C\u8FD9\u4E2A\u51FD\u6570\u662F\u4E2A\u51FD\u6570\u5B50\u7EC4\u4EF6\uFF0C\u8C03\u7528\u65F6\u628A\u5B9A\u4E49\u7684\u7EC4\u4EF6\u7684<code>state</code>\uFF0C\u901A\u8FC7props\u4F20\u53C2\u7ED9\u8FD9\u4E2A\u51FD\u6570\u5B50\u7EC4\u4EF6\uFF0C\u6240\u4EE5\u4E0D\u4E00\u5B9A\u6CA1\u8981\u53D6\u540D\u4E3A<code>render props</code></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>

<span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> React<span class="token punctuation">.</span>ReactNode
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Mouse</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component<span class="token operator">&lt;</span>Props<span class="token operator">&gt;</span><span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span>
        x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        y<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>

    <span class="token function-variable function">handleMouseMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> React<span class="token punctuation">.</span>MouseEvent<span class="token operator">&lt;</span>HTMLDivElement<span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            x<span class="token operator">:</span> event<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
            y<span class="token operator">:</span> event<span class="token punctuation">.</span>clientY
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div onMouseMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleMouseMove<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&#39;mouse-move-container&#39;</span><span class="token operator">&gt;</span>
                <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u4F7F\u7528</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Mouse render<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">,</span> y<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>x<span class="token operator">:</span> <span class="token punctuation">{</span>x<span class="token punctuation">}</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token punctuation">{</span>y<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>\u76F8\u5BF9\u9AD8\u9636\u7EC4\u4EF6\u7684\u4F18\u70B9\uFF1A</p><ul><li>\u4E0D\u7528\u62C5\u5FC3props\u7684\u547D\u540D\u51B2\u7A81\u7684\u95EE\u9898</li><li>\u53EF\u4EE5\u6EAF\u6E90\uFF0C\u5B50\u7EC4\u4EF6\u7684props\u4E00\u5B9A\u6765\u81EA\u7236\u7EC4\u4EF6\u3002</li><li>\u662F\u52A8\u6001\u6784\u5EFA\u7684\uFF0C\u9875\u9762\u5728\u6E32\u67D3\u540E\uFF0C\u53EF\u4EE5\u52A8\u6001\u5730\u51B3\u5B9A\u6E32\u67D3\u54EA\u4E2A\u7EC4\u4EF6\u3002</li><li>\u6240\u6709\u80FD\u7528HOC\u5B8C\u6210\u7684\u4E8B\u60C5\uFF0CRender Props\u90FD\u53EF\u4EE5\u505A\uFF0C\u4E14\u66F4\u52A0\u7075\u6D3B\u3002</li><li>\u9664\u4E86\u529F\u80FD\u590D\u7528\uFF0C\u8FD8\u53EF\u4EE5\u7528\u4F5C\u4E24\u4E2A\u7EC4\u4EF6\u7684\u5355\u5411\u6570\u636E\u4F20\u9012\u3002</li></ul><p><code>render props</code>\u89E3\u51B3\u4E86\u6765\u6E90\u95EE\u9898\uFF0C\u540C\u65F6\u4E5F\u907F\u514D\u4E86\u547D\u540D\u51B2\u7A81\u3002</p><ul><li>\u6570\u636E\u6D41\u5411\u66F4\u76F4\u89C2\u4E86\uFF0C\u5B50\u5B59\u7EC4\u4EF6\u53EF\u4EE5\u5F88\u660E\u786E\u5730\u770B\u5230\u6570\u636E\u6765\u6E90</li><li>\u4F46\u672C\u8D28\u4E0A<code>Render Props</code>\u662F\u57FA\u4E8E\u95ED\u5305\u5B9E\u73B0\u7684(\u4F20\u5165\u7684props\u662F\u7236\u7EC4\u4EF6\u7684state)\uFF0C\u5927\u91CF\u5730\u7528\u4E8E\u7EC4\u4EF6\u7684\u590D\u7528\u5C06\u4E0D\u53EF\u907F\u514D\u5730\u5F15\u5165\u4E86<code>callback hell</code>\u95EE\u9898</li><li>render\u6BD4\u9AD8\u9636\u7EC4\u4EF6\u66F4\u4E3A\u5F3A\u5927\uFF0C\u4F46\u662F\u4E5F\u6709\u4E00\u4E2A\u5C0F\u5C0F\u7684\u7F3A\u70B9\uFF0C\u5C31\u662F\u96BE\u4EE5\u4F18\u5316\u3002\u56E0\u4E3A\u7EC4\u4EF6\u5185\u90E8\u662F\u4E00\u4E2A\u533F\u540D\u51FD\u6570\uFF0C\u8FD9\u5C31\u5BFC\u81F4\u5373\u4FBF\u4F20\u5165\u7684\u5C5E\u6027\u6CA1\u6709\u4EFB\u4F55\u53D8\u5316\uFF0C\u5185\u90E8\u7684\u5B50\u7EC4\u4EF6\u8FD8\u662F\u4F1A\u6574\u4E2A\u6E32\u67D3\u4E00\u904D\u3002\u89E3\u51B3\u65B9\u6CD5\u5C31\u662F\u5C06\u8BE5\u533F\u540D\u51FD\u6570\u518D\u6B21\u5305\u88C5\uFF0C\u4E0D\u8FC7\u6BCF\u6B21\u90FD\u8FD9\u6837\u505A\u7EC8\u7A76\u8FD8\u662F\u6BD4\u8F83\u9EBB\u70E6\u7684\u3002</li></ul><p>\u95EE\u9898</p><ol><li>\u53EF\u8BFB\u6027\u4E0D\u9AD8\uFF0C\u76F4\u89C2\u4E0A\u6BD4\u8F83\u522B\u626D\u3002\u6211\u4EEC\u53EF\u4EE5\u5728Mouse\u7EC4\u4EF6\u4E2D\u5904\u7406\u5F88\u591A\u989D\u5916\u903B\u8F91\uFF0C\u751A\u81F3\u5B9A\u4E49\u66F4\u591A\u7684\u4EA4\u4E92\u6837\u5F0F\u3002\u56E0\u6B64\u4F7F\u7528\u65F6\u4F1A\u9020\u6210\u4E00\u4E9B\u56F0\u6270\u3002</li><li>\u5B58\u5728\u5C40\u9650\u6027\u3002\u6211\u4EEC\u671F\u671B\u7684\u662F\u80FD\u591F\u5207\u5272\u903B\u8F91\u7247\u6BB5\uFF0Crender props\u6700\u7EC8\u4ECD\u7136\u662F\u7EC4\u4EF6\u5316\u601D\u7EF4\u7684\u6269\u5C55\u8FD0\u7528</li></ol><p>example</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span>
<span class="token keyword">import</span> GetRandomColor <span class="token keyword">from</span> <span class="token string">&#39;./util&#39;</span>

<span class="token comment">// call back hell</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ChangeTheme</span></span>
            <span class="token attr-name">initColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>white<span class="token punctuation">&#39;</span></span>
            <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> theme<span class="token punctuation">,</span> changeTheme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
                    <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> theme<span class="token punctuation">,</span>
                        <span class="token literal-property property">flex</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">alignItems</span><span class="token operator">:</span> <span class="token string">&#39;center&#39;</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">justifyContent</span><span class="token operator">:</span> <span class="token string">&#39;center&#39;</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">10</span>
                    <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
                <span class="token punctuation">&gt;</span></span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CountNumber</span></span> <span class="token attr-name">initNumber</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> count<span class="token punctuation">,</span> add<span class="token punctuation">,</span> minus <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>add<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">add</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>minus<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">minus</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>changeTheme<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">change Theme</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CountNumber</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">this is props children content</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ChangeTheme</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CountNumber</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// eslint-disable-next-line no-invalid-this</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>initNumber <span class="token punctuation">}</span>
    <span class="token comment">// eslint-disable-next-line no-invalid-this</span>
    <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// eslint-disable-next-line no-invalid-this</span>
    <span class="token function-variable function">minus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
            <span class="token literal-property property">add</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>add<span class="token punctuation">,</span>
            <span class="token literal-property property">minus</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minus
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ChangeTheme</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>initColor
    <span class="token punctuation">}</span>
    <span class="token function-variable function">changeTheme</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token function">GetRandomColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">this is props render content</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme<span class="token punctuation">,</span>
                    <span class="token literal-property property">changeTheme</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>changeTheme
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><h2 id="\u771F\u5B9Edom\u64CD\u4F5C\u548Cvirtual-dom" tabindex="-1"><a class="header-anchor" href="#\u771F\u5B9Edom\u64CD\u4F5C\u548Cvirtual-dom" aria-hidden="true">#</a> \u771F\u5B9EDOM\u64CD\u4F5C\u548CVirtual Dom</h2>`,25),Fs={href:"https://mp.weixin.qq.com/s/zCGQEpEGJYQWMMvZfyUYHg",target:"_blank",rel:"noopener noreferrer"},js=s("\u4ECE React \u5386\u53F2\u7684\u957F\u6CB3\u91CC\u804A\u865A\u62DFDOM\u53CA\u5176\u4EF7\u503C"),Ms=o('<p>react\u548Cvue\u7B49\u6846\u67B6\u7684\u51FA\u73B0\u4F7F\u5F97\u524D\u7AEF\u7684\u7F16\u7A0B\u65B9\u5F0F\u4ECE<strong>\u547D\u4EE4\u5F0F</strong>\uFF0C\u5373\u76F4\u63A5\u64CD\u7EB5 DOM\uFF0C\u544A\u8BC9\u6D4F\u89C8\u5668\u8BE5\u600E\u4E48\u5E72\u3002\u8FD9\u6837\u7684\u95EE\u9898\u5C31\u662F\uFF0C\u5927\u91CF\u7684\u4EE3\u7801\u88AB\u7528\u4E8E\u64CD\u4F5C DOM \u5143\u7D20\uFF0C\u4E14\u4EE3\u7801\u53EF\u8BFB\u6027\u5DEE\uFF0C\u53EF\u7EF4\u62A4\u6027\u4F4E\u3002 \u53D8\u6210\u4E86<strong>\u58F0\u660E\u5F0F</strong>\uFF0C\u6452\u5F03\u4E86\u76F4\u63A5\u64CD\u4F5C DOM \u7684\u7EC6\u8282\uFF0C\u53EA\u5173\u6CE8\u6570\u636E\u7684\u53D8\u52A8\uFF0CDOM \u64CD\u4F5C\u7531\u6846\u67B6\u6765\u5B8C\u6210\uFF0C\u4ECE\u800C\u5927\u5E45\u5EA6\u63D0\u5347\u4E86\u4EE3\u7801\u7684\u53EF\u8BFB\u6027\u548C\u53EF\u7EF4\u62A4\u6027\u3002</p><p>\u800C<code>diff</code>\u7684\u51FA\u73B0\uFF0C\u53EF\u4EE5\u907F\u514D\u6570\u636E\u53D8\u52A8\u7684\u5BFC\u81F4\u6574\u4E2A\u9875\u9762\u7684\u5237\u65B0\uFF0C\u6240\u4EE5\u5C31\u6709\u4E86 <code>Diff</code> \u8FC7\u7A0B\uFF0C\u5C06\u6570\u636E\u53D8\u52A8\u524D\u540E\u7684 <code>DOM</code> \u7ED3\u6784\u5148\u8FDB\u884C\u6BD4\u8F83\uFF0C\u627E\u51FA\u4E24\u8005\u7684\u4E0D\u540C\u5904\uFF0C\u7136\u540E\u518D\u5BF9\u4E0D\u540C\u4E4B\u5904\u8FDB\u884C\u66F4\u65B0\u6E32\u67D3\u3002</p><p>\u4F46\u662F\u7531\u4E8E\u6574\u4E2A DOM \u7ED3\u6784\u53C8\u592A\u5927\uFF0C\u6240\u4EE5\u91C7\u7528\u4E86\u66F4\u8F7B\u91CF\u7EA7\u7684\u5BF9 DOM \u7684\u63CF\u8FF0\u2014<strong>\u865A\u62DF DOM</strong>\u3002</p><p>\u4F18\u70B9</p><ul><li>Virtual DOM \u5728\u727A\u7272(\u727A\u7272\u5F88\u5173\u952E)\u90E8\u5206\u6027\u80FD\u7684\u524D\u63D0\u4E0B\uFF0C\u589E\u52A0\u4E86\u53EF\u7EF4\u62A4\u6027\uFF0C\u8FD9\u4E5F\u662F\u5F88\u591A\u6846\u67B6\u7684\u901A\u6027\u3002</li><li>\u5B9E\u73B0\u4E86\u5BF9 DOM \u7684\u96C6\u4E2D\u5316\u64CD\u4F5C\uFF0C\u5728\u6570\u636E\u6539\u53D8\u65F6\u5148\u5BF9\u865A\u62DF DOM \u8FDB\u884C\u4FEE\u6539\uFF0C\u518D\u53CD\u6620\u5230\u771F\u5B9E\u7684 DOM \u4E2D\uFF0C\u7528\u6700\u5C0F\u7684\u4EE3\u4EF7\u6765\u66F4\u65B0 DOM\uFF0C\u63D0\u9AD8\u6548\u7387(\u63D0\u5347\u6548\u7387\u8981\u60F3\u60F3\u662F\u8DDF\u54EA\u4E2A\u9636\u6BB5\u6BD4\u63D0\u5347\u4E86\u6548\u7387\uFF0C\u522B\u53EA\u8BB0\u4F4F\u4E86\u8FD9\u4E00\u6761)\u3002</li><li>\u6253\u5F00\u4E86\u51FD\u6570\u5F0F UI \u7F16\u7A0B\u7684\u5927\u95E8\u3002</li><li>\u53EF\u4EE5\u6E32\u67D3\u5230 DOM \u4EE5\u5916\u7684\u7AEF\uFF0C\u4F7F\u5F97\u6846\u67B6\u8DE8\u5E73\u53F0\uFF0C\u6BD4\u5982 ReactNative\uFF0CReact VR \u7B49\u3002</li><li>\u53EF\u4EE5\u66F4\u597D\u7684\u5B9E\u73B0 SSR\uFF0C\u540C\u6784\u6E32\u67D3\u7B49\u3002\u8FD9\u6761\u5176\u5B9E\u662F\u8DDF\u4E0A\u9762\u4E00\u6761\u5DEE\u4E0D\u591A\u7684\u3002</li><li>\u7EC4\u4EF6\u7684\u9AD8\u5EA6\u62BD\u8C61\u5316\u3002</li></ul><p>\u7F3A\u70B9</p><ul><li>\u9996\u6B21\u6E32\u67D3\u5927\u91CF DOM \u65F6\uFF0C\u7531\u4E8E\u591A\u4E86\u4E00\u5C42\u865A\u62DF DOM \u7684\u8BA1\u7B97\uFF0C\u4F1A\u6BD4 innerHTML \u63D2\u5165\u6162\u3002</li><li>\u865A\u62DF DOM \u9700\u8981\u5728\u5185\u5B58\u4E2D\u7684\u7EF4\u62A4\u4E00\u4EFD DOM \u7684\u526F\u672C(\u66F4\u4E0A\u9762\u4E00\u6761\u5176\u5B9E\u4E5F\u5DEE\u4E0D\u591A\uFF0C\u4E0A\u9762\u4E00\u6761\u662F\u4ECE\u901F\u5EA6\u4E0A\uFF0C\u8FD9\u6761\u662F\u7A7A\u95F4\u4E0A)\u3002</li><li>\u5982\u679C\u865A\u62DF DOM \u5927\u91CF\u66F4\u6539\uFF0C\u8FD9\u662F\u5408\u9002\u7684\u3002\u4F46\u662F\u5355\u4E00\u7684\uFF0C\u9891\u7E41\u7684\u66F4\u65B0\u7684\u8BDD\uFF0C\u865A\u62DF DOM \u5C06\u4F1A\u82B1\u8D39\u66F4\u591A\u7684\u65F6\u95F4\u5904\u7406\u8BA1\u7B97\u7684\u5DE5\u4F5C\u3002\u6240\u4EE5\uFF0C\u5982\u679C\u4F60\u6709\u4E00\u4E2A DOM \u8282\u70B9\u76F8\u5BF9\u8F83\u5C11\u9875\u9762\uFF0C\u7528\u865A\u62DF DOM\uFF0C\u5B83\u5B9E\u9645\u4E0A\u6709\u53EF\u80FD\u4F1A\u66F4\u6162\u3002\u4F46\u5BF9\u4E8E\u5927\u591A\u6570\u5355\u9875\u9762\u5E94\u7528\uFF0C\u8FD9\u5E94\u8BE5\u90FD\u4F1A\u66F4\u5FEB\u3002</li></ul><p>\u5C24\u96E8\u6EAA\u5927\u4F6C\u77E5\u4E4E\u7684\u56DE\u7B54</p><p><img src="'+g+'" alt=""></p><h2 id="diff\u7B97\u6CD5" tabindex="-1"><a class="header-anchor" href="#diff\u7B97\u6CD5" aria-hidden="true">#</a> Diff\u7B97\u6CD5</h2>',10),Ds={href:"https://mp.weixin.qq.com/s/rd0MjARQcYEPz9FseVgElA",target:"_blank",rel:"noopener noreferrer"},Is=s("React \u548C Vue \u7684 diff \u65F6\u95F4\u590D\u6742\u5EA6O(n^3) \u548C O(n) \u662F\u5982\u4F55\u8BA1\u7B97\u51FA\u6765\u7684"),Es={href:"https://github.com/sisterAn/blog/issues/22",target:"_blank",rel:"noopener noreferrer"},Os=s("\u8BA8\u8BBA"),Ts={href:"https://mp.weixin.qq.com/s/_jAW4Z3VR-uW0AEnjHgAEw",target:"_blank",rel:"noopener noreferrer"},zs=s("\u8BE6\u89E3 React 16 \u7684 Diff \u7B56\u7565"),As=n("p",null,"\u5982\u4F55\u5C06\u4F20\u7EDFO(n^3)Diff\u7B97\u6CD5\u7684\u65F6\u95F4\u590D\u6742\u5EA6\u964D\u4E3AO(n)",-1),Ns=n("p",null,"\u539F\u6765\u7684 O(n^3) \u7684 diff \u6D41\u7A0B\u662F\uFF1A",-1),Ls=n("p",null,"\u8001\u6811\u7684\u6BCF\u4E00\u4E2A\u8282\u70B9\u90FD\u53BB\u904D\u5386\u65B0\u6811\u7684\u8282\u70B9\uFF0C\u76F4\u5230\u627E\u5230\u65B0\u6811\u5BF9\u5E94\u7684\u8282\u70B9\u3002\u90A3\u4E48\u8FD9\u4E2A\u6D41\u7A0B\u5C31\u662F O(n^2)\uFF0C\u518D\u7D27\u63A5\u7740\u627E\u5230\u4E0D\u540C\u4E4B\u540E\uFF0C\u518D\u8BA1\u7B97\u6700\u77ED\u4FEE\u6539\u8DDD\u79BB\u7136\u540E\u4FEE\u6539\u8282\u70B9\uFF0C\u8FD9\u91CC\u662F O(n^3)",-1),qs=s("\u76F8\u5173Leetcode\u9898\u76EE"),Us={href:"https://leetcode-cn.com/problems/edit-distance/",target:"_blank",rel:"noopener noreferrer"},Ws=s("\u7F16\u8F91\u8DDD\u79BB"),Bs=o(`<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Diff\u7B97\u6CD5 =&gt; O(n^3) =&gt; \u5C06\u4E24\u4E2ADOM\u6811\u7684\u6240\u6709\u8282\u70B9\u4E24\u4E24\u5BF9\u6BD4\uFF0C\u65F6\u95F4\u590D\u6742\u5EA6 O(n^2)
      prev                   last   

       A                         A
     /   \\                     /   \\
    D     B        =&gt;         B     D
  /                                  \\
 C                                    C

  \u6240\u6709\u8282\u70B9\u4E24\u4E24\u76F8\u4E92\u5BF9\u6BD4\uFF1A
  pA =&gt; lA
  pA =&gt; lB
  pA =&gt; lD
  pA =&gt; lC
  ...
  pC =&gt; lC

\u518D\u8FDB\u884C\u6811\u7684\u7F16\u8F91(\u63D2\u5165\u3001\u66FF\u6362\u3001\u5220\u9664)\u9700\u8981\u904D\u5386\u4E00\u6B21\uFF0C\u56E0\u6B64\u65F6\u95F4\u590D\u6742\u5EA6\u4E3A O(n^3)
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>React \u5728\u4EE5\u4E0B\u4E09\u4E2A\u5047\u8BBE\u7684\u57FA\u7840\u4E4B\u4E0A\u63D0\u51FA\u4E86\u4E00\u5957 O(n) \u7684\u542F\u53D1\u5F0F\u7B97\u6CD5\uFF1A</p><ol><li>\u53EA\u5BF9\u540C\u7EA7\u5143\u7D20\u8FDB\u884CDiff\u3002\u5982\u679C\u4E00\u4E2ADOM\u8282\u70B9\u5728\u524D\u540E\u4E24\u6B21\u66F4\u65B0\u4E2D\u8DE8\u8D8A\u4E86\u5C42\u7EA7\uFF0C\u90A3\u4E48React\u4E0D\u4F1A\u5C1D\u8BD5\u590D\u7528\u4ED6\u3002</li><li>\u4E24\u4E2A\u4E0D\u540C\u7C7B\u578B\u7684\u5143\u7D20\u4F1A\u4EA7\u751F\u51FA\u4E0D\u540C\u7684\u6811\uFF1B</li><li>\u5F00\u53D1\u8005\u53EF\u4EE5\u901A\u8FC7 <code>key prop</code> \u6765\u6697\u793A\u54EA\u4E9B\u5B50\u5143\u7D20\uFF08\u540C\u7EA7\u7684\u8282\u70B9\uFF09\u5728\u4E0D\u540C\u7684\u6E32\u67D3\u4E0B\u80FD\u4FDD\u6301\u7A33\u5B9A\uFF1B</li></ol><p>O(n^3)=&gt; O(n) =&gt; \u7B80\u5355\u7C97\u66B4\uFF0C\u6240\u6709\u7684\u8282\u70B9\u6309\u5C42\u7EA7\u6BD4\u8F83\uFF0C\u53EA\u4F1A\u904D\u5386\u4E00\u6B21</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u6309\u53F6\u5B50\u8282\u70B9\u4F4D\u7F6E\u6BD4\u8F83
 [0,0]           :  pA =&gt; lA      #\u76F8\u540C\uFF0C\u4E0D\u7406\u4F1A
 [0.0,0.0]       :  pD =&gt; lB      #\u4E0D\u540C\uFF0C\u5220\u9664pD\uFF0C\u6DFB\u52A0lB
 [0.1,0.1]      :  pB =&gt; lD      #\u4E0D\u540C\uFF0C\u5220\u9664pB\uFF0C\u6DFB\u52A0lD
 [0.1.0,0.1.0]  :  pC =&gt; Null   #last\u6811\u6CA1\u6709\u8BE5\u8282\u70B9\uFF0C\u76F4\u63A5\u5220\u9664pC
 [0.1.2,0.1.2]  :  Null =&gt; lC    #prev\u6811\u6CA1\u6709\u8BE5\u8282\u70B9\uFF0C\u6DFB\u52A0lC\u5230\u8BE5\u4F4D\u7F6E
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>\u6982\u5FF5</strong></p><p>\u4E00\u4E2ADOM\u8282\u70B9\u5728\u67D0\u4E00\u65F6\u523B\u6700\u591A\u4F1A\u67094\u4E2A\u8282\u70B9\u548C\u4ED6\u76F8\u5173\u3002</p><ol><li><p><code>current Fiber</code>\u3002\u5982\u679C\u8BE5DOM\u8282\u70B9\u5DF2\u5728\u9875\u9762\u4E2D\uFF0C<code>current Fiber</code>\u4EE3\u8868\u8BE5DOM\u8282\u70B9\u5BF9\u5E94\u7684Fiber\u8282\u70B9\u3002</p></li><li><p><code>workInProgress Fiber</code>\u3002\u5982\u679C\u8BE5DOM\u8282\u70B9\u5C06\u5728\u672C\u6B21\u66F4\u65B0\u4E2D\u6E32\u67D3\u5230\u9875\u9762\u4E2D\uFF0C<code>workInProgress Fiber</code>\u4EE3\u8868\u8BE5DOM\u8282\u70B9\u5BF9\u5E94\u7684Fiber\u8282\u70B9\u3002</p></li><li><p>DOM\u8282\u70B9\u672C\u8EAB\u3002</p></li><li><p>JSX\u5BF9\u8C61\u3002\u5373<code>ClassComponent</code>\u7684<code>render</code>\u65B9\u6CD5\u7684\u8FD4\u56DE\u7ED3\u679C\uFF0C\u6216<code>FunctionComponent</code>\u7684\u8C03\u7528\u7ED3\u679C\u3002JSX\u5BF9\u8C61\u4E2D\u5305\u542B\u63CF\u8FF0DOM\u8282\u70B9\u7684\u4FE1\u606F\u3002</p></li></ol><p>Diff\u7B97\u6CD5\u7684\u672C\u8D28\u662F\u5BF9\u6BD41\u548C4\uFF0C\u751F\u62102\u3002</p><p><code>Diff</code>\u7684\u5165\u53E3\u51FD\u6570<code>reconcileChildFibers</code>\u51FA\u53D1\uFF0C\u8BE5\u51FD\u6570\u4F1A\u6839\u636E<code>newChild</code>\uFF08\u5373JSX\u5BF9\u8C61\uFF09\u7C7B\u578B\u8C03\u7528\u4E0D\u540C\u7684\u5904\u7406\u51FD\u6570\u3002</p><div class="language-flow ext-flow line-numbers-mode"><pre class="language-flow"><code><span class="token comment">// \u6839\u636EnewChild\u7C7B\u578B\u9009\u62E9\u4E0D\u540Cdiff\u51FD\u6570\u5904\u7406</span>
<span class="token comment">// \u8FD9\u4E2A\u51FD\u6570\u4E0D\u662F\u9012\u5F52\u7684</span>
<span class="token keyword">function</span> <span class="token function">reconcileChildFibers</span><span class="token punctuation">(</span>
  <span class="token literal-property property">returnFiber</span><span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
  <span class="token literal-property property">currentFirstChild</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token type class-name">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">newChild</span><span class="token operator">:</span> <span class="token type class-name">any</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token type class-name">null</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> isObject <span class="token operator">=</span> <span class="token keyword">typeof</span> newChild <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">&amp;&amp;</span> newChild <span class="token operator">!==</span> <span class="token type class-name">null</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>isObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// object\u7C7B\u578B\uFF0C\u53EF\u80FD\u662F REACT_ELEMENT_TYPE \u6216 REACT_PORTAL_TYPE\u6216REACT_LAZY_TYPE</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>newChild<span class="token punctuation">.</span>$$<span class="token keyword">typeof</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token constant">REACT_ELEMENT_TYPE</span><span class="token operator">:</span>
        <span class="token comment">// \u8C03\u7528 reconcileSingleElement \u5904\u7406</span>
      <span class="token comment">// // ...\u7701\u7565\u5176\u4ED6case</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> newChild <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> newChild <span class="token operator">===</span> <span class="token string">&#39;number&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8C03\u7528 reconcileSingleTextNode \u5904\u7406</span>
    <span class="token comment">// ...\u7701\u7565</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>newChild<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8C03\u7528 reconcileChildrenArray \u5904\u7406</span>
    <span class="token comment">// ...\u7701\u7565</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// \u4E00\u4E9B\u5176\u4ED6\u60C5\u51B5\u8C03\u7528\u5904\u7406\u51FD\u6570</span>
  <span class="token comment">// ...\u7701\u7565</span>

  <span class="token comment">// \u4EE5\u4E0A\u90FD\u6CA1\u6709\u547D\u4E2D\uFF0C\u5220\u9664\u8282\u70B9</span>
  <span class="token keyword">return</span> <span class="token function">deleteRemainingChildren</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> currentFirstChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>\u53EF\u4EE5\u4ECE\u540C\u7EA7\u7684\u8282\u70B9\u6570\u91CF\u5C06Diff\u5206\u4E3A\u4E24\u7C7B\uFF1A</p><ol><li><p>\u5F53<code>newChild</code>\u7C7B\u578B\u4E3A<code>object</code>\u3001<code>number</code>\u3001<code>string</code>\uFF0C\u4EE3\u8868\u540C\u7EA7\u53EA\u6709\u4E00\u4E2A\u8282\u70B9</p></li><li><p>\u5F53<code>newChild</code>\u7C7B\u578B\u4E3A<code>Array</code>\uFF0C\u540C\u7EA7\u6709\u591A\u4E2A\u8282\u70B9</p></li></ol><h4 id="\u5355\u8282\u70B9diff" tabindex="-1"><a class="header-anchor" href="#\u5355\u8282\u70B9diff" aria-hidden="true">#</a> \u5355\u8282\u70B9Diff</h4><p><img src="`+f+`" alt=""></p><p>\u7B2C\u4E8C\u6B65\u5224\u65ADDOM\u8282\u70B9\u662F\u5426\u53EF\u4EE5\u590D\u7528</p><ol><li>\u5148\u5224\u65AD<code>key</code>\u662F\u5426\u76F8\u540C\uFF08<strong>props\u6CA1\u6709key\u503C\u662F<code>null</code></strong>\uFF0C\u5B9E\u9A8C\u6253\u5370\u51FAJsx\u4E2D\u8FD4\u56DE\u7684React Element key\u662Fnull\uFF09</li><li>\u5982\u679Ckey\u76F8\u540C\u5219\u5224\u65ADtype\u662F\u5426\u76F8\u540C\uFF0C\u53EA\u6709\u90FD\u76F8\u540C\u65F6\u4E00\u4E2ADOM\u8282\u70B9\u624D\u80FD\u590D\u7528\u3002</li></ol><h4 id="\u591A\u8282\u70B9diff" tabindex="-1"><a class="header-anchor" href="#\u591A\u8282\u70B9diff" aria-hidden="true">#</a> \u591A\u8282\u70B9diff</h4><p>\u4E00\u51713\u4E2D\u60C5\u51B5</p><ol><li>\u8282\u70B9\u66F4\u65B0</li><li>\u8282\u70B9\u65B0\u589E\u6216\u51CF\u5C11</li><li>\u8282\u70B9\u4F4D\u7F6E\u53D8\u5316</li></ol><p>\u4E3A\u4EC0\u4E48\u6CA1\u6709\u50CFVue\u4E00\u6837\u4F7F\u7528\u53CC\u6307\u9488\u4ECE\u6570\u7EC4\u5934\u548C\u5C3E\u540C\u65F6\u904D\u5386\u4EE5\u63D0\u9AD8\u6548\u7387</p><p>\u867D\u7136\u672C\u6B21\u66F4\u65B0\u7684JSX\u5BF9\u8C61 newChildren\u4E3A\u6570\u7EC4\u5F62\u5F0F\uFF0C\u4F46\u662F\u548CnewChildren\u4E2D\u6BCF\u4E2A\u7EC4\u4EF6\u8FDB\u884C\u6BD4\u8F83\u7684\u662Fcurrent fiber\uFF0C<strong>\u540C\u7EA7\u7684Fiber\u8282\u70B9\u662F\u7531sibling\u6307\u9488\u94FE\u63A5\u5F62\u6210\u7684\u5355\u94FE\u8868</strong>\uFF0C<strong>\u5373\u4E0D\u652F\u6301\u53CC\u6307\u9488\u904D\u5386</strong>\u3002</p><p>\u5728\u65E5\u5E38\u5F00\u53D1\u4E2D\uFF0C\u76F8\u8F83\u4E8E\u65B0\u589E\u548C\u5220\u9664\uFF0C\u66F4\u65B0\u7EC4\u4EF6\u53D1\u751F\u7684\u9891\u7387\u66F4\u9AD8\u3002\u6240\u4EE5Diff\u4F1A\u4F18\u5148\u5224\u65AD\u5F53\u524D\u8282\u70B9\u662F\u5426\u5C5E\u4E8E\u66F4\u65B0\u3002</p><p>Diff\u7B97\u6CD5\u7684\u6574\u4F53\u903B\u8F91\u4F1A\u7ECF\u5386\u4E24\u8F6E\u904D\u5386\uFF1A</p><p>\u7B2C\u4E00\u8F6E\u904D\u5386\uFF1A\u5904\u7406\u66F4\u65B0\u7684\u8282\u70B9\u3002</p><p>\u7B2C\u4E8C\u8F6E\u904D\u5386\uFF1A\u5904\u7406\u5269\u4E0B\u7684\u4E0D\u5C5E\u4E8E\u66F4\u65B0\u7684\u8282\u70B9\u3002</p><h4 id="\u7B2C\u4E00\u8F6E\u904D\u5386" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E00\u8F6E\u904D\u5386" aria-hidden="true">#</a> \u7B2C\u4E00\u8F6E\u904D\u5386</h4><ol><li><p><code>let i = 0</code>\uFF0C\u904D\u5386<code>newChildren</code>\uFF0C\u5C06<code>newChildren[i]</code>\u4E0E<code>oldFiber</code>\u6BD4\u8F83\uFF0C\u5224\u65ADDOM\u8282\u70B9\u662F\u5426\u53EF\u590D\u7528\u3002</p></li><li><p>\u5982\u679C\u53EF\u590D\u7528\uFF0C<code>i++</code>\uFF0C\u7EE7\u7EED\u6BD4\u8F83<code>newChildren[i]</code>\u4E0E<code>oldFiber.sibling</code>\uFF0C\u53EF\u4EE5\u590D\u7528\u5219\u7EE7\u7EED\u904D\u5386\u3002</p></li><li><p>\u5982\u679C\u4E0D\u53EF\u590D\u7528\uFF0C\u5206\u4E24\u79CD\u60C5\u51B5\uFF1A</p></li></ol><ul><li><p><code>key</code>\u4E0D\u540C\u5BFC\u81F4\u4E0D\u53EF\u590D\u7528\uFF0C\u7ACB\u5373\u8DF3\u51FA\u6574\u4E2A\u904D\u5386\uFF0C\u7B2C\u4E00\u8F6E\u904D\u5386\u7ED3\u675F\u3002</p></li><li><p><code>key</code>\u76F8\u540C<code>type</code>\u4E0D\u540C\u5BFC\u81F4\u4E0D\u53EF\u590D\u7528\uFF0C\u4F1A\u5C06<code>oldFiber</code>\u6807\u8BB0\u4E3A<code>DELETION</code>\uFF0C\u5E76\u7EE7\u7EED\u904D\u5386</p></li></ul><ol start="4"><li>\u5982\u679C<code>newChildren</code>\u904D\u5386\u5B8C\uFF08\u5373<code>i === newChildren.length - 1</code>\uFF09\u6216\u8005<code>oldFiber</code>\u904D\u5386\u5B8C\uFF08\u5373<code>oldFiber.sibling === null</code>\uFF09\uFF0C\u8DF3\u51FA\u904D\u5386\uFF0C\u7B2C\u4E00\u8F6E\u904D\u5386\u7ED3\u675F\u3002</li></ol><p>\u5F53\u904D\u5386\u7ED3\u675F\u540E\uFF0C\u4F1A\u6709\u4E24\u79CD\u7ED3\u679C\uFF1A <strong>\u6B65\u9AA43\u8DF3\u51FA\u7684\u904D\u5386</strong>: \u6B64\u65F6<code>newChildren</code>\u6CA1\u6709\u904D\u5386\u5B8C\uFF0C<code>oldFiber</code>\u4E5F\u6CA1\u6709\u904D\u5386\u5B8C\u3002</p><p><strong>\u6B65\u9AA44\u8DF3\u51FA\u7684\u904D\u5386</strong>: \u53EF\u80FD<code>newChildre</code>n\u904D\u5386\u5B8C\uFF0C\u6216<code>oldFiber</code>\u904D\u5386\u5B8C\uFF0C\u6216\u4ED6\u4EEC\u540C\u65F6\u904D\u5386\u5B8C\u3002</p><h4 id="\u7B2C\u4E8C\u8F6E\u904D\u5386" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E8C\u8F6E\u904D\u5386" aria-hidden="true">#</a> \u7B2C\u4E8C\u8F6E\u904D\u5386</h4><ul><li><p>newChildren\u4E0EoldFiber\u540C\u65F6\u904D\u5386\u5B8C: \u90A3\u5C31\u662F\u6700\u7406\u60F3\u7684\u60C5\u51B5\uFF1A\u53EA\u9700\u5728\u7B2C\u4E00\u8F6E\u904D\u5386\u8FDB\u884C\u7EC4\u4EF6\u66F4\u65B0\u3002\u6B64\u65F6<code>Diff</code>\u7ED3\u675F\u3002</p></li><li><p>newChildren\u6CA1\u904D\u5386\u5B8C\uFF0ColdFiber\u904D\u5386\u5B8C: \u5DF2\u6709\u7684DOM\u8282\u70B9\u90FD\u590D\u7528\u4E86\uFF0C\u8FD9\u65F6\u8FD8\u6709\u65B0\u52A0\u5165\u7684\u8282\u70B9\uFF0C\u610F\u5473\u7740\u672C\u6B21\u66F4\u65B0\u6709\u65B0\u8282\u70B9\u63D2\u5165\uFF0C\u53EA\u9700\u8981\u904D\u5386\u5269\u4E0B\u7684<code>newChildren</code>\u4E3A\u751F\u6210\u7684<code>workInProgress fiber</code>\u4F9D\u6B21\u6807\u8BB0<code>Placement</code>\u3002</p></li><li><p>newChildren\u904D\u5386\u5B8C\uFF0ColdFiber\u6CA1\u904D\u5386\u5B8C: \u610F\u5473\u7740\u672C\u6B21\u66F4\u65B0\u6BD4\u4E4B\u524D\u7684\u8282\u70B9\u6570\u91CF\u5C11\uFF0C\u6709\u8282\u70B9\u88AB\u5220\u9664\u4E86\u3002\u6240\u4EE5\u9700\u8981\u904D\u5386\u5269\u4E0B\u7684<code>oldFiber</code>\uFF0C\u4F9D\u6B21\u6807\u8BB0<code>Deletion</code>\u3002</p></li><li><p>newChildren\u4E0EoldFiber\u90FD\u6CA1\u904D\u5386\u5B8C: \u8FD9\u610F\u5473\u7740\u6709\u8282\u70B9\u5728\u8FD9\u6B21\u66F4\u65B0\u4E2D\u6539\u53D8\u4E86\u4F4D\u7F6E\u3002</p><p>\u7531\u4E8E\u6709\u8282\u70B9\u6539\u53D8\u4E86\u4F4D\u7F6E\uFF0C\u6240\u4EE5\u4E0D\u80FD\u518D\u7528\u4F4D\u7F6E\u7D22\u5F15i\u5BF9\u6BD4\u524D\u540E\u7684\u8282\u70B9\uFF0C\u90A3\u4E48\u5982\u4F55\u624D\u80FD\u5C06\u540C\u4E00\u4E2A\u8282\u70B9\u5728\u4E24\u6B21\u66F4\u65B0\u4E2D\u5BF9\u5E94\u4E0A\u5462\uFF1F</p><p>\u9700\u8981\u4F7F\u7528key\u3002</p><p>\u4E3A\u4E86\u5FEB\u901F\u7684\u627E\u5230<code>key</code>\u5BF9\u5E94\u7684<code>oldFiber</code>\uFF0C\u5C06\u6240\u6709\u8FD8\u672A\u5904\u7406\u7684<code>oldFiber</code>\u5B58\u5165\u4EE5<code>key</code>\u4E3A<code>key</code>\uFF0C<code>oldFiber</code>\u4E3A<code>value</code>\u7684<code>Map</code>\u4E2D\u3002</p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> existingChildren <span class="token operator">=</span> <span class="token function">mapRemainingChildren</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> oldFiber<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u63A5\u4E0B\u6765\u904D\u5386\u5269\u4F59\u7684<code>newChildren</code>\uFF0C\u901A\u8FC7<code>newChildren[i].key</code>\u5C31\u80FD\u5728<code>existingChildren</code>\u4E2D\u627E\u5230<code>key</code>\u76F8\u540C\u7684<code>oldFiber</code>\u3002</p><ol><li><code>lastPlacedIndex</code>\u4EE3\u8868\u8001\u8282\u70B9\u5728\u7B2C\u4E00\u8F6E\u904D\u5386\u5B8C\u7684index\uFF0C\u5982\u679C\u7B2C\u4E00\u8F6E\u904D\u5386\u4E2D\u90FD\u4E0D\u80FD\u590D\u7528\uFF0C\u5219\u662F0</li><li>\u5F00\u59CB\u904D\u5386\u6CA1\u6709\u904D\u5386\u7684\u65B0\u8282\u70B9\uFF0C\u5E76\u5728map\u4E2D\u627E\u5230\u90A3\u4E2A\u8001\u8282\u70B9\u3002\u5982\u679C\u6CA1\u6709\u627E\u5230\u5219\u76F4\u63A5\u65B0\u5EFAfiber\u8282\u70B9\u3002\u627E\u5230<code>oldIndex</code></li><li>\u5982\u679C<code>oldIndex &gt; lastPlacedIndex</code>\uFF0C\u5219\u4EE3\u8868\u8282\u70B9\u4F4D\u7F6E\u4E0D\u53D8\uFF0C\u5E76\u4E14\u8D4B\u503C<code>lastPlacedIndex = oldIndex</code></li><li>\u5982\u679C<code>oldIndex &lt; lastPlacedIndex</code>\uFF0C\u7740\u4EE3\u8868<strong>\u8282\u70B9\u8981\u5411\u53F3\u79FB\u52A8</strong>\uFF0C\u4F46<code>lastPlacedIndex</code>\u503C\u4E0D\u53D8\u3002</li></ol><p>Demo1</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// \u4E4B\u524D
abcd

// \u4E4B\u540E
acdb

===\u7B2C\u4E00\u8F6E\u904D\u5386\u5F00\u59CB===
a\uFF08\u4E4B\u540E\uFF09vs a\uFF08\u4E4B\u524D\uFF09  
key\u4E0D\u53D8\uFF0C\u53EF\u590D\u7528
\u6B64\u65F6 a \u5BF9\u5E94\u7684oldFiber\uFF08\u4E4B\u524D\u7684a\uFF09\u5728\u4E4B\u524D\u7684\u6570\u7EC4\uFF08abcd\uFF09\u4E2D\u7D22\u5F15\u4E3A0
\u6240\u4EE5 lastPlacedIndex = 0;

\u7EE7\u7EED\u7B2C\u4E00\u8F6E\u904D\u5386...

c\uFF08\u4E4B\u540E\uFF09vs b\uFF08\u4E4B\u524D\uFF09  
key\u6539\u53D8\uFF0C\u4E0D\u80FD\u590D\u7528\uFF0C\u8DF3\u51FA\u7B2C\u4E00\u8F6E\u904D\u5386
\u6B64\u65F6 lastPlacedIndex === 0;
===\u7B2C\u4E00\u8F6E\u904D\u5386\u7ED3\u675F===

===\u7B2C\u4E8C\u8F6E\u904D\u5386\u5F00\u59CB===
newChildren === cdb\uFF0C\u6CA1\u7528\u5B8C\uFF0C\u4E0D\u9700\u8981\u6267\u884C\u5220\u9664\u65E7\u8282\u70B9
oldFiber === bcd\uFF0C\u6CA1\u7528\u5B8C\uFF0C\u4E0D\u9700\u8981\u6267\u884C\u63D2\u5165\u65B0\u8282\u70B9

\u5C06\u5269\u4F59oldFiber\uFF08bcd\uFF09\u4FDD\u5B58\u4E3Amap

// \u5F53\u524DoldFiber\uFF1Abcd
// \u5F53\u524DnewChildren\uFF1Acdb

\u7EE7\u7EED\u904D\u5386\u5269\u4F59newChildren

key === c \u5728 oldFiber\u4E2D\u5B58\u5728
const oldIndex = c\uFF08\u4E4B\u524D\uFF09.index;
\u6B64\u65F6 oldIndex === 2;  // \u4E4B\u524D\u8282\u70B9\u4E3A abcd\uFF0C\u6240\u4EE5c.index === 2
\u6BD4\u8F83 oldIndex \u4E0E lastPlacedIndex;

\u5982\u679C oldIndex &gt;= lastPlacedIndex \u4EE3\u8868\u8BE5\u53EF\u590D\u7528\u8282\u70B9\u4E0D\u9700\u8981\u79FB\u52A8
\u5E76\u5C06 lastPlacedIndex = oldIndex;
\u5982\u679C oldIndex &lt; lastplacedIndex \u8BE5\u53EF\u590D\u7528\u8282\u70B9\u4E4B\u524D\u63D2\u5165\u7684\u4F4D\u7F6E\u7D22\u5F15\u5C0F\u4E8E\u8FD9\u6B21\u66F4\u65B0\u9700\u8981\u63D2\u5165\u7684\u4F4D\u7F6E\u7D22\u5F15\uFF0C\u4EE3\u8868\u8BE5\u8282\u70B9\u9700\u8981\u5411\u53F3\u79FB\u52A8

\u5728\u4F8B\u5B50\u4E2D\uFF0ColdIndex 2 &gt; lastPlacedIndex 0\uFF0C
\u5219 lastPlacedIndex = 2;
c\u8282\u70B9\u4F4D\u7F6E\u4E0D\u53D8

\u7EE7\u7EED\u904D\u5386\u5269\u4F59newChildren

// \u5F53\u524DoldFiber\uFF1Abd
// \u5F53\u524DnewChildren\uFF1Adb

key === d \u5728 oldFiber\u4E2D\u5B58\u5728
const oldIndex = d\uFF08\u4E4B\u524D\uFF09.index;
oldIndex 3 &gt; lastPlacedIndex 2 // \u4E4B\u524D\u8282\u70B9\u4E3A abcd\uFF0C\u6240\u4EE5d.index === 3
\u5219 lastPlacedIndex = 3;
d\u8282\u70B9\u4F4D\u7F6E\u4E0D\u53D8

\u7EE7\u7EED\u904D\u5386\u5269\u4F59newChildren

// \u5F53\u524DoldFiber\uFF1Ab
// \u5F53\u524DnewChildren\uFF1Ab

key === b \u5728 oldFiber\u4E2D\u5B58\u5728
const oldIndex = b\uFF08\u4E4B\u524D\uFF09.index;
oldIndex 1 &lt; lastPlacedIndex 3 // \u4E4B\u524D\u8282\u70B9\u4E3A abcd\uFF0C\u6240\u4EE5b.index === 1
\u5219 b\u8282\u70B9\u9700\u8981\u5411\u53F3\u79FB\u52A8
===\u7B2C\u4E8C\u8F6E\u904D\u5386\u7ED3\u675F===

\u6700\u7EC8acd 3\u4E2A\u8282\u70B9\u90FD\u6CA1\u6709\u79FB\u52A8\uFF0Cb\u8282\u70B9\u88AB\u6807\u8BB0\u4E3A\u79FB\u52A8

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p>demo2</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// \u4E4B\u524D
abcd

// \u4E4B\u540E
dabc

===\u7B2C\u4E00\u8F6E\u904D\u5386\u5F00\u59CB===
d\uFF08\u4E4B\u540E\uFF09vs a\uFF08\u4E4B\u524D\uFF09  
key\u6539\u53D8\uFF0C\u4E0D\u80FD\u590D\u7528\uFF0C\u8DF3\u51FA\u904D\u5386
===\u7B2C\u4E00\u8F6E\u904D\u5386\u7ED3\u675F===

===\u7B2C\u4E8C\u8F6E\u904D\u5386\u5F00\u59CB===
newChildren === dabc\uFF0C\u6CA1\u7528\u5B8C\uFF0C\u4E0D\u9700\u8981\u6267\u884C\u5220\u9664\u65E7\u8282\u70B9
oldFiber === abcd\uFF0C\u6CA1\u7528\u5B8C\uFF0C\u4E0D\u9700\u8981\u6267\u884C\u63D2\u5165\u65B0\u8282\u70B9

\u5C06\u5269\u4F59oldFiber\uFF08abcd\uFF09\u4FDD\u5B58\u4E3Amap

\u7EE7\u7EED\u904D\u5386\u5269\u4F59newChildren

// \u5F53\u524DoldFiber\uFF1Aabcd
// \u5F53\u524DnewChildren dabc

key === d \u5728 oldFiber\u4E2D\u5B58\u5728
const oldIndex = d\uFF08\u4E4B\u524D\uFF09.index;
\u6B64\u65F6 oldIndex === 3; // \u4E4B\u524D\u8282\u70B9\u4E3A abcd\uFF0C\u6240\u4EE5d.index === 3
\u6BD4\u8F83 oldIndex \u4E0E lastPlacedIndex;
oldIndex 3 &gt; lastPlacedIndex 0
\u5219 lastPlacedIndex = 3;
d\u8282\u70B9\u4F4D\u7F6E\u4E0D\u53D8

\u7EE7\u7EED\u904D\u5386\u5269\u4F59newChildren

// \u5F53\u524DoldFiber\uFF1Aabc
// \u5F53\u524DnewChildren abc

key === a \u5728 oldFiber\u4E2D\u5B58\u5728
const oldIndex = a\uFF08\u4E4B\u524D\uFF09.index; // \u4E4B\u524D\u8282\u70B9\u4E3A abcd\uFF0C\u6240\u4EE5a.index === 0
\u6B64\u65F6 oldIndex === 0;
\u6BD4\u8F83 oldIndex \u4E0E lastPlacedIndex;
oldIndex 0 &lt; lastPlacedIndex 3
\u5219 a\u8282\u70B9\u9700\u8981\u5411\u53F3\u79FB\u52A8

\u7EE7\u7EED\u904D\u5386\u5269\u4F59newChildren

// \u5F53\u524DoldFiber\uFF1Abc
// \u5F53\u524DnewChildren bc

key === b \u5728 oldFiber\u4E2D\u5B58\u5728
const oldIndex = b\uFF08\u4E4B\u524D\uFF09.index; // \u4E4B\u524D\u8282\u70B9\u4E3A abcd\uFF0C\u6240\u4EE5b.index === 1
\u6B64\u65F6 oldIndex === 1;
\u6BD4\u8F83 oldIndex \u4E0E lastPlacedIndex;
oldIndex 1 &lt; lastPlacedIndex 3
\u5219 b\u8282\u70B9\u9700\u8981\u5411\u53F3\u79FB\u52A8

\u7EE7\u7EED\u904D\u5386\u5269\u4F59newChildren

// \u5F53\u524DoldFiber\uFF1Ac
// \u5F53\u524DnewChildren c

key === c \u5728 oldFiber\u4E2D\u5B58\u5728
const oldIndex = c\uFF08\u4E4B\u524D\uFF09.index; // \u4E4B\u524D\u8282\u70B9\u4E3A abcd\uFF0C\u6240\u4EE5c.index === 2
\u6B64\u65F6 oldIndex === 2;
\u6BD4\u8F83 oldIndex \u4E0E lastPlacedIndex;
oldIndex 2 &lt; lastPlacedIndex 3
\u5219 c\u8282\u70B9\u9700\u8981\u5411\u53F3\u79FB\u52A8

===\u7B2C\u4E8C\u8F6E\u904D\u5386\u7ED3\u675F===
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u6211\u4EEC\u4EE5\u4E3A\u4ECE abcd \u53D8\u4E3A dabc\uFF0C\u53EA\u9700\u8981\u5C06d\u79FB\u52A8\u5230\u524D\u9762\u3002</p><p>\u4F46\u5B9E\u9645\u4E0AReact\u4FDD\u6301d\u4E0D\u53D8\uFF0C\u5C06abc\u5206\u522B\u79FB\u52A8\u5230\u4E86d\u7684\u540E\u9762\u3002</p><p>\u4ECE\u8FD9\u70B9\u53EF\u4EE5\u770B\u51FA\uFF0C\u8003\u8651\u6027\u80FD\uFF0C\u6211\u4EEC<strong>\u8981\u5C3D\u91CF\u51CF\u5C11\u5C06\u8282\u70B9\u4ECE\u540E\u9762\u79FB\u52A8\u5230\u524D\u9762\u7684\u64CD\u4F5C</strong>\u3002</p><p><strong>React 15\u7684diff\u548CReact16\u7684\u533A\u522B</strong></p><ul><li>React15\u7684\u865A\u62DFdom\u662F\u4E00\u9897\u7531\u4E0A\u81F3\u4E0B\u6DF1\u5EA6\u4F18\u5148\u904D\u5386\u7684\u6811\u7ED3\u6784,\u6BCF\u4E00\u4E2A\u8282\u70B9\u90FD\u662F\u865A\u62DFDOM \u8282\u70B9\uFF0CReact16\u7684\u4E2D\u662F\u94FE\u8868\u5F62\u5F0F\u7684\u865A\u62DF DOM\uFF0C\u94FE\u8868\u7684\u6BCF\u4E00\u4E2A\u8282\u70B9\u662F Fiber\u3002</li><li>15 diff\u9636\u6BB5\u4E0D\u53EF\u4E2D\u65AD\u7684\u9012\u5F52\uFF0C16\u4E2Ddiff\u9636\u6BB5\u66F4\u65B0\u65F6\u662F\u53EF\u4E2D\u65AD\u7684\u5FAA\u73AF\uFF0C\u901A\u8FC7\u6682\u505C\u3001\u7EC8\u6B62\u3001\u590D\u7528\u6E32\u67D3\u4EFB\u52A1\uFF08Alternate\uFF09\u4ECE\u800C\u4F7F\u5F97\u6BCF\u4E00\u4E2Afiber\u7684diff\u4E0Epatch\u53D8\u7684\u53EF\u63A7\u3002</li><li>diff\u8FC7\u7A0B\u4E8Epatch\u7684\u8FC7\u7A0B\u4ECE\u4E4B\u524D\u7684\u9012\u5F52\u6811\u72B6\u7ED3\u6784\uFF0C\u53D8\u6210\u4E00\u4E2A\u5FAA\u73AF\u904D\u5386\u94FE\u8868\u7684\u5F62\u5F0F\u3002</li><li>\u5DE5\u4F5C\u5FAA\u73AF\uFF08requestIdleCallback\uFF09\u3001\u4F18\u5148\u7EA7\u7B56\u7565\u3002</li></ul><h3 id="\u7B14\u8BB0" tabindex="-1"><a class="header-anchor" href="#\u7B14\u8BB0" aria-hidden="true">#</a> \u7B14\u8BB0</h3><p>\u5229\u7528scheduler\uFF08\u76F8\u5F53\u4E8E<code>requestIdleCallback</code> API\uFF09\u8C03\u5EA6\u4EFB\u52A1\uFF0C\u5373\u62C6\u5206\u5F02\u6B65\u7684\u4E00\u4E2A\u4E00\u4E2A\u5F97\u6784\u5EFAfiber\u8282\u70B9\u3002\u5F85\u6784\u5EFA\u5B8C\u6210\uFF0C\u518D\u540C\u6B65\u904D\u5386fiber\u6811\uFF0C<code>appendChild</code>\u6DFB\u52A0dom</p><h2 id="react\u61D2\u52A0\u8F7D" tabindex="-1"><a class="header-anchor" href="#react\u61D2\u52A0\u8F7D" aria-hidden="true">#</a> React\u61D2\u52A0\u8F7D</h2><h3 id="_1-\u4EE3\u7801\u5206\u5272" tabindex="-1"><a class="header-anchor" href="#_1-\u4EE3\u7801\u5206\u5272" aria-hidden="true">#</a> 1.\u4EE3\u7801\u5206\u5272</h3><p>\uFF081\uFF09\u4E3A\u4EC0\u4E48\u8981\u8FDB\u884C\u4EE3\u7801\u5206\u5272\uFF1F \u524D\u7AEF\u9879\u76EE\u57FA\u672C\u90FD\u91C7\u7528\u6253\u5305\u6280\u672F\uFF0C\u6BD4\u5982 <code>Webpack</code>\uFF0CJS\u903B\u8F91\u4EE3\u7801\u6253\u5305\u540E\u4F1A\u4EA7\u751F\u4E00\u4E2A <code>bundle.js</code> \u6587\u4EF6\uFF0C\u800C\u968F\u7740\u5F15\u7528\u7684\u7B2C\u4E09\u65B9\u5E93\u8D8A\u6765\u8D8A\u591A\u6216\u4E1A\u52A1\u903B\u8F91\u4EE3\u7801\u8D8A\u6765\u8D8A\u590D\u6742\uFF0C\u76F8\u5E94\u6253\u5305\u597D\u7684 <code>bundle.js</code> \u6587\u4EF6\u4F53\u79EF\u5C31\u4F1A\u8D8A\u6765\u8D8A\u5927\uFF0C\u56E0\u4E3A\u9700\u8981\u5148\u8BF7\u6C42\u52A0\u8F7D\u8D44\u6E90\u4E4B\u540E\uFF0C\u624D\u4F1A\u6E32\u67D3\u9875\u9762\uFF0C\u8FD9\u5C31\u4F1A\u4E25\u91CD\u5F71\u54CD\u5230\u9875\u9762\u7684\u9996\u5C4F\u52A0\u8F7D\u3002</p><p>\u800C\u4E3A\u4E86\u89E3\u51B3\u8FD9\u6837\u7684\u95EE\u9898\uFF0C\u907F\u514D\u5927\u4F53\u79EF\u7684\u4EE3\u7801\u5305\uFF0C\u5219\u53EF\u4EE5\u901A\u8FC7\u6280\u672F\u624B\u6BB5\u5BF9\u4EE3\u7801\u5305\u8FDB\u884C\u5206\u5272\uFF0C\u80FD\u591F\u521B\u5EFA\u591A\u4E2A\u5305\u5E76\u5728\u8FD0\u884C\u65F6\u52A8\u6001\u5730\u52A0\u8F7D\u3002\u73B0\u5728\u50CF Webpack\u7B49\u6253\u5305\u5668\u90FD\u652F\u6301\u4EE3\u7801\u5206\u5272\u6280\u672F</p><p>\uFF082\uFF09\u4EC0\u4E48\u65F6\u5019\u5E94\u8BE5\u8003\u8651\u8FDB\u884C\u4EE3\u7801\u5206\u5272\uFF1F</p><p>\u8FD9\u91CC\u4E3E\u4E00\u4E2A\u5E73\u65F6\u5F00\u53D1\u4E2D\u53EF\u80FD\u4F1A\u9047\u5230\u7684\u573A\u666F\uFF0C\u6BD4\u5982\u67D0\u4E2A\u4F53\u79EF\u76F8\u5BF9\u6BD4\u8F83\u5927\u7684\u7B2C\u4E09\u65B9\u5E93\u6216\u63D2\u4EF6\uFF08\u6BD4\u5982JS\u7248\u7684PDF\u9884\u89C8\u5E93\uFF09\u53EA\u5728\u5355\u9875\u5E94\u7528\uFF08SPA\uFF09\u7684\u67D0\u4E00\u4E2A\u4E0D\u662F\u9996\u9875\u7684\u9875\u9762\u4F7F\u7528\u4E86\uFF0C\u8FD9\u79CD\u60C5\u51B5\u5C31\u53EF\u4EE5\u8003\u8651\u4EE3\u7801\u5206\u5272\uFF0C\u589E\u52A0\u9996\u5C4F\u7684\u52A0\u8F7D\u901F\u5EA6\u3002</p><h3 id="_2-react\u7684\u61D2\u52A0\u8F7D" tabindex="-1"><a class="header-anchor" href="#_2-react\u7684\u61D2\u52A0\u8F7D" aria-hidden="true">#</a> 2.React\u7684\u61D2\u52A0\u8F7D</h3><p>example\uFF1A</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> OtherComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./OtherComponent&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">OtherComponent</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Suspense</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u5982\u4E0A\u4EE3\u7801\u4E2D\uFF0C\u901A\u8FC7 <code>import()</code>\u3001<code>React.lazy</code> \u548C <code>Suspense</code> \u5171\u540C\u4E00\u8D77\u5B9E\u73B0\u4E86 <code>React</code> \u7684\u61D2\u52A0\u8F7D\uFF0C\u4E5F\u5C31\u662F\u5E38\u8BF4\u4E86\u8FD0\u884C\u65F6\u52A8\u6001\u52A0\u8F7D\uFF0C\u5373 <code>OtherComponent</code> \u7EC4\u4EF6\u6587\u4EF6\u88AB\u62C6\u5206\u6253\u5305\u4E3A\u4E00\u4E2A\u65B0\u7684\u5305\uFF08bundle\uFF09\u6587\u4EF6\uFF0C\u5E76\u4E14\u53EA\u4F1A\u5728 OtherComponent \u7EC4\u4EF6\u6E32\u67D3\u65F6\uFF0C\u624D\u4F1A\u88AB\u4E0B\u8F7D\u5230\u672C\u5730\u3002</p><h3 id="_3-import-\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_3-import-\u539F\u7406" aria-hidden="true">#</a> 3. import() \u539F\u7406</h3><p>import() \u51FD\u6570\u662F\u7531TS39\u63D0\u51FA\u7684\u4E00\u79CD\u52A8\u6001\u52A0\u8F7D\u6A21\u5757\u7684\u89C4\u8303\u5B9E\u73B0\uFF0C\u5176\u8FD4\u56DE\u662F\u4E00\u4E2A promise\u3002\u5728\u6D4F\u89C8\u5668\u5BBF\u4E3B\u73AF\u5883\u4E2D\u4E00\u4E2A<code>import()</code>\u7684\u53C2\u8003\u5B9E\u73B0\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> tempGlobal <span class="token operator">=</span> <span class="token string">&quot;__tempModuleLoadingVariable&quot;</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">import * as m from &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;; window.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>tempGlobal<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = m;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>

    script<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>window<span class="token punctuation">[</span>tempGlobal<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">delete</span> window<span class="token punctuation">[</span>tempGlobal<span class="token punctuation">]</span><span class="token punctuation">;</span>
      script<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    script<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to load module script with URL &quot;</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">delete</span> window<span class="token punctuation">[</span>tempGlobal<span class="token punctuation">]</span><span class="token punctuation">;</span>
      script<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>\u5F53 Webpack \u89E3\u6790\u5230\u8BE5import()\u8BED\u6CD5\u65F6\uFF0C\u4F1A\u81EA\u52A8\u8FDB\u884C\u4EE3\u7801\u5206\u5272\u3002</p><h3 id="_4-react-lazy-\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_4-react-lazy-\u539F\u7406" aria-hidden="true">#</a> 4. React.lazy \u539F\u7406</h3><div class="language-flow ext-flow line-numbers-mode"><pre class="language-flow"><code><span class="token keyword">export</span> <span class="token keyword">function</span> lazy<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>ctor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Thenable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> LazyComponent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> lazyType <span class="token operator">=</span> <span class="token punctuation">{</span>
    $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token constant">REACT_LAZY_TYPE</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_ctor</span><span class="token operator">:</span> ctor<span class="token punctuation">,</span>
    <span class="token comment">// React uses these fields to store the result.</span>
    <span class="token literal-property property">_status</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_result</span><span class="token operator">:</span> <span class="token type class-name">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> lazyType<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u53EF\u4EE5\u770B\u5230\u5176\u8FD4\u56DE\u4E86\u4E00\u4E2A <code>LazyComponent</code> \u5BF9\u8C61\u3002</p><p>\u800C\u5BF9\u4E8E LazyComponent \u5BF9\u8C61\u7684\u89E3\u6790\uFF1A</p><details class="custom-container details"><summary>\u5B9E\u73B0</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">case</span> <span class="token literal-property property">LazyComponent</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> elementType <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>elementType<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">mountLazyComponent</span><span class="token punctuation">(</span>
    current<span class="token punctuation">,</span>
    workInProgress<span class="token punctuation">,</span>
    elementType<span class="token punctuation">,</span>
    updateExpirationTime<span class="token punctuation">,</span>
    renderExpirationTime<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">mountLazyComponent</span><span class="token punctuation">(</span>
  <span class="token parameter">_current<span class="token punctuation">,</span>
  workInProgress<span class="token punctuation">,</span>
  elementType<span class="token punctuation">,</span>
  updateExpirationTime<span class="token punctuation">,</span>
  renderExpirationTime</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token comment">// ...</span>
  <span class="token keyword">let</span> Component <span class="token operator">=</span> <span class="token function">readLazyComponentType</span><span class="token punctuation">(</span>elementType<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Pending = 0, Resolved = 1, Rejected = 2</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> readLazyComponentType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>lazyComponent<span class="token operator">:</span> LazyComponent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> status <span class="token operator">=</span> lazyComponent<span class="token punctuation">.</span>_status<span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> lazyComponent<span class="token punctuation">.</span>_result<span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token literal-property property">Resolved</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token literal-property property">Component</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">=</span> result<span class="token punctuation">;</span>
      <span class="token keyword">return</span> Component<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token literal-property property">Rejected</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token literal-property property">error</span><span class="token operator">:</span> mixed <span class="token operator">=</span> result<span class="token punctuation">;</span>
      <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token literal-property property">Pending</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token literal-property property">thenable</span><span class="token operator">:</span> Thenable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> mixed<span class="token operator">&gt;</span> <span class="token operator">=</span> result<span class="token punctuation">;</span>
      <span class="token keyword">throw</span> thenable<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// lazyComponent \u9996\u6B21\u88AB\u6E32\u67D3</span>
      lazyComponent<span class="token punctuation">.</span>_status <span class="token operator">=</span> Pending<span class="token punctuation">;</span>
      <span class="token keyword">const</span> ctor <span class="token operator">=</span> lazyComponent<span class="token punctuation">.</span>_ctor<span class="token punctuation">;</span>
      <span class="token keyword">const</span> thenable <span class="token operator">=</span> <span class="token function">ctor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      thenable<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
        <span class="token parameter">moduleObject</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>lazyComponent<span class="token punctuation">.</span>_status <span class="token operator">===</span> Pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> defaultExport <span class="token operator">=</span> moduleObject<span class="token punctuation">.</span>default<span class="token punctuation">;</span>
            lazyComponent<span class="token punctuation">.</span>_status <span class="token operator">=</span> Resolved<span class="token punctuation">;</span>
            lazyComponent<span class="token punctuation">.</span>_result <span class="token operator">=</span> defaultExport<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>lazyComponent<span class="token punctuation">.</span>_status <span class="token operator">===</span> Pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lazyComponent<span class="token punctuation">.</span>_status <span class="token operator">=</span> Rejected<span class="token punctuation">;</span>
            lazyComponent<span class="token punctuation">.</span>_result <span class="token operator">=</span> error<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Handle synchronous thenables.</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>lazyComponent<span class="token punctuation">.</span>_status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token literal-property property">Resolved</span><span class="token operator">:</span>
          <span class="token keyword">return</span> lazyComponent<span class="token punctuation">.</span>_result<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token literal-property property">Rejected</span><span class="token operator">:</span>
          <span class="token keyword">throw</span> lazyComponent<span class="token punctuation">.</span>_result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      lazyComponent<span class="token punctuation">.</span>_result <span class="token operator">=</span> thenable<span class="token punctuation">;</span>
      <span class="token keyword">throw</span> thenable<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div></details><p>\u6CE8\uFF1A\u5982\u679C <code>readLazyComponentType</code> \u51FD\u6570\u591A\u6B21\u5904\u7406\u540C\u4E00\u4E2A <code>lazyComponent</code>\uFF0C\u5219\u53EF\u80FD\u8FDB\u5165<code>Pending\u3001Rejected</code>\u7B49 case \u4E2D\u3002</p><p>\u4ECE\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u53EF\u4EE5\u770B\u51FA\uFF0C\u5BF9\u4E8E\u6700\u521D React.lazy() \u6240\u8FD4\u56DE\u7684 LazyComponent \u5BF9\u8C61\uFF0C\u5176 _status \u9ED8\u8BA4\u662F -1\uFF0C\u6240\u4EE5\u9996\u6B21\u6E32\u67D3\u65F6\uFF0C\u4F1A\u8FDB\u5165 readLazyComponentType \u51FD\u6570\u4E2D\u7684 default \u7684\u903B\u8F91\uFF0C\u8FD9\u91CC\u624D\u4F1A\u771F\u6B63\u5F02\u6B65\u6267\u884C import(url)\u64CD\u4F5C\uFF0C\u7531\u4E8E\u5E76\u672A\u7B49\u5F85\uFF0C\u968F\u540E\u4F1A\u68C0\u67E5\u6A21\u5757\u662F\u5426 Resolved\uFF0C\u5982\u679C\u5DF2\u7ECFResolved\u4E86\uFF08\u5DF2\u7ECF\u52A0\u8F7D\u5B8C\u6BD5\uFF09\u5219\u76F4\u63A5\u8FD4\u56DEmoduleObject.default\uFF08\u52A8\u6001\u52A0\u8F7D\u7684\u6A21\u5757\u7684\u9ED8\u8BA4\u5BFC\u51FA\uFF09\uFF0C\u5426\u5219\u5C06\u901A\u8FC7 throw \u5C06 thenable \u629B\u51FA\u5230\u4E0A\u5C42\u3002</p><p>\u4E3A\u4EC0\u4E48\u8981 throw \u5B83\uFF1F\u8FD9\u5C31\u8981\u6D89\u53CA\u5230 Suspense \u7684\u5DE5\u4F5C\u539F\u7406\u3002</p><h3 id="_5-suspense-\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_5-suspense-\u539F\u7406" aria-hidden="true">#</a> 5. Suspense \u539F\u7406</h3><p>React \u6355\u83B7\u5230\u5F02\u5E38\u4E4B\u540E\uFF0C\u4F1A\u5224\u65AD\u5F02\u5E38\u662F\u4E0D\u662F\u4E00\u4E2A <code>thenable</code>\uFF0C\u5982\u679C\u662F\u5219\u4F1A\u627E\u5230 <code>SuspenseComponent</code> \uFF0C\u5982\u679C <code>thenable</code> \u5904\u4E8E pending \u72B6\u6001\uFF0C\u5219\u4F1A\u5C06\u5176 children \u90FD\u6E32\u67D3\u6210 fallback \u7684\u503C\uFF0C\u4E00\u65E6 <code>thenable</code> \u88AB resolve \u5219 <code>SuspenseComponent</code> \u7684\u5B50\u7EC4\u4EF6\u4F1A\u91CD\u65B0\u6E32\u67D3\u4E00\u6B21\u3002</p><p>\u4E3A\u4E86\u4FBF\u4E8E\u7406\u89E3\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u7528 <code>componentDidCatch</code> \u5B9E\u73B0\u4E00\u4E2A\u81EA\u5DF1\u7684 <code>Suspense</code> \u7EC4\u4EF6\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Suspense</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">promise</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5224\u65AD err \u662F\u5426\u662F thenable</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> err <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> err<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">promise</span><span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        err<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">promise</span><span class="token operator">:</span> <span class="token keyword">null</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> fallback<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">const</span> <span class="token punctuation">{</span> promise <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> promise <span class="token operator">?</span> fallback <span class="token operator">:</span> children <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><img src="`+y+'" alt=""></p><h2 id="react17-18\u65B0\u7279\u6027" tabindex="-1"><a class="header-anchor" href="#react17-18\u65B0\u7279\u6027" aria-hidden="true">#</a> React17/18\u65B0\u7279\u6027</h2><h3 id="react17" tabindex="-1"><a class="header-anchor" href="#react17" aria-hidden="true">#</a> React17</h3><p>React17 \u662F\u4E00\u4E2A\u7528\u4EE5\u7A33\u5B9ACM\u7684\u8FC7\u6E21\u7248\u672C\u3002</p><ul><li>\u5B9E\u73B0\u591A\u7248\u672C\u5171\u5B58: \u4E8B\u4EF6\u59D4\u6258\u4ECEattach\u5230document\u7684\u4EE3\u7406\uFF0C\u53D8\u6210\u4E86\u4E8B\u4EF6 <code>attach</code> \u5230 React \u6E32\u67D3\u6811\u7684\u6839 <code>DOM</code> \u5BB9\u5668\u4E2D</li><li>\u65B0\u7684\u4F18\u5148\u7EA7\u7B97\u6CD5 - lanes</li></ul><h3 id="react-18" tabindex="-1"><a class="header-anchor" href="#react-18" aria-hidden="true">#</a> React 18</h3><ul><li>createRoot\uFF0C\u9ED8\u8BA4\u5F00\u542F\u4E86\u5E76\u53D1\u6E32\u67D3\uFF0CcreateBlockingRoot \u51FD\u6570\u521B\u5EFA\u7684 blocking \u6A21\u5F0F</li><li>\u6279\u5904\u7406\u7684\u4F18\u5316</li><li>startTransition</li><li>useDeferredValue</li><li>SSR \u4E0B\u7684\u61D2\u52A0\u8F7D\u652F\u6301</li></ul><p><img src="'+w+'" alt=""></p>',82),Js={id:"strictmode",tabindex:"-1"},Vs=n("a",{class:"header-anchor",href:"#strictmode","aria-hidden":"true"},"#",-1),Ys=s(),Gs={href:"https://zh-hans.reactjs.org/docs/strict-mode.html#detecting-unexpected-side-effects",target:"_blank",rel:"noopener noreferrer"},Hs=s("StrictMode"),Xs=o(`<p>react17 \u5176\u5B9E\u4E5F\u662F\u6267\u884C\u4E86\u4E24\u6B21render phase \uFF0C\u4F1A\u8C03\u7528\u4E24\u6B21render\uFF0Cconstructor\u65B9\u6CD5\u3002\u4F46\u662F\u7531\u4E8E\u6211\u4EEC\u7ECF\u5E38\u7528<code>console.log</code> \u53BB\u8BA4\u4E3A\u5C31\u662F\u6267\u884C\u6B21\u6570\uFF0C\u800Creact\u53C8\u5BF9\u7B2C\u4E8C\u6B21\u8C03\u7528\u505A\u4E86\u9759\u9ED8\u5904\u7406\u3002\u7528<code>alert</code>\u4EE3\u66FF\uFF0C\u6216\u8005<code>debugger</code>\u5C31\u53EF\u4EE5\u770B\u5230\u8C03\u7528\u4E24\u6B21\u7684\u6548\u679C\u3002</p><p>\u800C\u5BF9\u4E8Ereact17\uFF0C\u53EA\u662F\u91CD\u65B0\u8C03\u7528render phase\uFF08constructor\u8DDFrender\u7B49\u751F\u547D\u5468\u671F\uFF09\uFF0C\u6240\u4EE5componentDidMount\uFF0CuseEffect\u90FD\u53EA\u8C03\u7528\u4E00\u6B21\uFF0C\u800Creact18\u662F\u76F4\u63A5unmounting and remounting the component\uFF0C\u6240\u4EE5componentDidMount\uFF0CuseEffect\u4E5F\u4F1A\u6267\u884C\u4E24\u6B21</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">ExampleComponent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Effect setup code...</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Effect cleanup code...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Layout effect setup code...</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Layout effect cleanup code...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Render stuff...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>This component declares some effects to be run on mount and unmount. Normally these effects would only be run once (after the component is initially mounted) and the cleanup functions would be run once (after the component is unmounted). In React 18 Strict Mode, the following will happen:</p><ul><li>React renders the component.</li><li>React mounts the component</li><li>Layout effect setup code runs.</li><li>Effect setup code runs.</li><li>React simulates the component being hidden or unmounted. <ul><li>Layout effect cleanup code runs</li><li>Effect cleanup code runs</li></ul></li><li>React simulates the component being shown again or remounted. <ul><li>Layout effect setup code runs</li><li>Effect setup code runs</li></ul></li></ul><h2 id="react-fast-refresh" tabindex="-1"><a class="header-anchor" href="#react-fast-refresh" aria-hidden="true">#</a> React fast refresh</h2>`,6),$s={href:"http://www.ayqy.net/blog/fast-refresh-under-the-hood/",target:"_blank",rel:"noopener noreferrer"},Qs=s("Fast Refresh\u539F\u7406\u5256\u6790"),Zs=n("h2",{id:"re-render",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#re-render","aria-hidden":"true"},"#"),s(" re-render")],-1),Ks={href:"https://www.developerway.com/posts/react-re-renders-guide",target:"_blank",rel:"noopener noreferrer"},na=s("React re-renders guide: everything, all at once"),sa=s("\u7FFB\u8BD1\uFF1A"),aa={href:"https://zhuanlan.zhihu.com/p/554118692",target:"_blank",rel:"noopener noreferrer"},pa=s("React \u91CD\u65B0\u6E32\u67D3\uFF1A\u6700\u4F73\u5B9E\u8DF5"),ea=n("h3",{id:"forwardref",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#forwardref","aria-hidden":"true"},"#"),s(" forwardRef")],-1),ta=n("code",null,"React.forwardRef(render)",-1),oa=s("\u7684\u8FD4\u56DE\u503C\u662Freact\u7EC4\u4EF6\uFF0C\u63A5\u6536\u7684\u53C2\u6570\u662F\u4E00\u4E2A "),ca=n("code",null,"render",-1),la=s("\u51FD\u6570\uFF0C\u51FD\u6570\u7B7E\u540D\u4E3A"),ra=n("code",null,"render(props, ref)",-1),ua=s("\uFF0C\u7B2C\u4E8C\u4E2A\u53C2\u6570\u5C06\u5176\u63A5\u53D7\u7684 "),ia={href:"https://react.docschina.org/docs/refs-and-the-dom.html",target:"_blank",rel:"noopener noreferrer"},ka=n("code",null,"ref",-1),da=s(" \u5C5E\u6027\u8F6C\u53D1\u5230render\u8FD4\u56DE\u7684\u7EC4\u4EF6\u4E2D\u3002"),ba=o(`<p>\u4E24\u79CD\u573A\u666F\u4E2D\u7279\u522B\u6709\u7528:</p><ul><li>\u8F6C\u53D1 <code>ref</code> \u5230\u7EC4\u4EF6\u5185\u90E8\u7684DOM\u8282\u70B9\u4E0A</li><li>\u5728\u9AD8\u9636\u7EC4\u4EF6\u4E2D\u8F6C\u53D1ref</li></ul><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> FancyButton <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> ref<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FancyButton<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// You can now get a ref directly to the DOM button:</span>
<span class="token keyword">const</span> ref <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FancyButton</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Click me!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">FancyButton</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div>`,3);function ma(ha,ga){const t=c("ExternalLinkIcon"),p=c("RouterLink");return r(),u(i,null,[n("p",null,[n("a",x,[v,a(t)])]),n("p",null,[n("a",R,[C,a(t)])]),n("p",null,[n("a",P,[S,a(t)])]),n("p",null,[n("a",F,[j,a(t)])]),n("p",null,[n("a",M,[D,a(t)])]),n("p",null,[n("a",I,[E,a(t)])]),n("p",null,[n("a",O,[T,a(t)])]),n("p",null,[n("a",z,[A,a(t)]),N,n("a",L,[q,a(t)])]),n("p",null,[n("a",U,[W,a(t)])]),B,n("nav",J,[n("ul",null,[n("li",null,[a(p,{to:"#\u6982\u8FF0"},{default:e(()=>[V]),_:1})]),n("li",null,[a(p,{to:"#react15\u67B6\u6784"},{default:e(()=>[Y]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#reconciler"},{default:e(()=>[G]),_:1})]),n("li",null,[a(p,{to:"#renderer-\u6E32\u67D3\u5668"},{default:e(()=>[H]),_:1})])])]),n("li",null,[a(p,{to:"#react16\u67B6\u6784"},{default:e(()=>[X]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#react16\u7684\u7EC4\u4EF6\u7C7B\u578B"},{default:e(()=>[$]),_:1})])])]),n("li",null,[a(p,{to:"#\u51FD\u6570\u5F0F\u7EC4\u4EF6"},{default:e(()=>[Q]),_:1})]),n("li",null,[a(p,{to:"#jsx\u7B80\u4ECB"},{default:e(()=>[Z]),_:1})]),n("li",null,[a(p,{to:"#fiber"},{default:e(()=>[K]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#\u53CC\u7F13\u5B58fiber\u6811"},{default:e(()=>[nn]),_:1})]),n("li",null,[a(p,{to:"#fiber\u662F\u5982\u4F55\u5DE5\u4F5C\u7684"},{default:e(()=>[sn]),_:1})])])]),n("li",null,[a(p,{to:"#\u751F\u547D\u5468\u671F"},{default:e(()=>[an]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#react16-3-0\u4E4B\u524D\u751F\u547D\u5468\u671F"},{default:e(()=>[pn]),_:1})]),n("li",null,[a(p,{to:"#react16-3-0\u4E4B\u540E\u7684\u751F\u547D\u5468\u671F"},{default:e(()=>[en]),_:1})])])]),n("li",null,[a(p,{to:"#\u53D7\u63A7\u4E0E\u975E\u53D7\u63A7\u7EC4\u4EF6"},{default:e(()=>[tn]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#note"},{default:e(()=>[on]),_:1})])])]),n("li",null,[a(p,{to:"#setstate"},{default:e(()=>[cn]),_:1})]),n("li",null,[a(p,{to:"#react\u5408\u6210\u4E8B\u4EF6"},{default:e(()=>[ln]),_:1})]),n("li",null,[a(p,{to:"#react-purecomponent\u4E0Ereact-memo"},{default:e(()=>[rn]),_:1})]),n("li",null,[a(p,{to:"#react\u7EC4\u4EF6\u5230\u5E95\u4EC0\u4E48\u65F6\u5019render"},{default:e(()=>[un]),_:1})]),n("li",null,[a(p,{to:"#\u9AD8\u9636\u7EC4\u4EF6"},{default:e(()=>[kn]),_:1})]),n("li",null,[a(p,{to:"#render-props"},{default:e(()=>[dn]),_:1})]),n("li",null,[a(p,{to:"#\u771F\u5B9Edom\u64CD\u4F5C\u548Cvirtual-dom"},{default:e(()=>[bn]),_:1})]),n("li",null,[a(p,{to:"#diff\u7B97\u6CD5"},{default:e(()=>[mn]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#\u7B14\u8BB0"},{default:e(()=>[hn]),_:1})])])]),n("li",null,[a(p,{to:"#react\u61D2\u52A0\u8F7D"},{default:e(()=>[gn]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#_1-\u4EE3\u7801\u5206\u5272"},{default:e(()=>[fn]),_:1})]),n("li",null,[a(p,{to:"#_2-react\u7684\u61D2\u52A0\u8F7D"},{default:e(()=>[yn]),_:1})]),n("li",null,[a(p,{to:"#_3-import-\u539F\u7406"},{default:e(()=>[wn]),_:1})]),n("li",null,[a(p,{to:"#_4-react-lazy-\u539F\u7406"},{default:e(()=>[_n]),_:1})]),n("li",null,[a(p,{to:"#_5-suspense-\u539F\u7406"},{default:e(()=>[xn]),_:1})])])]),n("li",null,[a(p,{to:"#react17-18\u65B0\u7279\u6027"},{default:e(()=>[vn]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#react17"},{default:e(()=>[Rn]),_:1})]),n("li",null,[a(p,{to:"#react-18"},{default:e(()=>[Cn]),_:1})])])]),n("li",null,[a(p,{to:"#react-fast-refresh"},{default:e(()=>[Pn]),_:1})]),n("li",null,[a(p,{to:"#re-render"},{default:e(()=>[Sn]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#forwardref"},{default:e(()=>[Fn]),_:1})])])])])]),jn,n("p",null,[n("a",Mn,[Dn,a(t)])]),In,n("p",null,[En,On,n("a",Tn,[zn,a(t)]),An,Nn,Ln,qn,Un]),Wn,n("h3",Bn,[Jn,Vn,n("a",Yn,[Gn,a(t)])]),Hn,n("p",null,[n("a",Xn,[$n,a(t)]),Qn]),Zn,n("p",null,[n("a",Kn,[ns,a(t)])]),ss,n("h2",as,[ps,es,n("a",ts,[os,a(t)])]),cs,n("p",null,[n("a",ls,[rs,a(t)])]),us,n("p",null,[n("a",is,[ks,a(t)])]),ds,n("h2",bs,[ms,hs,n("a",gs,[fs,a(t)])]),ys,ws,n("ul",null,[n("li",null,[n("a",_s,[xs,a(t)])])]),vs,n("p",null,[Rs,n("a",Cs,[Ps,a(t)])]),Ss,n("ul",null,[n("li",null,[n("a",Fs,[js,a(t)])])]),Ms,n("ul",null,[n("li",null,[n("p",null,[n("a",Ds,[Is,a(t)])])]),n("li",null,[n("p",null,[n("a",Es,[Os,a(t)])])]),n("li",null,[n("p",null,[n("a",Ts,[zs,a(t)])])])]),As,Ns,Ls,n("p",null,[qs,n("a",Us,[Ws,a(t)])]),Bs,n("h4",Js,[Vs,Ys,n("a",Gs,[Hs,a(t)])]),Xs,n("ul",null,[n("li",null,[n("a",$s,[Qs,a(t)])])]),Zs,n("ul",null,[n("li",null,[n("a",Ks,[na,a(t)])])]),n("p",null,[sa,n("a",aa,[pa,a(t)])]),ea,n("p",null,[ta,oa,ca,la,ra,ua,n("a",ia,[ka,a(t)]),da]),ba],64)}var ya=l(_,[["render",ma],["__file","index.html.vue"]]);export{ya as default};
