import{_ as c,r as l,o as r,c as i,a as s,b as a,w as t,F as u,e as n,d as o}from"./app.a96f585b.js";var d="/assets/bundle1.d3b8ad8c.png",k="/assets/bundle2.2ed8834d.png",b="/assets/bundlebabel.e18a7ff8.png",m="/assets/output1.90d14f09.png",h="/assets/antd.25bed5a5.png",_="/assets/plugin-multi-entry.3c8fd607.png";const g={},y=s("hr",null,null,-1),f={class:"table-of-contents"},v=n("webpack vs rollup"),q=n("\u4E3A\u4EC0\u4E48\u4E0D\u7528 webpack"),x=n("webpack\u6253\u5305\u5B9E\u73B0\u6309\u9700\u52A0\u8F7D"),w=n("\u6B63\u9898rollup"),j=n("first, \u6253\u5305\u4E00\u4E2A js \u6587\u4EF6"),S=n("rollup \u914D\u7F6E\u6587\u4EF6"),E=n("rollup \u63D2\u4EF6"),D=n("\u9879\u76EE\u57FA\u672C\u914D\u7F6E\u8BF4\u660E"),R=n("typescript\u914D\u7F6E"),B=n("babel"),C=n("rollup\u914D\u7F6E"),M=n("\u600E\u4E48\u5904\u7406Typescript"),N=n("\u5982\u4F55\u6392\u9664\u516C\u5171\u4F9D\u8D56\u4E0D\u6253\u5305\u4EC5\u7EC4\u4EF6\u4E2D"),P=n("@rollup/plugin-babel"),z=n("\u5B8C\u6574\u914D\u7F6E"),A=n("\u5982\u4F55\u652F\u6301 scss/less"),F=n("\u7EC4\u4EF6\u6309\u76EE\u5F55\u7ED3\u6784\u8F93\u51FA"),I=n("\u5982\u4F55\u8C03\u8BD5"),T=n("\u603B\u7ED3"),O=n("\u8E29\u5751\u8BB0\u5F55"),J=n("Reference"),V={href:"https://rollupjs.org/guide/en/",target:"_blank",rel:"noopener noreferrer"},L=s("code",null,"rollup",-1),H=n(" \u662F\u4E00\u4E2A "),W=s("code",null,"JavaScript",-1),$=n(" \u6A21\u5757\u6253\u5305\u5668\uFF0C\u5728\u529F\u80FD\u4E0A\u8981\u5B8C\u6210\u7684\u4E8B\u548C"),U=s("code",null,"webpack",-1),Z=n("\u6027\u8D28\u4E00\u6837\uFF0C\u5C31\u662F\u5C06 \u5C0F\u5757\u4EE3\u7801\u7F16\u8BD1\u6210\u5927\u5757\u590D\u6742\u7684\u4EE3\u7801\uFF0C\u4F8B\u5982 "),Y=s("code",null,"library",-1),G=n(" \u6216\u5E94\u7528\u7A0B\u5E8F\u3002\u4F46\u5E94\u7528\u7A0B\u5E8F"),K=s("code",null,"webpack",-1),Q=n("\u90FD\u662F\u9996\u9009\uFF0C\u76F8\u6BD4\u4E4B\u4E0B\uFF0C"),X=s("code",null,"rollup",-1),ss=n("\u66F4\u591A\u662F\u7528\u4E8E "),ns=s("code",null,"library",-1),as=n(" \u6253\u5305\uFF0C\u6BD4\u5982\u719F\u6089 \u7684"),es={href:"https://github.com/vuejs/vue/blob/main/scripts/config.js",target:"_blank",rel:"noopener noreferrer"},ps=n("vue"),ts=n("\u3001"),os={href:"https://github.com/facebook/react/tree/main/scripts/rollup",target:"_blank",rel:"noopener noreferrer"},ls=n("react"),cs=n("\u3001"),rs=s("code",null,"vuex",-1),is=n("\u3001 \u7B49\u90FD\u662F\u7528 "),us=s("code",null,"rollup",-1),ds=n(" \u8FDB\u884C\u6253\u5305\u7684\u3002"),ks=s("h2",{id:"webpack-vs-rollup",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#webpack-vs-rollup","aria-hidden":"true"},"#"),n(" webpack vs rollup")],-1),bs=s("blockquote",null,[s("p",null,"webpack \u66F4\u9002\u5408\u5BF9\u4E8E\u5E94\u7528\u7684\u6253\u5305\uFF0Crollup \u66F4\u9002\u5408\u5BF9\u4E8E\u5E93\u7684\u6253\u5305\u3002")],-1),ms=s("h3",{id:"\u4E3A\u4EC0\u4E48\u4E0D\u7528-webpack",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u4E3A\u4EC0\u4E48\u4E0D\u7528-webpack","aria-hidden":"true"},"#"),n(" \u4E3A\u4EC0\u4E48\u4E0D\u7528 webpack")],-1),hs=n("webpack \u6253\u5305\u6210"),_s=s("code",null,"ES module",-1),gs=n("\u5728\u76EE\u524D\u7248\u672C"),ys=s("code",null,"5.74.0",-1),fs=n("\u8FD8\u662F\u5B9E\u9A8C\u6027\u8D28\u7684 Api\uFF0C\u89C1"),vs={href:"https://webpack.js.org/configuration/output/#type-module",target:"_blank",rel:"noopener noreferrer"},qs=n("output-type"),xs=n("\uFF0C \u800C"),ws={href:"https://juejin.cn/post/7135217402983235592",target:"_blank",rel:"noopener noreferrer"},js=s("code",null,"tree-shaking",-1),Ss=n(" \u662F\u5EFA\u7ACB\u5728"),Es=s("code",null,"ES module",-1),Ds=n("\u4E4B\u4E0A\u7684\uFF0C\u65E0\u8BBA\u662F\u4F5C\u4E3A\u4E00\u4E2A JS library \u8FD8 \u662F\u7EC4\u4EF6\u5E93\uFF0C\u8FD9\u4E2A\u7279\u6027\u5728 2022 \u5E74\u7684\u4ECA\u5929\u90FD\u662F\u5FC5\u5907\u53EF\u5C11\u7684\uFF08tree-shaking \u6309\u9700\u52A0\u8F7D\uFF09\u3002\u800C\u8FD9\u4E2A\u6070\u597D\u662F "),Rs=s("code",null,"rollup",-1),Bs=n(" \u7684\u5F3A\u9879\uFF0C\u8981\u77E5\u9053 "),Cs=s("code",null,"tree-shaking",-1),Ms=n(" \u5C31\u662F rollup \u7387\u5148\u63D0\u51FA\u7684\u3002"),Ns=s("li",null,[n("webpack \u6253\u5305\u540E\u5F97\u4EE3\u7801\u4E0D\u7CBE\u7B80\uFF0C\u6CE8\u5165\u4EE3\u7801\u591A\uFF0C\u6BD4\u5982webpack\u6253\u5305\u7684\u6587\u4EF6\u4F1A\u6DFB\u52A0\u4E00\u4E9B\u81EA\u5B9A\u4E49\u7684\u6A21\u5757\u52A0\u8F7D\u4EE3\u7801"),s("code",null,"__webpack_require__"),n("\u7B49\u5DE5\u5177\u51FD\u6570\uFF0C\u8FD9\u4E9B\u662F\u4E00\u4E2Alibrary \u5E93\u6240\u4E0D\u9700\u8981\u7684\u3002\u6253\u5305\u540E\u7684\u4F53\u79EF\u4E5F\u6BD4 "),s("code",null,"rollup"),n(" \u7684\u5927\u3002")],-1),Ps=s("li",null,[n("rollup Api \u66F4\u7B80\u5355\u7EAF\u7CB9\uFF08\u53EA\u662F\u76F8\u6BD4 webpack, config option \u8FD8\u662F\u633A\u591A\u7684\uFF0C\u4F46\u6838\u5FC3api\u5C31\u90A3\u51E0\u4E2A\uFF0C\u5176\u5B9E\u5927\u90E8\u5206\u7528\u4E0D\u4E0A)\uFF0C\u66F4\u5BB9\u6613\u914D\u7F6E\u51FA\u81EA\u5DF1\u60F3\u8981\u7684 "),s("code",null,"output")],-1),zs=o(`<p>\u800C <code>Webpack </code>\u5BF9\u4E8E\u4EE3\u7801\u5206\u5272\u3001\u9759\u6001\u8D44\u6E90\u5BFC\u5165\u3001\u70ED\u66F4\u65B0\u3001dev server\u7B49\u6709\u7740\u5148\u5929\u4F18\u52BF\uFF0C\u76F8\u6BD4 <code>rollup</code> \u5927\u800C\u5168\uFF0C\u6240\u4EE5\u66F4\u9002\u5408 App \u6253\u5305\u3002\u6240\u4EE5\u5E38\u8BF4<em>Rollup for libraries, Webpack for apps</em></p><h3 id="webpack\u6253\u5305\u5B9E\u73B0\u6309\u9700\u52A0\u8F7D" tabindex="-1"><a class="header-anchor" href="#webpack\u6253\u5305\u5B9E\u73B0\u6309\u9700\u52A0\u8F7D" aria-hidden="true">#</a> webpack\u6253\u5305\u5B9E\u73B0\u6309\u9700\u52A0\u8F7D</h3><p>\u5176\u5B9E <code>webpack</code> \u5728\u4E0D\u5F00\u542F\u5B9E\u9A8C\u6027\u8D28\u8F93\u51FA<code>ES module</code>\u800C\u662F\u8F93\u51FA<code>cjs</code>\u4E0B\uFF0C\u4E5F\u80FD\u5B9E\u73B0\u6309\u9700\u52A0\u8F7D\uFF0C\u4F46\u8981<strong>\u501F\u52A9 babel \u63D2\u4EF6</strong>\uFF0C\u5373\u50CF<code>element-ui</code>\u8FD9\u6837</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;element-ui&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,4),As=n("\u6253\u5305\u8F93\u51FA\u7684\u662F "),Fs=s("code",null,"cjs",-1),Is=n("\uFF0C\u4F46\u662F\u6309"),Ts=s("strong",null,"\u56FA\u5B9A\u7684\u6587\u4EF6\u5939\u76EE\u5F55\u8F93\u51FA",-1),Os=n("\uFF0C\u5373\u4F60\u7684\u6BCF\u4E2A\u51FD\u6570\u6216\u8005\u7EC4\u4EF6\u7684\u5165\u53E3\u90FD\u662F "),Js=s("code",null,"webpack",-1),Vs=n(" \u914D\u7F6E\u7684"),Ls=s("code",null,"entry",-1),Hs=n("\uFF0C\u628A\u6BCF\u4E2A\u7EC4\u4EF6\u6253\u5305\u6210\u4E00\u4E2A\u5355\u72EC \u7684\u6587\u4EF6\uFF0C\u518D\u914D\u5408\u63D2\u4EF6"),Ws={href:"https://www.npmjs.com/package/babel-plugin-component",target:"_blank",rel:"noopener noreferrer"},$s=n("babel-plugin-component"),Us=n("\uFF0C\u5C31\u4F1A\u8F6C\u6210"),Zs=o(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> button <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;element-ui/lib/button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;element-ui/lib/theme-chalk/button.css&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u540C\u65F6\u5B9E\u73B0\u4E86js\u548Ccss\u7684\u6309\u9700\u52A0\u8F7D\u3002</p>`,2),Ys=n("\u8001\u7248\u672C\u7684 "),Gs=s("code",null,"ant-design",-1),Ks=n(" \u4E5F\u662F\u7C7B\u4F3C\u7684\uFF0C\u4F7F\u7528"),Qs={href:"https://www.npmjs.com/package/babel-plugin-import",target:"_blank",rel:"noopener noreferrer"},Xs=n("babel-plugin-import"),sn=n("\u6309\u9700\u52A0\u8F7D js \u548C css \u6587\u4EF6\uFF0C\u6700\u65B0\u7684\u4E5F\u662F\u4F7F\u7528\u6253\u5305\u6210 ES module "),nn=s("code",null,"tree-shaking",-1),an=n("\u4E86\u3002 "),en=s("code",null,"babel-plugin-import",-1),pn=n(" \u63D2\u4EF6\u901A\u8FC7"),tn=s("strong",null,"\u5F15\u5165\u56FA\u5B9A\u8DEF\u5F84",-1),on=n("\u7684\u7EC4\u4EF6\u53CA\u7EC4\u4EF6 \u6837\u5F0F\uFF0C\u66FF\u4EE3\u624B\u52A8 shaking \u7684\u8FC7\u7A0B\u3002\u7531\u6B64\u4E5F\u53EF\u4EE5\u786E\u5B9A\u6253\u5305\u540E\u7684\u6587\u4EF6\u8DEF\u5F84\uFF08\u7EC4\u4EF6\u8981\u6C42 lib/xx\uFF0C\u6837\u5F0F\u6587\u4EF6\u8981\u6C42 lib/xx/style/xx\uFF09\u548C\u6587\u4EF6\u6A21 \u5757"),ln=s("strong",null,"CommonJs",-1),cn=o(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span>xxxx<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// then</span>
<span class="token keyword">var</span> _button <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;antd/lib/button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;antd/lib/button/style/css&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>_button<span class="token operator">&gt;</span>xxxx<span class="token operator">&lt;</span><span class="token operator">/</span>_button<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u4F46\u90FD 2022 \u5E74\u4E86\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u76F4\u63A5 pass \u5427\u3002</p><h2 id="\u6B63\u9898rollup" tabindex="-1"><a class="header-anchor" href="#\u6B63\u9898rollup" aria-hidden="true">#</a> \u6B63\u9898rollup</h2><h3 id="first-\u6253\u5305\u4E00\u4E2A-js-\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#first-\u6253\u5305\u4E00\u4E2A-js-\u6587\u4EF6" aria-hidden="true">#</a> first, \u6253\u5305\u4E00\u4E2A js \u6587\u4EF6</h3><p>\u521D\u59CB\u5316</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token string">&quot;rollup-react-component-library&quot;</span>
<span class="token builtin class-name">cd</span> rollup-react-component-library
<span class="token function">pnpm</span> init
<span class="token function">pnpm</span> <span class="token function">add</span> rollup -D
<span class="token function">mkdir</span> src
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5728 <code>package.json</code> \u7684 <code>script</code> \u5B57\u6BB5\u4E2D\u6DFB\u52A0\u5E76\u6267\u884C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token string">&quot;dev&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rollup -i src/index.js -o dist/bundle.js -f es&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="`+d+`" alt=""></p><p>\u5728\u8FD9\u6BB5\u6307\u4EE4\u4E2D\uFF1A</p><ul><li><p><code>-i</code>\u6307\u5B9A\u8981\u6253\u5305\u7684\u6587\u4EF6\uFF0C<code>-i</code>\u662F<code>--input</code>\u7684\u7F29\u5199\u3002</p></li><li><p><code>src/index.js</code>\u662F<code>-i</code>\u7684\u53C2\u6570\uFF0C\u5373\u6253\u5305\u5165\u53E3\u6587\u4EF6\u3002</p></li><li><p><code>-o</code>\u6307\u5B9A\u8F93\u51FA\u7684\u6587\u4EF6\uFF0C\u662F<code>--output.file</code>\u6216<code>--file</code>\u7684\u7F29\u5199\u3002(\u5982\u679C\u6CA1\u6709\u8FD9\u4E2A\u53C2\u6570\uFF0C\u5219\u76F4\u63A5\u8F93\u51FA\u5230\u63A7\u5236\u53F0)</p></li><li><p><code>dist/bundle.js</code>\u662F<code>-o</code>\u7684\u53C2\u6570\uFF0C\u5373\u8F93\u51FA\u6587\u4EF6\u3002</p></li><li><p><code>-f</code>\u6307\u5B9A\u6253\u5305\u6587\u4EF6\u7684\u683C\u5F0F\uFF0C<code>-f</code>\u662F<code>--format</code>\u7684\u7F29\u5199\u3002</p></li><li><p><code>es</code>\u662F<code>-f</code>\u7684\u53C2\u6570\uFF0C\u8868\u793A\u6253\u5305\u6587\u4EF6\u4F7F\u7528 ES6 \u6A21\u5757\u89C4\u8303\u3002</p></li></ul><p><code>rollup</code> \u652F\u6301\u7684\u6253\u5305\u6587\u4EF6\u7684\u683C\u5F0F\u6709<code>amd, cjs, es\\esm, iife, umd</code>\u3002\u5176\u4E2D\uFF0Camd \u4E3A AMD \u6807\u51C6\uFF0Ccjs \u4E3A CommonJS \u6807\u51C6(NodeJs)\uFF0Cesm\\es \u4E3A ES \u6A21\u5757\u6807\u51C6\uFF0Ciife \u4E3A\u7ACB\u5373\u8C03\u7528\u51FD\u6570(\u6D4F\u89C8\u5668)\uFF0C <code>umd</code>\u540C\u65F6\u652F\u6301 amd\u3001cjs \u548C iife\u3002</p><h3 id="rollup-\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#rollup-\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> rollup \u914D\u7F6E\u6587\u4EF6</h3><p>\u5728\u5B9E\u9645\u7684\u5DE5\u7A0B\u4E2D\uFF0C\u90FD\u662F\u4F7F\u7528\u914D\u7F6E\u6587\u4EF6\uFF0C\u8FD9\u4E0D\u4EC5\u53EF\u4EE5\u7B80\u5316\u547D\u4EE4\u884C\u64CD\u4F5C\uFF0C\u540C\u65F6\u8FD8\u80FD\u542F\u7528 <code>rollup</code> \u7684\u9AD8\u7EA7\u7279\u6027\u3002</p><p>\u5728\u9879\u76EE\u6839\u76EE\u5F55\u4E0B\u521B\u5EFA<code>rollup.config.js</code>\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&#39;./dist/my-lib-umd.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;umd&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// \u5F53\u5165\u53E3\u6587\u4EF6\u6709export\u65F6\uFF0C&#39;umd&#39;\u683C\u5F0F\u5FC5\u987B\u6307\u5B9Aname</span>
      <span class="token comment">// \u8FD9\u6837\uFF0C\u5728\u901A\u8FC7&lt;script&gt;\u6807\u7B7E\u5F15\u5165\u65F6\uFF0C\u624D\u80FD\u901A\u8FC7name\u8BBF\u95EE\u5230export\u7684\u5185\u5BB9\u3002</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;myLib&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&#39;./dist/my-lib-es.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;es&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&#39;./dist/my-lib-cjs.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;cjs&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>\u4F7F\u7528 <code>Rollup</code> \u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u53EF\u4EE5\u4F7F\u7528<code>rollup --config</code>\u6216\u8005<code>rollup -c</code>\u6307\u4EE4\u3002</p><div class="language-json5 ext-json5 line-numbers-mode"><pre class="language-json5"><code><span class="token comment">//\u4FEE\u6539package.json\u7684script\u5B57\u6BB5</span>
<span class="token punctuation">{</span>
  <span class="token property unquoted">dev</span><span class="token operator">:</span> <span class="token string">&#39;rollup -c&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u9ED8\u8BA4\u4F7F\u7528rollup.config.js</span>
  <span class="token property unquoted">dev</span><span class="token operator">:</span> <span class="token string">&#39;rollup -c my.config.js&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4F7F\u7528\u81EA\u5B9A\u4E49\u7684\u914D\u7F6E\u6587\u4EF6\uFF0Cmy.config.js</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="`+k+'" alt=""> \u53EF\u4EE5\u770B\u51FA\uFF0C\u540C\u6837\u7684\u5165\u53E3\u6587\u4EF6\uFF0C<code>es</code>\u683C\u5F0F\u7684\u6587\u4EF6\u4F53\u79EF\u6700\u5C0F\u3002</p><p>\u5728\u6CA1\u6709\u5176\u4ED6\u5F00\u53D1\u4F9D\u8D56\uFF0C\u5176\u5B9E\u8FD9\u6837\u4E00\u4E2A\u7B80\u5355\u7684 Js Sdk \u7684\u6253\u5305\u5C31\u914D\u7F6E\u5B8C\u6210\u7684\u4E86\u3002\u4F46\u73B0\u5B9E\u5F80\u5F80\u6CA1\u90A3\u4E48\u7B80\u5355\u554A\u3002</p><h3 id="rollup-\u63D2\u4EF6" tabindex="-1"><a class="header-anchor" href="#rollup-\u63D2\u4EF6" aria-hidden="true">#</a> rollup \u63D2\u4EF6</h3><p>rollup \u63D2\u4EF6\u53EA\u6709\u63D2\u4EF6\u6269\u5C55\u529F\u80FD\uFF0C\u76F8\u5F53\u4E8E\u517C\u987E\u4E86 webpack \u7684<code>loader</code>\u548C<code>plugin</code>\uFF0C\u5E38\u7528\u63D2\u4EF6\uFF1A</p>',22),rn=s("code",null,"@rollup/plugin-node-resolve",-1),un=n(", \u4F7F\u7528"),dn={href:"https://nodejs.org/api/modules.html#all-together",target:"_blank",rel:"noopener noreferrer"},kn=n("node resolution algorithm "),bn=n("\u67E5\u627E \u6A21\u5757\uFF0C\u8BA9 rollup \u80FD\u591F\u8BC6\u522B"),mn=s("code",null,"node_modules",-1),hn=n("\u7684\u7B2C\u4E09\u65B9\u6A21\u5757\u3002\u8FD9\u4E9B"),_n=s("code",null,"dependencies",-1),gn=n("\u5E94\u8BE5\u5728"),yn=s("code",null,"package.json",-1),fn=n("\u4E2D\u3002"),vn=o("<li><code>@rollup/plugin-commonjs</code>, rollup \u9ED8\u8BA4\u662F\u4E0D\u652F\u6301 CommonJS \u6A21\u5757\u7684\uFF0C\u5C06 <code>CommonJS </code>\u7684\u6A21\u5757\u8F6C\u6362\u4E3A ES2015 \u4F9B rollup \u5904\u7406\u3002\u6240\u4EE5 \u5E94\u8BE5\u642D\u914D<code>@rollup/plugin-node-resolve</code>\u4F7F\u7528\uFF0C\u53BB\u6253\u5305\u90A3\u4E9B CommonJS dependencies</li><li><code>@rollup/plugin-babel</code>, rollup \u7684\u96C6\u6210 babel \u63D2\u4EF6\uFF0C\u5373\u4F7F\u7528 babel \u7F16\u8BD1\u6587\u4EF6</li><li><code>@rollup/plugin-typescript</code>, \u66F4\u597D\u7684\u96C6\u6210 ts \u7684\u63D2\u4EF6\uFF0C\u6BD4\u5982\u53EF\u4EE5\u505A ts=&gt;js</li><li><code>rollup-plugin-visualizer</code>, \u7C7B\u4F3C webpack-bundle-analyzer,\u4F46\u5C55\u793A\u7684 bundle-size \u56FE\u6CA1\u6709 webpack \u90A3\u4E2A\u597D\u7528</li>",4),qn=s("code",null,"rollup-plugin-terser",-1),xn=n(", "),wn={href:"https://www.npmjs.com/package/terser",target:"_blank",rel:"noopener noreferrer"},jn=n("terser"),Sn=n("\u4EE3\u7801\u538B\u7F29"),En=o("<li><code>rollup-plugin-postcss</code>\uFF0C\u5904\u7406 css\uFF0C\u652F\u6301 css \u6587\u4EF6\u7684\u52A0\u8F7D\u3001css \u52A0\u524D\u7F00\u3001css \u538B\u7F29\u3001scss/less \u7B49</li><li><code>rollup-plugin-peer-deps-external</code>\uFF0C\u81EA\u52A8\u63D0\u53D6 package.json \u4E2D\u7684\u4F9D\u8D56\uFF0C\u518D\u653E\u5165 <code>external</code> \u914D\u7F6E\u4E2D</li><li><code>@rollup/plugin-replace</code>\uFF0C\u6253\u5305\u65F6\u66FF\u6362\u8BBE\u7F6E\u7684\u5B57\u7B26\u4E32</li><li><code>rollup-plugin-dts</code> \u751F\u6210<code>.d.ts</code>\u6587\u4EF6</li>",4),Dn={href:"https://github.com/rollup/plugins",target:"_blank",rel:"noopener noreferrer"},Rn=n("\u5B98\u65B9\u63D2\u4EF6\u5217\u8868"),Bn=s("h2",{id:"\u9879\u76EE\u57FA\u672C\u914D\u7F6E\u8BF4\u660E",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u9879\u76EE\u57FA\u672C\u914D\u7F6E\u8BF4\u660E","aria-hidden":"true"},"#"),n(" \u9879\u76EE\u57FA\u672C\u914D\u7F6E\u8BF4\u660E")],-1),Cn=s("p",null,[n("\u8FD9\u91CC\u6700\u7EC8\u7684\u4EA7\u51FA\u662F\u4E00\u4E2A\u6309\u9700\u52A0\u8F7D\u7684 React \u7EC4\u4EF6\u5E93\uFF0C\u4F7F\u7528\u7684\u6280\u672F\u5373"),s("code",null,"react\u3001typescript\u3001@emotion/react, Material UI")],-1),Mn=n("\u8FD9\u91CC css \u65B9\u6848\u91C7\u7528\u7684 "),Nn=s("code",null,"css-in-js",-1),Pn=n("\uFF0C\u6253\u5305\u4F1A\u6BD4\u5176\u4ED6\u65B9\u6848\u66F4\u7B80\u5355\uFF0C React\u7EC4\u4EF6\u5E93\u7684 css \u65B9\u6848\u6CA1\u6709\u4E00\u79CD\u5360\u7EDF\u6CBB\u5730\u4F4D\uFF0C\u73B0\u6709\u7684\u5404\u79CD\u65B9\u6848\u90FD\u6709\u5404 \u81EA\u7684\u4F18\u7F3A\u70B9\uFF0C\u56E0\u6B64\u9009\u62E9\u4E00\u79CD\u5408\u9002\u7684\u6837\u5F0F\u65B9\u6848\u9700\u8981\u7EFC\u5408\u8003\u8651\u5F88\u591A\u65B9\u9762\u3002\u63A8\u8350\u6587 \u7AE0"),zn={href:"https://segmentfault.com/a/1190000041840130",target:"_blank",rel:"noopener noreferrer"},An=n("React \u7EC4\u4EF6\u5E93 CSS \u6837\u5F0F\u65B9\u6848\u5206\u6790"),Fn=n("\u3002\u540E\u9762\u4F1A\u8BB2\u4E00\u4E0B\u600E\u4E48\u5904\u7406\u8981\u5355\u72EC\u8F93\u51FA style \u6587\u4EF6\u3002"),In=s("li",null,[s("code",null,"Material UI "),n("\u5F15\u5165\u662F\u60F3\u66F4\u597D\u7684\u6D4B\u8BD5 "),s("code",null,"tree-shaking"),n("\uFF0C\u4E8C\u6B21\u5C01\u88C5\u7EC4\u4EF6\u5E93\u4E5F\u662F\u5B9E\u9645\u4E1A\u52A1\u5E38\u89C1\u7684\u9700\u6C42\u3002")],-1),Tn=o(`<p>\u7EC4\u4EF6\u7ED3\u6784\uFF0Cbutton \u7B80\u5355\u793A\u5217\uFF1A</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>|-- src 
    |-- Button 
    | |-- Button.tsx 
    | |-- index.ts
    | |-- types.d.ts 
|-- index.ts
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>Button.tsx</code></p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> css <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@emotion/react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ButtonProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./types&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token string">&#39;white&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cssBtn <span class="token operator">=</span> css<span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
  padding: 8px;
  background-color: hotpink;
  font-size: 14px;
  border-radius: 4px;
  &amp;:hover {
    color: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
  }
  border: 1px solid gray;
  transition: color 0.3s ease-in-out;
</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Button<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>ButtonProps<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">css</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>cssBtn<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hover to change color.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Button<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><code>types.d.ts</code></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ButtonProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>index.ts</code></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./Button&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./Button&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ButtonProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./types&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>src/index.ts</code></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./Button&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./Button&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// export type { ButtonProps } from &#39;./Button&#39;;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="typescript\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#typescript\u914D\u7F6E" aria-hidden="true">#</a> typescript\u914D\u7F6E</h3><p>\u8FD9\u91CC\u6253\u5305\u65F6\u8F93\u51FA\u7684\u7C7B\u578B\u6587\u4EF6\u65F6\u4F7F\u7528<code>tsc</code>\u6784\u5EFA\u8F93\u51FA\u7684\uFF0C</p><p><code>tsconfig.type.json</code></p><div class="language-json5 ext-json5 line-numbers-mode"><pre class="language-json5"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./tsconfig.json&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/*__tests__&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5141\u8BB8\u8F93\u51FA</span>
    <span class="token property">&quot;noEmit&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;declaration&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// \u53EA\u8F93\u51FA\u7C7B\u578B</span>
    <span class="token property">&quot;emitDeclarationOnly&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rootDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;outDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>package.json</code></p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build:type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc -b --force --verbose tsconfig.type.json&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>tsc: <code>-b</code> \u5373\u4EE3\u8868<code>--build</code>,<code>tsc -b</code>\u8FD8\u652F\u6301\u5176\u5B83\u4E00\u4E9B\u9009\u9879\uFF1A <ul><li>--verbose\uFF1A\u6253\u5370\u8BE6\u7EC6\u7684\u65E5\u5FD7\uFF08\u53EF\u4EE5\u4E0E\u5176\u5B83\u6807\u8BB0\u4E00\u8D77\u4F7F\u7528\uFF09</li><li>--dry: \u663E\u793A\u5C06\u8981\u6267\u884C\u7684\u64CD\u4F5C\u4F46\u662F\u5E76\u4E0D\u771F\u6B63\u8FDB\u884C\u8FD9\u4E9B\u64CD\u4F5C</li><li>--clean: \u5220\u9664\u6307\u5B9A\u5DE5\u7A0B\u7684\u8F93\u51FA\uFF08\u53EF\u4EE5\u4E0E<code>--dry\u4E00</code>\u8D77\u4F7F\u7528\uFF09</li><li>--force: \u628A\u6240\u6709\u5DE5\u7A0B\u5F53\u4F5C\u975E\u6700\u65B0\u7248\u672C\u5BF9\u5F85</li><li>--watch: \u89C2\u5BDF\u6A21\u5F0F\uFF08\u53EF\u4EE5\u4E0E<code>--verbose</code>\u4E00\u8D77\u4F7F\u7528\uFF09</li></ul></li></ul><h3 id="babel" tabindex="-1"><a class="header-anchor" href="#babel" aria-hidden="true">#</a> babel</h3><p>babel\u914D\u7F6E\u53EF\u89C1\u540E\u7EED<code>@rollup/plugin-babel</code>\u5C0F\u8282\u3002</p><h2 id="rollup\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#rollup\u914D\u7F6E" aria-hidden="true">#</a> rollup\u914D\u7F6E</h2><p>\u5148\u5B89\u88C5rollup\u4E24\u4E2A\u5FC5\u7528\u5230\u57FA\u7840\u63D2\u4EF6\uFF0C\u4F5C\u7528\u89C1\u4E0A\u63D2\u4EF6\u5217\u8868\u8BF4\u660E\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">add</span> @rollup/plugin-node-resolve @rollup/plugin-commonjs -D
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="\u600E\u4E48\u5904\u7406typescript" tabindex="-1"><a class="header-anchor" href="#\u600E\u4E48\u5904\u7406typescript" aria-hidden="true">#</a> \u600E\u4E48\u5904\u7406Typescript</h3><p>\u501F\u52A9 <code>@babel/preset-typescript</code> \u7684\u80FD\u529B\uFF0C\u76F4\u63A5\u8F6C\u8BD1 ts \u4EE3\u7801\uFF0C\u4E00\u6B65\u5230\u4F4D\uFF0C\u800C\u4E0D\u662F\u91C7\u7528<code> @rollup/plugin-typescript</code> \u5148\u5C06 ts \u8F6C\u6210 js \u7136\u540E\u518D\u4EA4\u7ED9<code> @rollup/plugin-babel</code> \u518D\u8F6C\u6362\u4E00\u6B21\uFF0C\u589E\u52A0\u4E86\u9002\u914D\u6210\u672C\u3002</p><h3 id="\u5982\u4F55\u6392\u9664\u516C\u5171\u4F9D\u8D56\u4E0D\u6253\u5305\u4EC5\u7EC4\u4EF6\u4E2D" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u6392\u9664\u516C\u5171\u4F9D\u8D56\u4E0D\u6253\u5305\u4EC5\u7EC4\u4EF6\u4E2D" aria-hidden="true">#</a> \u5982\u4F55\u6392\u9664\u516C\u5171\u4F9D\u8D56\u4E0D\u6253\u5305\u4EC5\u7EC4\u4EF6\u4E2D</h3>`,25),On=n("\u4F7F\u7528 "),Jn={href:"https://rollupjs.org/guide/en/#external",target:"_blank",rel:"noopener noreferrer"},Vn=s("code",null,"external",-1),Ln=n(" \u914D\u7F6E\uFF0C\u5C06\u4E0D\u9700\u8981\u6253\u5305\u4F9D\u8D56\u52A0\u8FDB\u53BB\uFF1B\u6709\u4E9B\u65F6\u5019\u4F1A\u4F7F\u7528\u4F9D\u8D56\u7684\u5B50\u4E00\u7EA7\u6587\u4EF6 \uFF0C\u6240\u4EE5\u8FD9\u4E2A "),Hn=s("code",null,"external",-1),Wn=n(" \u53EF\u4EE5\u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u5176\u53C2\u6570\u662F\u5F15\u7528\u7684\u4F9D\u8D56\u5730\u5740\uFF0C\u8FD4\u56DE\u503C\u662F\u4E00\u4E2A boolean "),$n=s("code",null,"true",-1),Un=n(" \u5219\u8868\u793A\uFF0C\u8FD9\u4E2A\u4F9D\u8D56\u4E0D\u4F1A\u88AB\u6253\u5305\u8FDB\u53BB. \u53EF\u4EE5\u4F7F\u7528"),Zn={href:"https://www.npmjs.com/package/rollup-plugin-peer-deps-external",target:"_blank",rel:"noopener noreferrer"},Yn=n("rollup-plugin-peer-deps-external"),Gn=n("\u63D2\u4EF6\u3002"),Kn=o(`<h3 id="rollup-plugin-babel" tabindex="-1"><a class="header-anchor" href="#rollup-plugin-babel" aria-hidden="true">#</a> <code>@rollup/plugin-babel</code></h3><p>\u7528\u4E8E\u8F6C\u6362 es6 \u8BED\u6CD5\u3001ts\u3001react-jsx\u3002\u5B89\u88C5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">add</span> @rollup/plugin-babel -D
<span class="token function">pnpm</span> <span class="token function">add</span> @babel/core @babel/preset-env @babel/preset-react @babel/preset-typescript -D
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>babel.config.js</code>\u914D\u7F6E\u5982\u4E0B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;@babel/preset-env&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token string">&#39;@babel/preset-react&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">runtime</span><span class="token operator">:</span> <span class="token string">&#39;automatic&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">importSource</span><span class="token operator">:</span> <span class="token string">&#39;@emotion/react&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&#39;@babel/preset-typescript&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@emotion&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;@babel/plugin-transform-runtime&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u8FD9\u91CC<code>@babel/plugin-transform-runtime</code> \u7528\u4E8E\u907F\u514D\u6C61\u67D3\u5168\u5C40\u51FD\u6570\uFF08\u4E0D\u662F\u5FC5\u987B\u8981\u7528\u5230\uFF0C\u4F46\u4F5C\u4E3A\u7C7B\u5E93\u6700\u597D\u8981\u52A0\u4E0A\uFF09\u3002 rollup \u4E2D\u7684\u914D\u7F6E\u5982\u4E0B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-babel&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      extensions<span class="token punctuation">,</span>
      <span class="token literal-property property">babelHelpers</span><span class="token operator">:</span> <span class="token string">&#39;runtime&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">&#39;node_modules/**&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="plugin-transform-runtime" tabindex="-1"><a class="header-anchor" href="#plugin-transform-runtime" aria-hidden="true">#</a> plugin-transform-runtime</h5><blockquote><p>A plugin that enables the re-use of Babel&#39;s injected helper code to save on codesize.</p></blockquote><p>\u4E3A\u4E86\u6D4F\u89C8\u5668\u5411\u4E0B\u517C\u5BB9\uFF0C\u4F1A\u4F7F\u7528 <code>@babel/preset-env</code> \u5BF9\u6BCF\u4E2A\u6587\u4EF6\u7684 ES6 \u8BED\u6CD5\u8FDB\u884C\u8F6C\u6362\uFF0C\u6211\u4EEC\u79F0\u4E4B\u4E3A\u8F85\u52A9\u51FD\u6570\u3002</p><p>\u4F46\u6837\u8FD9\u505A\u5B58\u5728\u4E00\u4E2A\u95EE\u9898\u3002\u5728\u6B63\u5E38\u7684\u524D\u7AEF\u5DE5\u7A0B\u5F00\u53D1\u7684\u65F6\u5019\uFF0C\u5C11\u5219\u51E0\u5341\u4E2A js \u6587\u4EF6\uFF0C\u591A\u5219\u4E0A\u5343\u4E2A\u3002\u5982\u679C\u6BCF\u4E2A\u6587\u4EF6\u91CC\u90FD\u4F7F\u7528\u4E86 class \u7C7B\u8BED\u6CD5\uFF0C \u90A3\u4F1A\u5BFC\u81F4\u6BCF\u4E2A\u8F6C\u6362\u540E\u7684\u6587\u4EF6\u4E0A\u90E8\u90FD\u4F1A\u6CE8\u5165\u8FD9\u4E9B\u76F8\u540C\u7684\u51FD\u6570\u58F0\u660E\u3002\u8FD9\u4F1A\u7528\u6784\u5EFA\u5DE5\u5177\u6253\u5305\u51FA\u6765\u7684\u5305\u975E\u5E38\u5927,\u5305\u542B\u5927\u91CF\u91CD\u590D\u4EE3\u7801\u3002\u4E00\u4E2A\u601D\u8DEF\u5C31\u662F \uFF0C\u628A\u8FD9\u4E9B\u51FD\u6570\u58F0\u660E\u90FD\u653E\u5728\u4E00\u4E2A<code>npm\u5305</code>\u91CC\uFF0C\u9700\u8981\u4F7F\u7528\u7684\u65F6\u5019\u76F4\u63A5\u4ECE\u8FD9\u4E2A\u5305\u91CC\u5F15\u5165\u5230\u6211\u4EEC\u7684\u6587\u4EF6\u91CC\u3002\u8FD9\u6837\u5373\u4F7F\u4E0A\u5343\u4E2A\u6587\u4EF6\uFF0C\u4E5F\u4F1A\u4ECE\u76F8\u540C\u5730\u5305 \u91CC\u5F15\u7528\u8FD9\u4E9B\u51FD\u6570\u3002\u901A\u8FC7 <code>rollup/webpack</code> \u8FD9\u4E00\u7C7B\u7684\u6784\u5EFA\u5DE5\u5177\u6253\u5305\u7684\u65F6\u5019\uFF0C\u53EA\u4F1A\u628A\u4F7F\u7528\u5230\u7684 npm \u5305\u91CC\u7684\u51FD\u6570\u5F15\u5165\u4E00\u6B21\uFF0C\u8FD9\u6837\u5C31\u505A\u5230\u4E86\u590D \u7528\uFF0C\u51CF\u5C11\u4E86\u4F53\u79EF\u3002</p><p>\u5B89\u88C5 <code>@babel/runtime</code>\u5305\u63D0\u4F9B\u8F85\u52A9\u51FD\u6570\u6A21\u5757\uFF0C\u4E14\u662F\u5B89\u88C5\u5230<code>dependencies</code>\uFF0C\u5B89\u88C5 Babel \u63D2\u4EF6 <code>@babel/plugin-transform-runtime</code> \u6765 \u81EA\u52A8\u66FF\u6362\u8F85\u52A9\u51FD\u6570\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">add</span> @babel/runtime
<span class="token function">pnpm</span> <span class="token function">add</span> @babel/plugin-transform-runtime -D
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A\u5373\u5982\u662F\u8FD9\u6837\u5BFC\u5165 help \u51FD\u6570\u7684<code>import _defineProperty from &#39;@babel/runtime/helpers/defineProperty&#39;;</code><img src="`+b+`" alt=""></p><h3 id="\u5B8C\u6574\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u5B8C\u6574\u914D\u7F6E" aria-hidden="true">#</a> \u5B8C\u6574\u914D\u7F6E</h3><h4 id="package-json" tabindex="-1"><a class="header-anchor" href="#package-json" aria-hidden="true">#</a> package.json</h4><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dist&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.cjs.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.esm.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.d.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;.&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.esm.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.cjs.js&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;copy-d.ts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;copyfiles -u 1 src/**/*.d.ts dist&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc -b --force --verbose tsconfig.type.json &amp;&amp; pnpm run copy-d.ts&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pnpm run build:type &amp;&amp; rollup -c -w --environment NODE_ENV:development&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:all&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rm -rf dist &amp;&amp; pnpm run build:type &amp;&amp; rollup -c --environment NODE_ENV:production&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;peerDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;react&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&gt;=16.8.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;react-dom&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&gt;=16.8.0&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@babel/runtime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.18.9&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@emotion/react&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^11.10.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@emotion/styled&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^11.10.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@mui/icons-material&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.10.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@mui/material&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.10.3&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><ul><li>files: \u5B9A\u4E49\u4F60\u7684 NPM \u5305\u4E2D\u8981\u5305\u542B\u54EA\u4E9B\u6587\u4EF6</li><li>main: \u5B9A\u4E49 CommonJS \u5165\u53E3,<code>main</code> \u662F\u4E00\u4E2A\u5F53\u6253\u5305\u5DE5\u5177\u6216\u8FD0\u884C\u65F6\u4E0D\u652F\u6301 <code>package.json#exports</code> \u65F6\u7684\u515C\u5E95\u65B9\u6848\uFF1B\u5982\u679C\u6253\u5305\u5DE5\u5177\u6216\u8FD0\u884C \u65F6\u652F\u6301 <code>package exports</code>\uFF0C\u5219\u4E0D\u4F1A\u4F7F\u7528 <code>main</code>\u3002 <code>main</code> \u5E94\u8BE5\u6307\u5411\u4E00\u4E2A\u517C\u5BB9 <code>CommonJS</code> \u683C\u5F0F\u7684\u4EA7\u51FA\uFF1B\u5B83\u5E94\u8BE5\u4E0E <code>package exports</code> \u4E2D\u7684 <code>require</code> \u4FDD\u6301\u4E00\u81F4\u3002</li><li>types: \u5B9A\u4E49 TypeScript \u7C7B\u578B</li><li>exports: \u4E3A\u4F60\u7684\u5E93\u5B9A\u4E49\u516C\u5171 API</li><li>sideEffects: \u6765\u5141\u8BB8 <code>treeshaking</code>, <code>false</code>\u4EE3\u8868\u6240\u6709\u6A21\u5757\u90FD\u662F\u201C\u7EAF\u201D\u7684\uFF0C\u6CA1\u6709\u526F\u4F5C\u7528</li><li>peerDependencies\uFF1A\u5982\u679C\u4F60\u4F9D\u8D56\u522B\u7684\u6846\u67B6\u6216\u5E93\uFF0C\u5C06\u5B83\u8BBE\u7F6E\u4E3A peer dependency</li></ul>`,18),Qn=n("\u66F4\u591A\u7684\u8BE6\u7EC6\u81EA\u52A8\u53EF\u53C2 \u8003"),Xn={href:"https://github.com/frehner/modern-guide-to-packaging-js-library/blob/main/README-zh_CN.md",target:"_blank",rel:"noopener noreferrer"},sa=n("\u6253\u5305 JavaScript \u5E93\u7684\u73B0\u4EE3\u5316\u6307\u5357"),na=o("<li>copyfiles: \u540E\u7EED\u4F1A\u8BB2\u5230\uFF0C\u4E3B\u8981\u662F <code>tsc build </code>\u65F6\u4E0D\u4F1A\u5904\u7406<code>.d.ts</code>\u6587\u4EF6\uFF0C\u5355\u72EC\u590D\u5236\u3002</li><li>tsc: <code>-b</code> \u5373\u4EE3\u8868<code>--build</code>,<code>tsc -b</code>\u8FD8\u652F\u6301\u5176\u5B83\u4E00\u4E9B\u9009\u9879\uFF1A <ul><li><code>--verbose</code>\uFF1A\u6253\u5370\u8BE6\u7EC6\u7684\u65E5\u5FD7\uFF08\u53EF\u4EE5\u4E0E\u5176\u5B83\u6807\u8BB0\u4E00\u8D77\u4F7F\u7528\uFF09</li><li><code>--dry</code>: \u663E\u793A\u5C06\u8981\u6267\u884C\u7684\u64CD\u4F5C\u4F46\u662F\u5E76\u4E0D\u771F\u6B63\u8FDB\u884C\u8FD9\u4E9B\u64CD\u4F5C</li><li><code>--clean</code>: \u5220\u9664\u6307\u5B9A\u5DE5\u7A0B\u7684\u8F93\u51FA\uFF08\u53EF\u4EE5\u4E0E<code>--dry\u4E00</code>\u8D77\u4F7F\u7528\uFF09</li><li><code>--force</code>: \u628A\u6240\u6709\u5DE5\u7A0B\u5F53\u4F5C\u975E\u6700\u65B0\u7248\u672C\u5BF9\u5F85</li><li><code>--watch</code> : \u89C2\u5BDF\u6A21\u5F0F\uFF08\u53EF\u4EE5\u4E0E<code>--verbose</code>\u4E00\u8D77\u4F7F\u7528\uFF09</li></ul></li><li>rollup: <code>-w</code> \u5373<code>-watch</code>\u76D1\u542C\u6A21\u5F0F</li>",3),aa=n("rollup: "),ea=s("code",null,"--environment NODE_ENV:development",-1),pa=n(", \u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF"),ta={href:"https://rollupjs.org/guide/en/#--environment-values",target:"_blank",rel:"noopener noreferrer"},oa=n("environment-values"),la=o(`<h4 id="rollup-config-js" tabindex="-1"><a class="header-anchor" href="#rollup-config-js" aria-hidden="true">#</a> rollup.config.js</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-node-resolve&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-commonjs&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-babel&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> replace <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-replace&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> externalDep <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-peer-deps-external&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-terser&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> visualizer <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-visualizer&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token string">&#39;./src/index.ts&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> extensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;.ts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.tsx&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.jsx&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isProd <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    input<span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&#39;dist/index.esm.js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;esm&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&#39;dist/index.cjs.js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;cjs&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// \u8BBE\u7F6E\u6253\u5165output file\uFF0C\u5305\u62ECpeerDependencies\u548Cdependencies</span>
      <span class="token function">externalDep</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// dependencies\u4E5F\u4E0D\u6253\u5305\u8FDBoutput</span>
        <span class="token literal-property property">includeDependencies</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        extensions<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        extensions<span class="token punctuation">,</span>
        <span class="token literal-property property">babelHelpers</span><span class="token operator">:</span> <span class="token string">&#39;runtime&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">&#39;node_modules/**&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// production\u65F6\u538B\u7F29</span>
      isProd <span class="token operator">&amp;&amp;</span>
      <span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// drop_console: true,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token operator">!</span>isProd <span class="token operator">&amp;&amp;</span>
      <span class="token function">visualizer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;rollup-bundle-report.html&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>\u8F93\u51FA\u5927\u6982\u662F\u8FD9\u6837\uFF1A <img src="`+m+`" alt=""></p><p>\u867D\u7136\u662F\u8F93\u51FA\u7684\u5355\u6587\u4EF6\u7684\u6253\u5305\u6587\u4EF6\uFF0C\u4F46\u652F\u6301 <code>es module</code>\uFF0C\u4E5F\u662F\u652F\u6301 <code>tree-shaking</code> \u7684\u3002\u8FD9\u6837\u4E00\u4E2A\u7EC4\u4EF6\u5E93\u7684\u6253\u5305\u5C31\u57FA\u672C\u5B8C\u6210\u4E86\u3002</p><h3 id="\u5982\u4F55\u652F\u6301-scss-less" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u652F\u6301-scss-less" aria-hidden="true">#</a> \u5982\u4F55\u652F\u6301 scss/less</h3><p>\u7EC4\u4EF6\u7684\u6837\u5F0F\u65B9\u6848\u662F<strong>\u6837\u5F0F\u548C\u903B\u8F91\u5206\u79BB</strong>\uFF0C\u8FD9\u79CD\u65B9\u6848\u7684\u4F18\u70B9\u6709\uFF1A</p><ul><li><p>\u9002\u7528\u6027\u5E7F\u6CDB\uFF0C\u53EF\u4EE5\u652F\u6301\u7EC4\u4EF6\u5E93\u4F7F\u7528\u8005\u7684\u5404\u79CD\u5F00\u53D1\u73AF\u5883\u3002</p></li><li><p>\u4E0D\u9650\u5236\u7EC4\u4EF6\u5E93\u7684\u6280\u672F\u6808\uFF0C\u540C\u4E00\u5957\u6837\u5F0F\u53EF\u4EE5\u7528\u5728\u57FA\u4E8E\u591A\u4E2A\u6846\u67B6\u7684\u7EC4\u4EF6\u5E93\u4E0A\u3002</p></li><li><p>\u65E0\u9700\u8003\u8651\u5BF9 SSR\uFF08\u670D\u52A1\u7AEF\u6E32\u67D3\uFF09\u7684\u652F\u6301\uFF0C\u5BF9\u5916\u63D0\u4F9B\u7684\u662F CSS \u6587\u4EF6\uFF0C\u56E0\u6B64 SSR \u6D41\u7A0B\u5B8C\u5168\u4EA4\u7ED9\u7EC4\u4EF6\u5E93\u7684\u4F7F\u7528\u8005\u63A7\u5236\u3002</p></li><li><p>\u53EF\u4EE5\u76F4\u63A5\u5BF9\u5916\u63D0\u4F9B less\u3001sass \u7B49\u6E90\u6587\u4EF6\uFF0C\u4FBF\u4E8E\u5916\u90E8\u8986\u76D6\u53D8\u91CF\uFF0C\u5B9E\u73B0\u4E3B\u9898\u5B9A\u5236\u6216\u6362\u80A4\u7B49\u529F\u80FD\u3002\u4F46\u662F\u8FD9\u79CD\u65B9\u6848\u4E5F\u6709\u4E00\u4E9B\u95EE\u9898\uFF1A</p></li><li><p>\u9700\u8981\u4F7F\u7528\u8005\u624B\u52A8\u5F15\u5165\u6837\u5F0F\u6587\u4EF6\u3002\u5982\u679C\u76F4\u63A5\u5F15\u5165\u4E86\u5B8C\u6574\u7684 CSS \u6587\u4EF6\uFF0C\u800C\u5728\u5B9E\u9645\u4F7F\u7528\u4E2D\u5E76\u6CA1\u6709\u7528\u5230\u7EC4\u4EF6\u5E93\u91CC\u7684\u5168\u90E8\u7EC4\u4EF6\uFF0C\u5C31\u4F1A\u9020\u6210\u4E00\u4E9B\u65E0 \u7528\u7684\u6837\u5F0F\u88AB\u6253\u5305\u8FDB\u9879\u76EE\u4E2D\u3002</p></li><li><p>\u8BA9\u7EC4\u4EF6\u5E93\u652F\u6301 CSS \u6309\u9700\u5F15\u5165\u7684\u529F\u80FD\u4F1A\u6BD4\u8F83\u590D\u6742\uFF0C\u65E2\u9700\u8981\u7EC4\u4EF6\u5E93\u7684\u5F00\u53D1\u8005\u5728\u6253\u5305\u6D41\u7A0B\u548C\u4EA7\u7269\u4E0A\u8FDB\u884C\u5904\u7406\uFF0C\u53C8\u9700\u8981\u4F7F\u7528\u8005\u6309\u7167\u4E00\u5B9A\u89C4\u5219\u5F15 \u5165\u6837\u5F0F\u6587\u4EF6\u3002\u9996\u5148\u7EC4\u4EF6\u5E93\u5F00\u53D1\u8005\u9700\u8981\u5B9A\u4E00\u5957\u6837\u5F0F\u6587\u4EF6\u7684\u76EE\u5F55\u7EC4\u7EC7\u89C4\u8303\uFF0C\u4F7F\u5176\u80FD\u5728\u6253\u5305\u6D41\u7A0B\u4E2D\u652F\u6301\u4EE5\u7EC4\u4EF6\u4E3A\u5355\u4F4D\u6253\u5305\u6837\u5F0F\u6587\u4EF6\uFF0C\u4E4B\u540E\u4F7F\u7528 \u8005\u5C31\u53EF\u4EE5\u6309\u9700\u624B\u52A8\u5F15\u5165\u5BF9\u5E94\u7EC4\u4EF6\u7684\u6837\u5F0F\u6587\u4EF6\u3002\u5BF9\u4E8E\u5177\u6709\u7279\u5B9A\u76EE\u5F55\u7EC4\u7EC7\u89C4\u8303\u7684\u7EC4\u4EF6\u5E93\uFF0C\u76EE\u524D\u5DF2\u7ECF\u6709\u63D2\u4EF6\u53EF\u4EE5\u5728\u7F16\u8BD1\u9636\u6BB5\u8F85\u52A9\u751F\u6210\u5F15\u5165\u6837\u5F0F \u7684 import \u8BED\u53E5\uFF0C\u4F8B\u5982 <code>babel-plugin-import</code>\u3001<code>unplugin-vue-components</code> \u7B49\u3002\u5982\u5F00\u7BC7\u8BB2\u7684\u5217\u5B50</p></li><li><p>\u5982\u679C\u7EC4\u4EF6\u5E93\u5185\u90E8\u7684\u7EC4\u4EF6\u5B58\u5728\u5F15\u7528\u5173\u7CFB\uFF0C\u4E3A\u4E86\u5B9E\u73B0\u6309\u9700\u5F15\u5165\uFF0C\u6253\u5305\u51FA\u6765\u7684\u7EC4\u4EF6\u7684\u6837\u5F0F\u53EF\u80FD\u4F1A\u5B58\u5728\u5197\u4F59\u3002</p></li></ul><h4 id="\u5982\u4F55\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u914D\u7F6E" aria-hidden="true">#</a> \u5982\u4F55\u914D\u7F6E</h4><p>\u5B89\u88C5\u63D2\u4EF6\uFF0C<code>rollup-plugin-postcss</code>\u652F\u6301 css \u6587\u4EF6\u7684\u52A0\u8F7D\u3001css \u52A0\u524D\u7F00\u3001css \u538B\u7F29\u3001\u5BF9 scss/less \u7684\u652F\u6301\uFF0C\u7528\u8FD9\u4E2A\u5C31\u80FD\u641E\u5B9A\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">add</span> postcss rollup-plugin-postcss --dev
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u6DFB\u52A0\u5230 rollup</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> postcss <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-postcss&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// input: ...,</span>
  <span class="token comment">// output: ...,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u8FD9\u6837\u5B50\u53EA\u4F1A\u5728 umd \u4E0B\u751F\u6548\uFF0Ccss \u6837\u5F0F\u751F\u6210<code>style</code>\u6807\u7B7E\u5185\u8054\u5230<code>head</code>\u4E2D\u3002\u5728\u5DE5\u7A0B\u4E2D\u4F7F\u7528\u4E00\u822C\u9700\u8981\u989D\u5916\u5F15\u5165\u6837\u5F0F\u6587\u4EF6\u3002\u6240\u4EE5\u9700\u8981\u62BD\u79BB\u5355\u72EC\u7684 css \u6587\u4EF6\u3002<code>rollup-plugin-postcss</code>\u914D\u7F6E\u5373\u53EF\uFF0C\u53E6\u5916\u8FD8\u8981\u542F\u7528<code>modules</code>, \u5373<strong>CSS modules</strong>\uFF0C\u9694\u79BB\u7EC4\u4EF6\u5E93\u6837\u5F0F\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">extract</span><span class="token operator">:</span> <span class="token string">&#39;index.css&#39;</span><span class="token punctuation">,</span>
  <span class="token comment">// \u538B\u7F29</span>
  <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// Enable CSS modules</span>
  <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u542F\u7528<code>CSS modules</code>\u540E\uFF0C\u6837\u5F0F\u5F15\u7528\u8981\u6539\u4E3A\uFF1A</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> AlertProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./types&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> css <span class="token keyword">from</span> <span class="token string">&#39;./style.css&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Alert<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>AlertProps<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>css<span class="token punctuation">.</span>alert<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Alert</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Alert<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u8F93\u51FA\u7684<code>className</code>\u624D\u80FD\u548C <code>index.css</code> \u4E2D\u5339\u914D</p><p><code>index.css</code></p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.style_alert__ZRjcy</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #535bf2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>\u989D\u5916\u914D\u7F6E</li></ul><ol><li><code>css modules</code> typescript \u62A5\u9519\uFF0C\u65B0\u589E\u6587\u4EF6<code>global.d.ts</code>:</li></ol><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&#39;*.css&#39;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> css<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> css<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>\u5728\u6D4B\u8BD5\u5305\u65F6\uFF0C<code>import &#39;rollup-react-component-library/dist/index.css&#39;</code>\u5F15\u5165<code>dist</code>\u7684<code>index.css</code>\u65F6 webpack \u51FA\u73B0\u9519\u8BEF\u627E\u4E0D\u5230\u6A21\u5757\uFF1B</li></ol>`,23),ca=n("\u53C2\u8003\u95EE\u9898"),ra={href:"https://github.com/vitejs/vite/discussions/2657",target:"_blank",rel:"noopener noreferrer"},ia=n("Declare .css in package.json exports"),ua=n("\uFF0Cpackage.json \u65B0\u589E\u914D\u7F6E\u5373\u53EF"),da=o(`<div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;.&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.esm.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.cjs.js&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;./dist/index.css&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.css&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.css&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.sass&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.scss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.css&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="3"><li>sideEffects \u8981\u4ECE<code>false</code> =&gt; \u5982\u4E0A\uFF0C\u4E0D\u7136 <code>webpack</code>\u4F1A\u628A<code>import</code>\u7684css tree-shaking \u6389</li></ol><h4 id="css-\u52A0\u524D\u7F00" tabindex="-1"><a class="header-anchor" href="#css-\u52A0\u524D\u7F00" aria-hidden="true">#</a> css \u52A0\u524D\u7F00</h4><p>\u501F\u52A9<code>autoprefixer</code>\u63D2\u4EF6\u6765\u7ED9<code>css3</code>\u7684\u4E00\u4E9B\u5C5E\u6027\u52A0\u524D\u7F00\u3002\u5B89\u88C5<code>pnpm i autoprefixer@8.0.0 -D</code>\uFF0C\u914D\u7F6E\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> postcss <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-postcss&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> autoprefixer <span class="token keyword">from</span> <span class="token string">&#39;autoprefixer&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">autoprefixer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u4F7F\u7528<code>autoprefixer</code>\u9664\u4E86\u4EE5\u4E0A\u914D\u7F6E\uFF0C\u8FD8\u9700\u8981\u914D\u7F6E<code>browserslis</code>t\uFF0C\u6709 2 \u79CD\u65B9\u5F0F\uFF0C\u4E00\u79CD\u662F\u5EFA\u7ACB<code>.browserslistrc</code>\u6587\u4EF6\uFF0C\u53E6\u4E00\u79CD\u662F\u76F4\u63A5\u5728 package.json \u91CC\u9762\u914D\u7F6E\uFF0C\u6211\u4EEC\u5728 package.json \u4E2D\uFF0C\u6DFB\u52A0<code>browserslist</code>\u5B57\u6BB5\u3002</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;browserslist&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;defaults&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;not ie &lt; 8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;last 2 versions&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&gt; 1%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;iOS 7&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;last 3 iOS versions&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="css-\u538B\u7F29" tabindex="-1"><a class="header-anchor" href="#css-\u538B\u7F29" aria-hidden="true">#</a> css \u538B\u7F29</h4>`,8),ka=n("\u5373\u5F00\u542F"),ba=s("code",null,"minimize",-1),ma=n("\u9009\u9879\u3002\u5B9E\u9645\u4E0A\u4F7F\u7528\u7684"),ha={href:"https://www.npmjs.com/package/cssnano",target:"_blank",rel:"noopener noreferrer"},_a=n("cssnano"),ga=n("\u538B\u7F29\u3002"),ya=o('<h4 id="\u652F\u6301-scss-less" tabindex="-1"><a class="header-anchor" href="#\u652F\u6301-scss-less" aria-hidden="true">#</a> \u652F\u6301 scss/less</h4><p>\u9879\u76EE\u4E2D\u4E00\u822C\u4E0D\u4F1A\u5199 css\uFF0C\u800C\u662F\u7528<code>scss</code>\u6216<code>less</code>\u7B49\u9884\u7F16\u8BD1\u5668\u3002<code>rollup-plugin-postcss</code>\u9ED8\u8BA4\u96C6\u6210\u4E86\u5BF9<code>scss\u3001less\u3001stylus</code>\u7684\u652F\u6301\u3002\u4F46\u989D\u5916\u9700\u8981 \u5B89\u88C5\u4F9D\u8D56\uFF0C\u5982\u5B98\u7F51\u6240\u793A\uFF1A</p><ul><li>For Sass install node-sass: <code>pnpm add node-sass --dev</code></li><li>For Stylus Install stylus: <code>pnpm add stylus --dev</code></li><li>For Less Install less: <code>pnpm add less --dev</code></li></ul><p>\u4EE5\u4E0A\u7684<strong>\u6837\u5F0F\u548C\u903B\u8F91\u5206\u79BB</strong>\u65B9\u6848\u624D\u57FA\u672C\u53EF\u7528\uFF0C\u53EF\u4EE5\u53D1\u73B0\u6BD4<code>css-in-js</code>\u9EBB\u70E6\u591A\u4E86\uFF0C\u800C\u4E14\u73B0\u5728\u8FD8\u672A\u5B9E\u73B0\u6837\u5F0F\u7684\u6309\u9700\u52A0\u8F7D\uFF0C\u8981\u60F3\u4F7F\u7528\u8005\u4F7F\u7528\u65B9\u4FBF\uFF0C\u5C31\u8981\u6309\u7EC4\u4EF6\u76EE\u5F55\u7ED3\u6784\u8F93\u51FA\u6837\u5F0F\u76EE\u5F55\uFF0C\u7528\u4E8E<code>sideEffects</code>\u914D\u7F6E\u548C<code>babel</code>\u63D2\u4EF6\uFF08\u8FD9\u5757\u5F00\u5934\u6709\u8BB2\u8FC7\uFF09\u3002</p><h3 id="\u7EC4\u4EF6\u6309\u76EE\u5F55\u7ED3\u6784\u8F93\u51FA" tabindex="-1"><a class="header-anchor" href="#\u7EC4\u4EF6\u6309\u76EE\u5F55\u7ED3\u6784\u8F93\u51FA" aria-hidden="true">#</a> \u7EC4\u4EF6\u6309\u76EE\u5F55\u7ED3\u6784\u8F93\u51FA</h3><h4 id="rollup-plugin-postcss-rollup-plugin-styles" tabindex="-1"><a class="header-anchor" href="#rollup-plugin-postcss-rollup-plugin-styles" aria-hidden="true">#</a> <code>rollup-plugin-postcss</code> =&gt; <code>rollup-plugin-styles</code></h4>',6),fa=n("\u4E0A\u9762\u7684"),va=s("code",null,"rollup-plugin-postcss",-1),qa=n(" \u8FD9\u4E2A\u63D2\u4EF6\u53EA\u4F1A\u628A\u6240\u6709\u7EC4\u4EF6\u7684\u6837\u5F0F\u62BD\u79BB\u62BD\u79BB\u51FA\u4E00\u4E2A\u5355\u72EC\u7684\u6587\u4EF6\uFF0C\u9002\u5408\u8F93\u51FA\u5230"),xa=s("code",null,"dist",-1),wa=n("\u6587\u4EF6\u5939\uFF0C\u4F46\u8FD9\u4E2A\u573A\u666F\u4E0B\uFF0C \u5728\u67E5\u627E\u4E00\u756A\u540E\uFF0C\u8981\u4F7F\u7528"),ja={href:"https://www.npmjs.com/package/rollup-plugin-styles",target:"_blank",rel:"noopener noreferrer"},Sa=s("code",null,"rollup-plugin-styles",-1),Ea=n(" \u8FD9\u4E2A\u63D2\u4EF6\uFF0C\u5B83\u53EF\u4EE5\u4E0E \u4EE5\u4E0B\u4F1A\u7528\u5230\u7684rollup output\u7684"),Da=s("code",null,"preserveModules ",-1),Ra=n("\u505A\u9002\u914D\uFF0C\u5373\u8F93\u51FA\u6309\u7167\u7EC4\u4EF6\u7EF4\u5EA6\u62C6\u5206\u7684 css \u6587\u4EF6\uFF0C\u4E0D\u8FC7\u8981\u60F3\u6B63\u786E\u5730\u5B9E\u73B0\u8FD9\u4E2A\u529F\u80FD\u9700\u8981\u505A\u4E00\u4E9B\u914D\u7F6E\u3002"),Ba=o(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">add</span> rollup-plugin-styles -D
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,1),Ca={id:"output-preservemodules",tabindex:"-1"},Ma=s("a",{class:"header-anchor",href:"#output-preservemodules","aria-hidden":"true"},"#",-1),Na=n(),Pa={href:"https://rollupjs.org/guide/en/#outputpreservemodules",target:"_blank",rel:"noopener noreferrer"},za=n("output.preserveModules"),Aa=n("\u8FD9\u91CC\u7EC4\u4EF6\u6309\u539F\u59CB\u76EE\u5F55\u7ED3\u6784\u8F93\u51FA\u4F7F\u7528 "),Fa={href:"https://rollupjs.org/guide/en/#outputpreservemodules",target:"_blank",rel:"noopener noreferrer"},Ia=n("output.preserveModules"),Ta=n(" , "),Oa=s("code",null,"output.preserveModulesRoot",-1),Ja=n("\uFF0C\u4E2D\u6587\u5B98\u7F51\u8FD8\u6CA1\u6709\u914D\u7F6E\uFF0C\u6240\u4EE5\u6587\u6863\u8FD8\u662F\u770B\u82F1\u6587\u7684\u6700\u65B0\uFF0C\u5173\u4E8E\u8FD9\u4E2A\u914D\u7F6E\uFF0C\u770B\u4E86\u633A\u591A \u6BD4\u8F83\u5E38\u89C1\u7684\u7EC4\u4EF6\u5E93\uFF0C\u90FD\u6CA1\u6709\u7528\u8FD9\u4E2A\u914D\u7F6E\u8F93\u51FA\uFF0C\u4E00\u822C\u90FD\u662F\u7528"),Va=s("code",null,"rollup",-1),La=n("\u8F93\u51FA\u5355\u4E00\u6253\u5305\u6587\u4EF6\uFF0C\u540E\u6765\u662F\u7FFB\u5230\u4E00\u4E0B\u6587\u7AE0\u6709\u63D0\u5230\u8FD9\u6837\u4E5F\u53EF\u4EE5\u5B9E\u73B0\uFF0C\u800C\u8FD9\u4E2A\u914D\u7F6E\u4E3B\u8981\u662F"),Ha=o(`<blockquote><p>Instead of creating as few chunks as possible, this mode will create separate chunks for all modules using the original module names as file names. Requires the <code>output.dir</code> option. Tree-shaking will still be applied, suppressing files that are not used by the provided entry points or do not have side effects when executed. This mode can be used to transform a file structure to a different module format.</p></blockquote><p>\u548C\u5E38\u89C4\u6A21\u5F0F\u5C3D\u53EF\u80FD\u521B\u5EFA\u66F4\u5C11\u7684<code>chunk</code>\u4E0D\u4E00\u6837\uFF0C\u8FD9\u4E2A\u6A21\u5F0F\u4F1A\u6309\u539F\u59CB\u7684\u6A21\u5757\u5212\u5206\uFF0C\u5206\u522B\u8F93\u51FA\u6587\u4EF6\uFF0C\u8981\u6C42<code>output.dir</code>\u5FC5\u987B\u58F0\u660E\uFF0C\u5373\u8F93\u51FA\u7684\u662F\u76EE\u5F55\uFF0C\u4E4B\u524D\u7684<code>out.file</code>\u5C31\u4E0D\u80FD\u7528\u4E86\uFF0C\u4E14Tree-shaking\u4F9D\u7136\u9002\u7528\u3002</p><p>\u5B9E\u73B0\u4E3B\u8981\u601D\u8DEF\u662F\u67E5\u627E\u6BCF\u4E2A<code>component</code>\u7684\u5165\u53E3\uFF0C\u5E76\u653E\u5165<code>input</code>\u6570\u7EC4\uFF0C\u518D\u5F00\u542F<code>preserveModules</code>\u6A21\u5F0F\u3002</p><p><code>rollup.esm.js</code>\u5177\u4F53\u914D\u7F6E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u540C\u4E4B\u524D</span>
<span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-styles&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> extensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;.ts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.tsx&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.jsx&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isProd <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> entryFile <span class="token operator">=</span> <span class="token string">&#39;src/index.ts&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// \u53EF\u4EE5\u65F6\u5728\u591A\u4E00\u7EA7\u4E5F\u53EF\u4EE5\uFF0C&#39;src/components&#39;</span>
<span class="token keyword">const</span> componentDir <span class="token operator">=</span> <span class="token string">&#39;src&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> componentEntryFiles <span class="token operator">=</span> fs
  <span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>componentDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">withFileTypes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dirent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> dirent<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[A-Z]\\w*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>dirent<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dirent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>componentDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>dirent<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.ts</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">[</span>entryFile<span class="token punctuation">,</span> <span class="token operator">...</span>componentEntryFiles<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">&#39;esm&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;esm&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">preserveModules</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">preserveModulesRoot</span><span class="token operator">:</span> <span class="token string">&#39;src&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token string">&#39;named&#39;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">assetFileNames</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// console.log(name);</span>
          <span class="token comment">// \u62BD\u79BB\u540E\u7684\u6837\u5F0F\u6587\u4EF6\u4F1A\u4F5C\u4E3A asset \u8F93\u51FA\uFF0C\u8FD9\u91CC\u53EF\u4EE5\u914D\u7F6E\u4E00\u4E0B \u6837\u5F0F\u6587\u4EF6\u7684\u8F93\u51FA\u4F4D\u7F6E\uFF08\u4E3A babel-plugin-import \u505A\u51C6\u5907\uFF09</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> ext<span class="token punctuation">,</span> dir<span class="token punctuation">,</span> base <span class="token punctuation">}</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// console.log(ext);</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>ext <span class="token operator">!==</span> <span class="token string">&#39;.css&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&#39;[name].[ext]&#39;</span><span class="token punctuation">;</span>
          <span class="token comment">// \u8F93\u51FA\u5230style\u76EE\u5F55\uFF0C\u4FBF\u4E8Etree-shaking</span>
          <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">&#39;style&#39;</span><span class="token punctuation">,</span> base<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// \u5176\u4ED6\u63D2\u4EF6\u4E00\u6837</span>
      <span class="token function">styled</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// \u62BD\u51FAcss\uFF0C\u800C\u4E0D\u662F\u6253\u5305\u8FDBjs</span>
        <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;extract&#39;</span><span class="token punctuation">,</span>
        <span class="token comment">// use: [&#39;less&#39;],</span>
        <span class="token comment">// less: {</span>
        <span class="token comment">//   javascriptEnabled: true,</span>
        <span class="token comment">// },</span>
        <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;.less&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.css&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// CSS Modules</span>
        <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">inline</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">onExtract</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// \u4EE5\u4E0B\u64CD\u4F5C\u7528\u6765\u786E\u4FDD\u6BCF\u4E2A\u7EC4\u4EF6\u76EE\u5F55\u53EA\u8F93\u51FA\u4E00\u4E2A index.css\uFF0C\u5B9E\u9645\u4E0A\u6BCF\u4E00\u4E2A\u5B50\u7EA7\u7EC4\u4EF6\u90FD\u4F1A\u8F93\u51FA\u6837\u5F0F\u6587\u4EF6\uFF0Cindex.css \u4F1A\u5305\u542B\u6240\u6709\u5B50\u7EC4\u4EF6\u7684\u6837\u5F0F</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> css<span class="token punctuation">,</span> name<span class="token punctuation">,</span> map <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> base <span class="token punctuation">}</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>base <span class="token operator">!==</span> <span class="token string">&#39;index.css&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><blockquote><p><code>rollup-plugin-styles</code>\u6587\u6863\u4E0D\u5168\uFF0C\u76EE\u524D\u53D1\u73B0\u4F7F\u7528<code>css module</code>\u7684\u6A21\u5F0F\u4E0B\uFF0C\u4EE3\u7801\u5E76\u6CA1\u6709\u62BD\u79BB\uFF0C\u76EE\u524D\u8FD8\u662F\u4F7F\u7528\u7684\u5E38\u89C4class\u3002</p></blockquote><p>\u53E6\u5916\u8FD8\u9700\u8981\u4FEE\u6539<code>package.json</code>\u624D\u80FD\u4F7F\u8F93\u51FA\u751F\u6548</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dist&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;esm&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.cjs.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esm/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.d.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;.&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./esm/index.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.cjs.js&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;esm/**/style/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;lib/**/style/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;*.css&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div>`,8),Wa=n("\u518D\u642D\u914D"),$a={href:"https://www.npmjs.com/package/babel-plugin-import",target:"_blank",rel:"noopener noreferrer"},Ua=n("babel-plugin-import"),Za=n("\u5373\u53EF\uFF0C\u53EF\u4EE5\u770B\u5230\u6574\u4E2A\u5B9E\u73B0\u771F\u7684\u9EBB\u70E6\uFF0C\u6240\u4EE5\u8FD8\u662F\u9009\u62E9"),Ya=s("code",null,"css-in-js",-1),Ga=n("\u628A\uFF0C\u4E5F\u6709\u652F\u6301\u96F6\u8FD0\u884C\u7684\u6846\u67B6\uFF0C\u6BD4\u5982"),Ka={href:"https://vanilla-extract.style/",target:"_blank",rel:"noopener noreferrer"},Qa=n("Vanilla-extract"),Xa=n("\u3002"),se=o(`<h3 id="\u5982\u4F55\u8C03\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u8C03\u8BD5" aria-hidden="true">#</a> \u5982\u4F55\u8C03\u8BD5</h3><ol><li>monorepo\u67B6\u6784\u4E0B\u7684\u9879\u76EE\uFF0C\u6BD4\u5982<code>pnpm+workspace</code>\uFF0C\u76F4\u63A5\u5B89\u88C5\u5373\u53EF</li></ol><p>\u6BD4\u5982\u5728\u672C\u5730\u628A<code>pkg1</code>\u5B89\u88C5\u5230 <code>pkg2</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">install</span> @sysuke/pkg1 --filter @sysuke/pkg2
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,4),ne={start:"2"},ae=s("code",null,"pnpm/yarn link",-1),ee=n("\uFF0C \u4E0D\u597D\u7528\uFF0C\u4F1A\u51FA\u73B0"),pe={href:"https://reactjs.org/warnings/invalid-hook-call-warning.html",target:"_blank",rel:"noopener noreferrer"},te=n("Invalid Hook Call Warning"),oe=n("\u7684\u9519\u8BEF"),le=s("li",null,"webpack alias",-1),ce=o(`<p><code>webpack.config.js</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>webpack: <span class="token punctuation">{</span>
  resolve: <span class="token punctuation">{</span>
    alias: <span class="token punctuation">{</span>
      <span class="token string">&#39;react&#39;</span><span class="token builtin class-name">:</span> path.resolve<span class="token punctuation">(</span>__dirname, <span class="token string">&#39;node_modules/react&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div>`,2),re={start:"4"},ie={href:"https://www.npmjs.com/package/yalc",target:"_blank",rel:"noopener noreferrer"},ue=n("yalc"),de=n("\u53EF\u53C2\u8003\u6587\u7AE0"),ke={href:"https://mp.weixin.qq.com/s/I4hhrgI3-Y18HD8zw_9g9w",target:"_blank",rel:"noopener noreferrer"},be=n("\u5C45\u7136\u6709\u6BD4 npm link \u66F4\u597D\u7684\u8C03\u8BD5\uFF1F"),me=s("h2",{id:"\u603B\u7ED3",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u603B\u7ED3","aria-hidden":"true"},"#"),n(" \u603B\u7ED3")],-1),he=n("\u4F7F\u7528rollup\u6253\u5305\u4E00\u4E2A\u53EF\u7528\u7684react\u7EC4\u4EF6\u5E93\u57FA\u672C\u5B9E\u73B0\uFF0C\u6E90\u4EE3\u7801\u89C1"),_e={href:"https://github.com/qinsong77/sysuke/tree/rollup-react-component-library-save-version/demos/rollup-react-component-library",target:"_blank",rel:"noopener noreferrer"},ge=n("rollup-react-component-library"),ye=n("\uFF0C\u5176\u5B9E\u4E00\u4E9B\u5E38\u89C1\u7684\u7EC4\u4EF6\u5E93\uFF0C\u5982"),fe=s("code",null,"mui",-1),ve=n("\uFF0C"),qe=s("code",null,"ant-design",-1),xe=n(", "),we={href:"https://github.com/tusen-ai/naive-ui",target:"_blank",rel:"noopener noreferrer"},je=n("naive-ui"),Se=n("\u7B49\uFF0C\u5728\u6253\u5305\u6210es module\uFF0C\u6309\u6A21\u5757 \u6253\u5305\u8F93\u51FA\u65F6\uFF0C\u90FD\u662F\u7528\u7684\u5176\u4ED6\u65B9\u5F0F\uFF0C\u6BD4\u5982babel\uFF0Ctsc\u7B49\uFF0C\u540E\u9762\u4F1A\u8865\u4E00\u7BC7\u6587\u7AE0\u53BB\u89E3\u6790\u5176\u4ED6\u5F00\u6E90\u7684\u7EC4\u4EF6\u5E93\u662F\u5982\u4F55\u6253\u5305\u7684\u3002"),Ee=o('<h2 id="\u8E29\u5751\u8BB0\u5F55" tabindex="-1"><a class="header-anchor" href="#\u8E29\u5751\u8BB0\u5F55" aria-hidden="true">#</a> \u8E29\u5751\u8BB0\u5F55</h2><h4 id="rollup\u63D2\u4EF6\u662F\u6570\u7EC4-\u6709\u7684\u63D2\u4EF6\u4F7F\u7528\u662F\u6709\u987A\u5E8F\u7684" tabindex="-1"><a class="header-anchor" href="#rollup\u63D2\u4EF6\u662F\u6570\u7EC4-\u6709\u7684\u63D2\u4EF6\u4F7F\u7528\u662F\u6709\u987A\u5E8F\u7684" aria-hidden="true">#</a> rollup\u63D2\u4EF6\u662F\u6570\u7EC4\uFF0C\u6709\u7684\u63D2\u4EF6\u4F7F\u7528\u662F\u6709\u987A\u5E8F\u7684</h4><p>\u6BD4\u5982 <code>@rollup/plugin-babel</code>\u5C31\u8981\u6C42 <code>@rollup/plugin-commonjs</code>\u5FC5\u987B\u5728\u524D\u9762\uFF0C\u6240\u4EE5\u8981\u597D\u597D\u770B\u63D2\u4EF6\u6587\u6863\u518D\u4F7F\u7528\u3002</p><h4 id="rollup-plugin-dts\u8F93\u51FA\u5355\u4E2A\u6587\u4EF6\u7684\u7C7B\u578B\u6587\u4EF6-\u4E0D\u9002\u5408\u7EC4\u4EF6\u5E93\u8FD9\u79CD\u7C7B\u578B\u8F93\u51FA\u5F88\u591A\u7684library-\u4E0D\u5982\u4F7F\u7528tsc-\u8FD8\u80FD\u6309\u76EE\u5F55\u8F93\u51FA-\u65E0\u5176\u4ED6\u4F9D\u8D56\u914D\u7F6E\u4E5F\u7B80\u5355" tabindex="-1"><a class="header-anchor" href="#rollup-plugin-dts\u8F93\u51FA\u5355\u4E2A\u6587\u4EF6\u7684\u7C7B\u578B\u6587\u4EF6-\u4E0D\u9002\u5408\u7EC4\u4EF6\u5E93\u8FD9\u79CD\u7C7B\u578B\u8F93\u51FA\u5F88\u591A\u7684library-\u4E0D\u5982\u4F7F\u7528tsc-\u8FD8\u80FD\u6309\u76EE\u5F55\u8F93\u51FA-\u65E0\u5176\u4ED6\u4F9D\u8D56\u914D\u7F6E\u4E5F\u7B80\u5355" aria-hidden="true">#</a> <code>rollup-plugin-dts</code>\u8F93\u51FA\u5355\u4E2A\u6587\u4EF6\u7684\u7C7B\u578B\u6587\u4EF6\uFF0C\u4E0D\u9002\u5408\u7EC4\u4EF6\u5E93\u8FD9\u79CD\u7C7B\u578B\u8F93\u51FA\u5F88\u591A\u7684library\uFF0C\u4E0D\u5982\u4F7F\u7528<code>tsc</code>\uFF0C\u8FD8\u80FD\u6309\u76EE\u5F55\u8F93\u51FA\uFF0C\u65E0\u5176\u4ED6\u4F9D\u8D56\u914D\u7F6E\u4E5F\u7B80\u5355</h4><h5 id="tsc-build-\u6784\u5EFA\u8F93\u51FA\u7684\u7C7B\u578B\u6587\u4EF6-\u5E76\u4E0D\u4F1A\u5904\u7406-d-ts\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#tsc-build-\u6784\u5EFA\u8F93\u51FA\u7684\u7C7B\u578B\u6587\u4EF6-\u5E76\u4E0D\u4F1A\u5904\u7406-d-ts\u6587\u4EF6" aria-hidden="true">#</a> <code>tsc --build ...</code>\u6784\u5EFA\u8F93\u51FA\u7684\u7C7B\u578B\u6587\u4EF6\uFF0C\u5E76\u4E0D\u4F1A\u5904\u7406<code>.d.ts</code>\u6587\u4EF6</h5><p>\u5373\u5982\u679C <code>src</code> \u7684\u7C7B\u578B\u6587\u4EF6\u662F<code>.d.ts</code>\u7ED3\u5C3E\u7684\uFF0C\u7F16\u8BD1\u6784\u5EFA\u65F6<code>tsc</code>\u4E0D\u4F1A\u5904\u7406\uFF0C\u5BFC\u81F4\u6587\u4EF6\u4E0D\u4F1A\u590D\u5236\u5230<code>outDir</code>\u3002\u89E3\u51B3\u65B9\u5F0F\u4E3B\u8981\u6709 2 \u79CD</p>',6),De=s("li",null,[s("code",null,".d.ts"),n("\u91CD\u547D\u540D\u4E3A"),s("code",null,".ts"),n(", \u6B63\u786E\u7684\u65B9\u5F0F\uFF0C\u7C7B\u578B\u6587\u4EF6\u4E0D\u8BE5"),s("code",null,".d.ts"),n("\uFF0C\u4E00\u822C\u5168\u5C40\u7684\u624D\u7528\u8FD9\u4E2A\u3002")],-1),Re=n("\u6784\u5EFA\u9636\u6BB5\u5355\u72EC\u5904\u7406\uFF0C\u590D\u5236\u6587\u4EF6\u5230\u8F93\u51FA\u76EE\u5F55\uFF0C\u8FD9\u91CC\u4F7F\u7528\u7684"),Be={href:"https://www.npmjs.com/package/copyfiles",target:"_blank",rel:"noopener noreferrer"},Ce=n("copyfiles"),Me=o(`<div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;copy-d.ts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;copyfiles -u 1 src/**/*.d.ts dist&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5176\u5B9E\u7C7B\u578B\u6587\u4EF6\u4E0D\u5E94\u8BE5\u4EE5<code>.d.ts</code>\u58F0\u660E\uFF0C\u9664\u4E86\u80FD\u9650\u5236\u5728<code>.d.ts</code>\u4E2D\u4E0D\u5199\u975E\u7C7B\u578B\u7684\u4EE3\u7801\uFF0C\u5176\u4ED6\u7684\u57FA\u672C\u4E0A\u90FD\u662F\u4E0D\u597D\u7684\u5730\u65B9\uFF0C\u6BD4\u5982<code>.d.ts</code>\u662F\u5168\u5C40\u5171\u4EAB\u7684\uFF0C\u4E0D\u9700\u8981<code>export</code> \u548C<code>import</code>\u5C31\u80FD\u4F7F\u7528\u3002</p><p>TypeScript\u4E0EECMAScript 2015\u4E00\u6837\uFF0C\u4EFB\u4F55\u5305\u542B<strong>\u9876\u7EA7import\u6216\u8005export</strong>\u7684\u6587\u4EF6\u90FD\u88AB\u5F53\u6210\u4E00\u4E2A\u6A21\u5757\u3002\u76F8\u53CD\u5730\uFF0C\u5982\u679C\u4E00\u4E2A\u6587\u4EF6\u4E0D\u5E26\u6709\u9876\u7EA7\u7684import\u6216\u8005export\u58F0\u660E\uFF0C\u90A3\u4E48\u5B83\u7684\u5185\u5BB9\u88AB\u89C6\u4E3A<strong>\u5168\u5C40\u53EF\u89C1</strong>\u7684\uFF08\u56E0\u6B64\u5BF9\u6A21\u5757\u4E5F\u662F\u53EF\u89C1\u7684\uFF09\uFF08\u5168\u5C40\u5C31\u662F\u4EE5<code>tsconfig.json</code>\u6587\u4EF6\u4E3A\u6839\u76EE\u5F55\u7684\u6240\u6709\u6587\u4EF6\u90FD\u80FD\u8BBF\u95EE\u5230\uFF09 \u6240\u4EE5\u5728<code>.d.ts</code>\u5982\u679C\u4F7F\u7528\u4E86<code>export</code>\u548C<code>import</code>\u5C31\u5931\u53BB\u4E86global type\u7684\u5C5E\u6027\u3002</p>`,3),Ne={id:"\u7528-tsc-\u7F16\u8BD1\u7684\u540E-\u6620\u5C04\u7684\u8DEF\u5F84-\u5373\u914D\u7F6E\u7684path-\u4E0D\u4F1A\u5904\u7406-\u5C06\u5BFC\u81F4\u7F16\u8BD1\u540E\u7684\u4EE3\u7801\u627E\u4E0D\u5230\u6A21\u5757\u3002",tabindex:"-1"},Pe=s("a",{class:"header-anchor",href:"#\u7528-tsc-\u7F16\u8BD1\u7684\u540E-\u6620\u5C04\u7684\u8DEF\u5F84-\u5373\u914D\u7F6E\u7684path-\u4E0D\u4F1A\u5904\u7406-\u5C06\u5BFC\u81F4\u7F16\u8BD1\u540E\u7684\u4EE3\u7801\u627E\u4E0D\u5230\u6A21\u5757\u3002","aria-hidden":"true"},"#",-1),ze=n(" \u7528 "),Ae=s("code",null,"tsc",-1),Fe=n(" \u7F16\u8BD1\u7684\u540E\uFF0C\u6620\u5C04\u7684\u8DEF\u5F84\uFF08\u5373\u914D\u7F6E\u7684"),Ie={href:"https://www.typescriptlang.org/tsconfig#paths",target:"_blank",rel:"noopener noreferrer"},Te=n("path"),Oe=n(" \uFF09\u4E0D\u4F1A\u5904\u7406\uFF0C\u5C06\u5BFC\u81F4\u7F16\u8BD1\u540E\u7684\u4EE3\u7801\u627E\u4E0D\u5230\u6A21\u5757\u3002"),Je=s("p",null,[n("TypeScript \u7F16\u8BD1\u65F6\u5E76\u4E0D\u4F1A\u91CD\u5199 "),s("code",null,"module paths"),n("\uFF0C "),s("code",null,"path"),n("\u662F\u8BBE\u8BA1\u7528\u6765\u8BA9 typescript \u7406\u89E3\u5176\u4ED6 bundle \u5DE5\u5177\u7684\u8DEF\u5F84\u522B\u540D\uFF0C\u6BD4\u5982 webpack \u7684 "),s("code",null,"resolve alias"),n("\uFF0C\u9879\u76EE\u4E2D\u6211\u9009\u7684\u4EE5\u4E0B\u65B9\u6848\u7684 "),s("code",null,"tsc-alias"),n("\uFF0C\u53EA\u9700\u914D\u7F6E\u5230script\uFF0C\u672Cdemo\u6682\u672A\u7528\u5230\u3002")],-1),Ve={href:"https://dev.to/larswaechter/path-aliases-with-typescript-in-nodejs-4353",target:"_blank",rel:"noopener noreferrer"},Le=n("Path aliases with TypeScript in Node.js"),He={href:"https://www.npmjs.com/package/tsc-alias",target:"_blank",rel:"noopener noreferrer"},We=n("tsc-alias"),$e={href:"https://www.npmjs.com/package/module-alias",target:"_blank",rel:"noopener noreferrer"},Ue=n("module-alias"),Ze=o('<h4 id="\u4E0D\u6B62\u662Fpeerdependencies\u8981external-dependencies\u7684\u4F9D\u8D56\u4E5F\u9700\u8981\u3002" tabindex="-1"><a class="header-anchor" href="#\u4E0D\u6B62\u662Fpeerdependencies\u8981external-dependencies\u7684\u4F9D\u8D56\u4E5F\u9700\u8981\u3002" aria-hidden="true">#</a> \u4E0D\u6B62\u662F<code>peerDependencies</code>\u8981<code>external</code>,<code>dependencies</code>\u7684\u4F9D\u8D56\u4E5F\u9700\u8981\u3002</h4><p>\u5728\u6700\u5F00\u59CB\u4F7F\u7528<code>rollup</code>\u6253\u5305\u65F6\uFF0C\u53EA\u628A<code>peerDependencies</code>\u8BBE\u7F6E\u5230external\u4E86\uFF0C\u53D1\u73B0\u6253\u5305\u4F53\u79EF\u6BD4\u8F83\u5927\uFF0C\u4E14\u5728\u4F7F\u7528<code>output.preserveModules</code>\u65F6\u6709\u95EE\u9898\uFF0C\u6253\u5305\u7684\u7ED3\u679C\u8FD8\u4F1A\u591A\u4E2A <code>node_modules</code>\u76EE\u5F55\uFF0C\u5F53\u65F6\u5B8C\u5168\u627E\u4E0D\u5230\u5934\u7EEA\uFF0C\u540E\u6765\u770B\u4E86\u4E00\u4E9B\u7EC4\u4EF6\u5E93\u6E90\u7801\uFF0C\u6BD4\u5982 <code>ant-design</code>:</p><p><img src="'+h+'" alt=""> \u5176\u5B9E<code>dependencies</code>\u4E5F\u8981<code>external</code>\u6389\uFF08\u5F53\u7136\u4E0D\u662Famd\u683C\u5F0F\u65F6\uFF09\uFF0C\u4F7F\u7528\u65F6\u8FD9\u4E9B\u4F9D\u8D56\u4E5F\u4F1A\u5B89\u88C5\u3002</p><h4 id="\u5982\u679C\u5728\u5DF2\u7ECF\u4F7F\u7528\u4E86babel-babel-preset-typescript\u65F6-rollup-plugin-typescript2\u63D2\u4EF6\u4E0D\u9700\u8981-\u8F6C\u6362-ts-\u540C\u6837\u7684\u4E8B\u6CA1\u5FC5\u8981\u505A-2-\u6B21\u3002" tabindex="-1"><a class="header-anchor" href="#\u5982\u679C\u5728\u5DF2\u7ECF\u4F7F\u7528\u4E86babel-babel-preset-typescript\u65F6-rollup-plugin-typescript2\u63D2\u4EF6\u4E0D\u9700\u8981-\u8F6C\u6362-ts-\u540C\u6837\u7684\u4E8B\u6CA1\u5FC5\u8981\u505A-2-\u6B21\u3002" aria-hidden="true">#</a> \u5982\u679C\u5728\u5DF2\u7ECF\u4F7F\u7528\u4E86<code>babel + @babel/preset-typescript</code>\u65F6, <code>rollup-plugin-typescript2</code>\u63D2\u4EF6\u4E0D\u9700\u8981\uFF0C\u8F6C\u6362 ts \u540C\u6837\u7684\u4E8B\u6CA1\u5FC5\u8981\u505A 2 \u6B21\u3002</h4><h4 id="babel-runtime" tabindex="-1"><a class="header-anchor" href="#babel-runtime" aria-hidden="true">#</a> <code>@babel/runtime</code></h4>',5),Ye=o("<li>\u5E94\u8BE5\u4F5C\u4E3A<code>dependency</code>\uFF0C\u5E76\u4E14\u5F53\u4F5C<code>external</code></li><li>\u914D\u7F6E\u5230<code>external</code>, <code>external: [&quot;@babel/runtime&quot;]</code> \u8FD9\u6837\u914D\u7F6E\u662F\u4E0D\u5DE5\u4F5C\u7684\uFF0C\u5F97<code>external: [/@babel\\/runtime/]</code>\u6216\u8005\u4E00\u4E2A\u51FD\u6570<code>(external: id =&gt; id.includes(&#39;@babel/runtime&#39;)</code>,<code>@emotion/react</code>\u4E5F\u662F</li>",2),Ge={href:"https://babeljs.io/docs/en/babel-plugin-transform-runtime",target:"_blank",rel:"noopener noreferrer"},Ke=n("@babel/plugin-transform-runtime"),Qe=n(" \u7684"),Xe={href:"https://babeljs.io/docs/en/babel-plugin-transform-runtime#useesmodules",target:"_blank",rel:"noopener noreferrer"},sp=n("useESModules"),np=n("\u81EA"),ap=s("code",null,"7.13.0",-1),ep=n("\u5C31\u9057\u5F03\u4E86\uFF0C\u4E0D\u7528\u53BB\u8003\u8651 \u6253\u5305\u65F6"),pp=s("code",null,"esm",-1),tp=n("\u548C"),op=s("code",null,"cjs",-1),lp=n("\u8FD9\u5757\u6709\u5F71\u54CD\uFF0C\u53BB\u533A\u5206\u5BF9\u5F85"),cp=n("\u6587\u6863\u5176\u5B9E\u8FD9\u5757\u5199\u5F97\u5F88\u6E05\u695A"),rp={href:"https://github.com/rollup/plugins/tree/master/packages/babel#babelhelpers",target:"_blank",rel:"noopener noreferrer"},ip=n("@rollup/plugin-babel.babelHelpers.runtime"),up=o(`<h4 id="sideeffects" tabindex="-1"><a class="header-anchor" href="#sideeffects" aria-hidden="true">#</a> sideEffects</h4><p><code>package.json</code> \u4E2D\u58F0\u660E <code>sideEffects</code> \u5C5E\u6027</p><blockquote><p>\u5728\u4E00\u4E2A\u7EAF\u7CB9\u7684 ESM \u6A21\u5757\u4E16\u754C\u4E2D\uFF0C\u8BC6\u522B\u51FA\u54EA\u4E9B\u6587\u4EF6\u6709\u526F\u4F5C\u7528\u5F88\u7B80\u5355\u3002\u7136\u800C\uFF0C\u6211\u4EEC\u7684\u9879\u76EE\u65E0\u6CD5\u8FBE\u5230\u8FD9\u79CD\u7EAF\u5EA6\uFF0C\u6240\u4EE5\uFF0C\u6B64\u65F6\u6709\u5FC5\u8981\u5411 webpack \u7684 compiler \u63D0\u4F9B\u63D0\u793A\u54EA\u4E9B\u4EE3\u7801\u662F\u201C\u7EAF\u7CB9\u90E8\u5206\u201D\u3002 \u2014\u2014 \u300Awebpack \u6587\u6863\u300B</p></blockquote><p>\u6CE8\u610F\uFF1A\u6837\u5F0F\u90E8\u5206\u662F\u6709\u526F\u4F5C\u7528\u7684\uFF01\u5373\u4E0D\u5E94\u8BE5\u88AB tree-shaking\uFF01</p><p>\u82E5\u662F\u76F4\u63A5\u58F0\u660E <code>sideEffects</code> \u4E3A <code>false</code>\uFF0C\u90A3\u4E48\u6253\u5305\u65F6\u5C06\u4E0D\u5305\u62EC\u6837\u5F0F\uFF01\u6240\u4EE5\u5E94\u8BE5\u50CF\u4E0B\u9762\u8FD9\u6837\u914D\u7F6E\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.sass&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.scss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.css&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div>`,6),dp={id:"rollup-plugin-multi-entry\u4E0D\u597D\u7528-\u81EA\u5DF1\u5199\u811A\u672C\u5904\u7406\u591A\u5165\u53E3\u5427",tabindex:"-1"},kp=s("a",{class:"header-anchor",href:"#rollup-plugin-multi-entry\u4E0D\u597D\u7528-\u81EA\u5DF1\u5199\u811A\u672C\u5904\u7406\u591A\u5165\u53E3\u5427","aria-hidden":"true"},"#",-1),bp=n(),mp={href:"https://github.com/rollup/plugins/tree/master/packages/multi-entry",target:"_blank",rel:"noopener noreferrer"},hp=n("@rollup/plugin-multi-entry"),_p=n("\u4E0D\u597D\u7528\uFF0C\u81EA\u5DF1\u5199\u811A\u672C\u5904\u7406\u591A\u5165\u53E3\u5427"),gp=s("p",null,[n("\u7B80\u5355\u8BD5\u4E86\u4E0B\uFF0C\u4F1A\u6709\u4E9B\u989D\u5916\u7684\u8F93\u51FA\uFF0C\u6BD4\u5982\u8FD9\u4E2A"),s("code",null,"_virtual"),n("\u6587\u4EF6\u5939\u3002 "),s("img",{src:_,alt:""})],-1),yp=s("li",null,[s("code",null,"entryFileName"),n("\u4E0D\u652F\u6301\u51FD\u6570")],-1),fp=s("code",null,"index.ts",-1),vp=n(" \u8F93\u51FA\u5230\u4E00\u4E2A"),qp=s("code",null,"_virtual",-1),xp=n("\u6587\u4EF6\u5939\uFF0C\u4E0D\u77E5\u9053\u600E\u4E48\u51FA\u73B0\u7684, \u53EF\u80FD\u7528\u8FD9\u4E2A\u63D2\u4EF6"),wp={href:"https://www.npmjs.com/package/@rollup/plugin-virtual",target:"_blank",rel:"noopener noreferrer"},jp=n("@rollup/plugin-virtual"),Sp=n("\u89E3\u51B3"),Ep=s("li",null,[n("\u53EA\u8F93\u51FA\u4E86 "),s("code",null,"entry index"),n(" \uFF0Ccomponent \u76EE\u5F55\u6CA1\u6709\u6309\u539F\u59CB\u76EE\u5F55\u8F93\u51FA\u6587\u4EF6")],-1),Dp={id:"output-preservemodules\u4E5F\u4E0D\u592A\u597D\u7528",tabindex:"-1"},Rp=s("a",{class:"header-anchor",href:"#output-preservemodules\u4E5F\u4E0D\u592A\u597D\u7528","aria-hidden":"true"},"#",-1),Bp=n(),Cp={href:"https://rollupjs.org/guide/en/#outputpreservemodules",target:"_blank",rel:"noopener noreferrer"},Mp=n("output.preserveModules"),Np=n("\u4E5F\u4E0D\u592A\u597D\u7528"),Pp=s("p",null,[n("\u867D\u7136\u7528\u8FD9\u4E2A\u914D\u7F6E\u6210\u529F\u6309\u6A21\u5757\u8F93\u51FA\uFF0C\u4F46\u6709\u7684\u60C5\u51B5\u4E0B\u6709\u95EE\u9898\uFF0C\u6BD4\u5982\u4E0A\u9762\u4E5F\u63D0\u5230\u8FC7\uFF0C"),s("code",null,"dependencies"),n("\u4E0D\u6392\u9664\uFF08external\uFF09\u65F6\uFF0C\u4F1A\u591A\u8F93\u51FA\u6587\u4EF6\u5939\uFF0C\u6BD4\u5982"),s("code",null,"node_modules")],-1),zp={href:"https://github.com/rollup/rollup/issues/3743",target:"_blank",rel:"noopener noreferrer"},Ap=n("preserveModules creates wrong output"),Fp={href:"https://github.com/rollup/rollup/issues/3684",target:"_blank",rel:"noopener noreferrer"},Ip=n("Why does the preserveModules option generate node_modules folder"),Tp=s("h4",{id:"\u5F53\u628Adependencies\u6253\u5305\u5165output\u65F6-\u6BD4\u5982\u4F1A\u53D1\u73B0react\u540C\u65F6\u6253\u5165\u4E86react-development-js\u548Creact-production-js",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u5F53\u628Adependencies\u6253\u5305\u5165output\u65F6-\u6BD4\u5982\u4F1A\u53D1\u73B0react\u540C\u65F6\u6253\u5165\u4E86react-development-js\u548Creact-production-js","aria-hidden":"true"},"#"),n(" \u5F53\u628Adependencies\u6253\u5305\u5165output\u65F6\uFF0C\u6BD4\u5982\u4F1A\u53D1\u73B0react\u540C\u65F6\u6253\u5165\u4E86"),s("code",null,"react.development.js"),n("\u548C"),s("code",null,"react.production.js")],-1),Op=n("\u4F7F\u7528"),Jp=s("code",null,"@rollup/plugin-replace",-1),Vp=n("\u89E3\u51B3\uFF0C\u53C2\u8003react\u5B98\u7F51\uFF0C"),Lp={href:"https://reactjs.org/docs/optimizing-performance.html#rollup",target:"_blank",rel:"noopener noreferrer"},Hp=n("Optimizing Performance"),Wp=s("h2",{id:"reference",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#reference","aria-hidden":"true"},"#"),n(" Reference")],-1),$p={href:"https://rollupjs.org/guide/en/",target:"_blank",rel:"noopener noreferrer"},Up=n("rollup"),Zp={href:"https://juejin.cn/post/7126394898445500423",target:"_blank",rel:"noopener noreferrer"},Yp=n("\u4ECE package.json \u6765\u804A\u804A\u5982\u4F55\u7BA1\u7406\u4E00\u6B3E\u4F18\u79C0\u7684 Npm \u5305"),Gp={href:"https://mp.weixin.qq.com/s/Rk729v6VI0IbwVPsuaPdOw",target:"_blank",rel:"noopener noreferrer"},Kp=n("rollup \u4ECE\u5165\u95E8\u5230\u6253\u5305\u4E00\u4E2A\u6309\u9700\u52A0\u8F7D\u7684\u7EC4\u4EF6\u5E93"),Qp={href:"https://stackoverflow.com/questions/56018167/typescript-does-not-copy-d-ts-files-to-build",target:"_blank",rel:"noopener noreferrer"},Xp=n("Typescript does not copy d.ts files to build"),st={href:"https://medium.com/@PepsRyuu/why-i-use-rollup-and-not-webpack-e3ab163f4fd3",target:"_blank",rel:"noopener noreferrer"},nt=n("Why I use Rollup, and not Webpack"),at={href:"https://www.codefeetime.com/post/rollup-config-for-react-component-library-with-typescript-scss/",target:"_blank",rel:"noopener noreferrer"},et=n("Rollup Config for React Component Library With TypeScript + SCSS"),pt={href:"https://dev.to/alexeagleson/how-to-create-and-publish-a-react-component-library-2oe",target:"_blank",rel:"noopener noreferrer"},tt=n("How to Create and Publish a React Component Library"),ot={href:"https://blog.csdn.net/mjzhang1993/article/details/112575745",target:"_blank",rel:"noopener noreferrer"},lt=n("Rollup2.x \u642D\u5EFA React \u7EC4\u4EF6\u5E93"),ct={href:"https://medium.com/singapore-gds/how-to-support-subpath-imports-using-react-rollup-typescript-1d3d331f821b",target:"_blank",rel:"noopener noreferrer"},rt=n("How to support subpath imports using React+Rollup+Typescript");function it(ut,dt){const p=l("RouterLink"),e=l("ExternalLinkIcon");return r(),i(u,null,[y,s("nav",f,[s("ul",null,[s("li",null,[a(p,{to:"#webpack-vs-rollup"},{default:t(()=>[v]),_:1}),s("ul",null,[s("li",null,[a(p,{to:"#\u4E3A\u4EC0\u4E48\u4E0D\u7528-webpack"},{default:t(()=>[q]),_:1})]),s("li",null,[a(p,{to:"#webpack\u6253\u5305\u5B9E\u73B0\u6309\u9700\u52A0\u8F7D"},{default:t(()=>[x]),_:1})])])]),s("li",null,[a(p,{to:"#\u6B63\u9898rollup"},{default:t(()=>[w]),_:1}),s("ul",null,[s("li",null,[a(p,{to:"#first-\u6253\u5305\u4E00\u4E2A-js-\u6587\u4EF6"},{default:t(()=>[j]),_:1})]),s("li",null,[a(p,{to:"#rollup-\u914D\u7F6E\u6587\u4EF6"},{default:t(()=>[S]),_:1})]),s("li",null,[a(p,{to:"#rollup-\u63D2\u4EF6"},{default:t(()=>[E]),_:1})])])]),s("li",null,[a(p,{to:"#\u9879\u76EE\u57FA\u672C\u914D\u7F6E\u8BF4\u660E"},{default:t(()=>[D]),_:1}),s("ul",null,[s("li",null,[a(p,{to:"#typescript\u914D\u7F6E"},{default:t(()=>[R]),_:1})]),s("li",null,[a(p,{to:"#babel"},{default:t(()=>[B]),_:1})])])]),s("li",null,[a(p,{to:"#rollup\u914D\u7F6E"},{default:t(()=>[C]),_:1}),s("ul",null,[s("li",null,[a(p,{to:"#\u600E\u4E48\u5904\u7406typescript"},{default:t(()=>[M]),_:1})]),s("li",null,[a(p,{to:"#\u5982\u4F55\u6392\u9664\u516C\u5171\u4F9D\u8D56\u4E0D\u6253\u5305\u4EC5\u7EC4\u4EF6\u4E2D"},{default:t(()=>[N]),_:1})]),s("li",null,[a(p,{to:"#rollup-plugin-babel"},{default:t(()=>[P]),_:1})]),s("li",null,[a(p,{to:"#\u5B8C\u6574\u914D\u7F6E"},{default:t(()=>[z]),_:1})]),s("li",null,[a(p,{to:"#\u5982\u4F55\u652F\u6301-scss-less"},{default:t(()=>[A]),_:1})]),s("li",null,[a(p,{to:"#\u7EC4\u4EF6\u6309\u76EE\u5F55\u7ED3\u6784\u8F93\u51FA"},{default:t(()=>[F]),_:1})]),s("li",null,[a(p,{to:"#\u5982\u4F55\u8C03\u8BD5"},{default:t(()=>[I]),_:1})])])]),s("li",null,[a(p,{to:"#\u603B\u7ED3"},{default:t(()=>[T]),_:1})]),s("li",null,[a(p,{to:"#\u8E29\u5751\u8BB0\u5F55"},{default:t(()=>[O]),_:1})]),s("li",null,[a(p,{to:"#reference"},{default:t(()=>[J]),_:1})])])]),s("p",null,[s("a",V,[L,a(e)]),H,W,$,U,Z,Y,G,K,Q,X,ss,ns,as,s("a",es,[ps,a(e)]),ts,s("a",os,[ls,a(e)]),cs,rs,is,us,ds]),ks,bs,ms,s("ul",null,[s("li",null,[hs,_s,gs,ys,fs,s("a",vs,[qs,a(e)]),xs,s("a",ws,[js,a(e)]),Ss,Es,Ds,Rs,Bs,Cs,Ms]),Ns,Ps]),zs,s("p",null,[As,Fs,Is,Ts,Os,Js,Vs,Ls,Hs,s("a",Ws,[$s,a(e)]),Us]),Zs,s("p",null,[Ys,Gs,Ks,s("a",Qs,[Xs,a(e)]),sn,nn,an,en,pn,tn,on,ln]),cn,s("ul",null,[s("li",null,[rn,un,s("a",dn,[kn,a(e)]),bn,mn,hn,_n,gn,yn,fn]),vn,s("li",null,[qn,xn,s("a",wn,[jn,a(e)]),Sn]),En,s("li",null,[s("a",Dn,[Rn,a(e)])])]),Bn,Cn,s("ul",null,[s("li",null,[Mn,Nn,Pn,s("a",zn,[An,a(e)]),Fn]),In]),Tn,s("p",null,[On,s("a",Jn,[Vn,a(e)]),Ln,Hn,Wn,$n,Un,s("a",Zn,[Yn,a(e)]),Gn]),Kn,s("p",null,[Qn,s("a",Xn,[sa,a(e)])]),s("ul",null,[na,s("li",null,[aa,ea,pa,s("a",ta,[oa,a(e)])])]),la,s("p",null,[ca,s("a",ra,[ia,a(e)]),ua]),da,s("p",null,[ka,ba,ma,s("a",ha,[_a,a(e)]),ga]),ya,s("p",null,[fa,va,qa,xa,wa,s("a",ja,[Sa,a(e)]),Ea,Da,Ra]),Ba,s("h4",Ca,[Ma,Na,s("a",Pa,[za,a(e)])]),s("p",null,[Aa,s("a",Fa,[Ia,a(e)]),Ta,Oa,Ja,Va,La]),Ha,s("p",null,[Wa,s("a",$a,[Ua,a(e)]),Za,Ya,Ga,s("a",Ka,[Qa,a(e)]),Xa]),se,s("ol",ne,[s("li",null,[ae,ee,s("a",pe,[te,a(e)]),oe]),le]),ce,s("ol",re,[s("li",null,[s("a",ie,[ue,a(e)])])]),s("p",null,[de,s("a",ke,[be,a(e)])]),me,s("p",null,[he,s("a",_e,[ge,a(e)]),ye,fe,ve,qe,xe,s("a",we,[je,a(e)]),Se]),Ee,s("ul",null,[De,s("li",null,[Re,s("a",Be,[Ce,a(e)])])]),Me,s("h4",Ne,[Pe,ze,Ae,Fe,s("a",Ie,[Te,a(e)]),Oe]),Je,s("ul",null,[s("li",null,[s("a",Ve,[Le,a(e)])]),s("li",null,[s("a",He,[We,a(e)])]),s("li",null,[s("a",$e,[Ue,a(e)])])]),Ze,s("ul",null,[Ye,s("li",null,[s("a",Ge,[Ke,a(e)]),Qe,s("a",Xe,[sp,a(e)]),np,ap,ep,pp,tp,op,lp])]),s("p",null,[cp,s("a",rp,[ip,a(e)])]),up,s("h4",dp,[kp,bp,s("a",mp,[hp,a(e)]),_p]),gp,s("ul",null,[yp,s("li",null,[fp,vp,qp,xp,s("a",wp,[jp,a(e)]),Sp]),Ep]),s("h4",Dp,[Rp,Bp,s("a",Cp,[Mp,a(e)]),Np]),Pp,s("ul",null,[s("li",null,[s("a",zp,[Ap,a(e)])]),s("li",null,[s("a",Fp,[Ip,a(e)])])]),Tp,s("p",null,[Op,Jp,Vp,s("a",Lp,[Hp,a(e)])]),Wp,s("ul",null,[s("li",null,[s("a",$p,[Up,a(e)])]),s("li",null,[s("a",Zp,[Yp,a(e)])]),s("li",null,[s("a",Gp,[Kp,a(e)])]),s("li",null,[s("a",Qp,[Xp,a(e)])]),s("li",null,[s("a",st,[nt,a(e)])]),s("li",null,[s("a",at,[et,a(e)])]),s("li",null,[s("a",pt,[tt,a(e)])]),s("li",null,[s("a",ot,[lt,a(e)])]),s("li",null,[s("a",ct,[rt,a(e)])])])],64)}var bt=c(g,[["render",it],["__file","rollup-build-react-library.html.vue"]]);export{bt as default};
