<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.43">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileColor" content="#333"><link rel="apple-touch-icon" href="/icons/128.ico"><script>
			var _hmt = _hmt || [];
			(function() {
				var hm = document.createElement("script");
				hm.src = "https://hm.baidu.com/hm.js?b180689c6fba69ad8ef56c3e0034ce9f";
				var s = document.getElementsByTagName("script")[0]; 
				s.parentNode.insertBefore(hm, s);
			})();
			</script><title>Rollup 打包 React 组件库 | Sysuke' World</title><meta name="description" content="personal frontend noteBook power by VuePress & GitHub Page">
    <link rel="modulepreload" href="/assets/app.a96f585b.js"><link rel="modulepreload" href="/assets/rollup-build-react-library.html.3383f488.js"><link rel="modulepreload" href="/assets/rollup-build-react-library.html.b933730a.js"><link rel="prefetch" href="/assets/index.html.5b1afdb6.js"><link rel="prefetch" href="/assets/emptyTemplate.html.79c444f3.js"><link rel="prefetch" href="/assets/word.html.eb2fb714.js"><link rel="prefetch" href="/assets/index.html.b4e3022b.js"><link rel="prefetch" href="/assets/backTrack.html.2a1c3a4c.js"><link rel="prefetch" href="/assets/dynamic.html.ac9f5886.js"><link rel="prefetch" href="/assets/interview.html.92fdae6c.js"><link rel="prefetch" href="/assets/leetCode.html.6ab77b5d.js"><link rel="prefetch" href="/assets/sort.html.5d76dfaa.js"><link rel="prefetch" href="/assets/index.html.51e6b325.js"><link rel="prefetch" href="/assets/blog.html.d2bd9947.js"><link rel="prefetch" href="/assets/framework.html.90d00583.js"><link rel="prefetch" href="/assets/index.html.b742e5de.js"><link rel="prefetch" href="/assets/leetcode.html.ea57b21c.js"><link rel="prefetch" href="/assets/index.html.dc6bd27b.js"><link rel="prefetch" href="/assets/docker.html.8829890d.js"><link rel="prefetch" href="/assets/index.html.07da3fb4.js"><link rel="prefetch" href="/assets/index.html.e346dd44.js"><link rel="prefetch" href="/assets/fileMerge.html.755b3635.js"><link rel="prefetch" href="/assets/koa.html.3dd81d57.js"><link rel="prefetch" href="/assets/index.html.da59e93b.js"><link rel="prefetch" href="/assets/index.html.1b0386d5.js"><link rel="prefetch" href="/assets/index.html.fddde5b1.js"><link rel="prefetch" href="/assets/howUiLibraryBundle.html.2c489594.js"><link rel="prefetch" href="/assets/monorepoPnpmTurboRepo.html.868978c4.js"><link rel="prefetch" href="/assets/webpack5ReactTs.html.f747f8f6.js"><link rel="prefetch" href="/assets/Combat.html.9e0b3725.js"><link rel="prefetch" href="/assets/index.html.cbcacbe7.js"><link rel="prefetch" href="/assets/guideAndConfigSetting.html.fb7ea89f.js"><link rel="prefetch" href="/assets/jest.html.d73073fb.js"><link rel="prefetch" href="/assets/rtl.html.bc313fd9.js"><link rel="prefetch" href="/assets/index.html.90822aa8.js"><link rel="prefetch" href="/assets/microapp.html.6f91e95c.js"><link rel="prefetch" href="/assets/qiankun.html.ba45be9a.js"><link rel="prefetch" href="/assets/BFC.html.2103c9c9.js"><link rel="prefetch" href="/assets/index.html.47bd4b3a.js"><link rel="prefetch" href="/assets/demo.html.9bf73476.js"><link rel="prefetch" href="/assets/flex_grid.html.039f21f9.js"><link rel="prefetch" href="/assets/onepx.html.6e6fae00.js"><link rel="prefetch" href="/assets/index.html.4f35415b.js"><link rel="prefetch" href="/assets/canvas.html.0b9dbdba.js"><link rel="prefetch" href="/assets/safety.html.4c9f3b60.js"><link rel="prefetch" href="/assets/index.html.0cce74fe.js"><link rel="prefetch" href="/assets/agile-collections.html.5b850786.js"><link rel="prefetch" href="/assets/component_library_design.html.57e6f2ac.js"><link rel="prefetch" href="/assets/http.html.70f6ea72.js"><link rel="prefetch" href="/assets/https.html.364e436d.js"><link rel="prefetch" href="/assets/microservices.html.87f377aa.js"><link rel="prefetch" href="/assets/miniprogram.html.1b927425.js"><link rel="prefetch" href="/assets/mobile.html.f822daee.js"><link rel="prefetch" href="/assets/network.html.8abed134.js"><link rel="prefetch" href="/assets/performance.html.861ff708.js"><link rel="prefetch" href="/assets/ssr.html.cf622d06.js"><link rel="prefetch" href="/assets/thought.html.a0467a7a.js"><link rel="prefetch" href="/assets/websocket.html.c004853c.js"><link rel="prefetch" href="/assets/index.html.366e0c33.js"><link rel="prefetch" href="/assets/achieve.html.8edec2d4.js"><link rel="prefetch" href="/assets/alwaysNote.html.81a355fc.js"><link rel="prefetch" href="/assets/context_execution_stack_this.html.90a1037d.js"><link rel="prefetch" href="/assets/event_loop.html.da82091f.js"><link rel="prefetch" href="/assets/extend.html.f51a4ffa.js"><link rel="prefetch" href="/assets/learn.html.6b201b66.js"><link rel="prefetch" href="/assets/prototype.html.ede15e09.js"><link rel="prefetch" href="/assets/type_conversion.html.86165e81.js"><link rel="prefetch" href="/assets/usedFunc.html.602b8fa4.js"><link rel="prefetch" href="/assets/var_type.html.5cf071ab.js"><link rel="prefetch" href="/assets/index.html.53f2ccd5.js"><link rel="prefetch" href="/assets/ahooks.html.fa54fd48.js"><link rel="prefetch" href="/assets/build_mini_react.html.94d58c9b.js"><link rel="prefetch" href="/assets/collection.html.5f1371cb.js"><link rel="prefetch" href="/assets/next.html.386670ad.js"><link rel="prefetch" href="/assets/react_around.html.548bee7c.js"><link rel="prefetch" href="/assets/react_hooks.html.af3fc7e9.js"><link rel="prefetch" href="/assets/react_native.html.d3cd7157.js"><link rel="prefetch" href="/assets/Combat.html.34609d70.js"><link rel="prefetch" href="/assets/index.html.37431540.js"><link rel="prefetch" href="/assets/guideAndConfigSetting.html.cbf027d9.js"><link rel="prefetch" href="/assets/jest.html.fd1b2404.js"><link rel="prefetch" href="/assets/rtl.html.42b8cdf8.js"><link rel="prefetch" href="/assets/index.html.c3b1e590.js"><link rel="prefetch" href="/assets/typescript_with_react.html.8b30f403.js"><link rel="prefetch" href="/assets/index.html.91af7fb8.js"><link rel="prefetch" href="/assets/alwaysNote.html.d75c2c3a.js"><link rel="prefetch" href="/assets/vue3.html.4ca6b758.js"><link rel="prefetch" href="/assets/vuex.html.4951eb8e.js"><link rel="prefetch" href="/assets/index.html.ea4fa46d.js"><link rel="prefetch" href="/assets/babel.html.204782be.js"><link rel="prefetch" href="/assets/buildAndModuleFederation.html.af436af0.js"><link rel="prefetch" href="/assets/study_video_summary.html.1b33d598.js"><link rel="prefetch" href="/assets/vite2.html.2d93e477.js"><link rel="prefetch" href="/assets/webpack5.html.01313a5d.js"><link rel="prefetch" href="/assets/404.html.e275e9a9.js"><link rel="prefetch" href="/assets/index.html.6a27dc1c.js"><link rel="prefetch" href="/assets/emptyTemplate.html.b85a3d74.js"><link rel="prefetch" href="/assets/word.html.c6f13ca4.js"><link rel="prefetch" href="/assets/index.html.f4fba08c.js"><link rel="prefetch" href="/assets/backTrack.html.dae5e125.js"><link rel="prefetch" href="/assets/dynamic.html.b4cb4a32.js"><link rel="prefetch" href="/assets/interview.html.07f233e5.js"><link rel="prefetch" href="/assets/leetCode.html.9860dcb4.js"><link rel="prefetch" href="/assets/sort.html.36fcf4a5.js"><link rel="prefetch" href="/assets/index.html.c6afaf4e.js"><link rel="prefetch" href="/assets/blog.html.3f0bcf1d.js"><link rel="prefetch" href="/assets/framework.html.9ed61fd5.js"><link rel="prefetch" href="/assets/index.html.7110e085.js"><link rel="prefetch" href="/assets/leetcode.html.b4fe31b5.js"><link rel="prefetch" href="/assets/index.html.7143c1fa.js"><link rel="prefetch" href="/assets/docker.html.7368c091.js"><link rel="prefetch" href="/assets/index.html.4edc4b7e.js"><link rel="prefetch" href="/assets/index.html.5a0bee1d.js"><link rel="prefetch" href="/assets/fileMerge.html.2dc5279b.js"><link rel="prefetch" href="/assets/koa.html.b3b82e14.js"><link rel="prefetch" href="/assets/index.html.15f19b53.js"><link rel="prefetch" href="/assets/index.html.464954f7.js"><link rel="prefetch" href="/assets/index.html.656ba2f8.js"><link rel="prefetch" href="/assets/howUiLibraryBundle.html.76c4e7b3.js"><link rel="prefetch" href="/assets/monorepoPnpmTurboRepo.html.a0b6922a.js"><link rel="prefetch" href="/assets/webpack5ReactTs.html.bc58c6d0.js"><link rel="prefetch" href="/assets/Combat.html.1ee1bbbb.js"><link rel="prefetch" href="/assets/index.html.bd8862a3.js"><link rel="prefetch" href="/assets/guideAndConfigSetting.html.304599f9.js"><link rel="prefetch" href="/assets/jest.html.ff59c388.js"><link rel="prefetch" href="/assets/rtl.html.eb9ad411.js"><link rel="prefetch" href="/assets/index.html.edbf8c03.js"><link rel="prefetch" href="/assets/microapp.html.6a59be38.js"><link rel="prefetch" href="/assets/qiankun.html.73ec7ed8.js"><link rel="prefetch" href="/assets/BFC.html.5e3a9b58.js"><link rel="prefetch" href="/assets/index.html.0804a9c7.js"><link rel="prefetch" href="/assets/demo.html.a9fc0122.js"><link rel="prefetch" href="/assets/flex_grid.html.ae9b7d53.js"><link rel="prefetch" href="/assets/onepx.html.530eb5a0.js"><link rel="prefetch" href="/assets/index.html.4c465d48.js"><link rel="prefetch" href="/assets/canvas.html.9e423c46.js"><link rel="prefetch" href="/assets/safety.html.e89a6bb9.js"><link rel="prefetch" href="/assets/index.html.3a639b6c.js"><link rel="prefetch" href="/assets/agile-collections.html.3f2c101a.js"><link rel="prefetch" href="/assets/component_library_design.html.8c254c99.js"><link rel="prefetch" href="/assets/http.html.371be1b1.js"><link rel="prefetch" href="/assets/https.html.96caf5ff.js"><link rel="prefetch" href="/assets/microservices.html.f01fca00.js"><link rel="prefetch" href="/assets/miniprogram.html.c4bf36ca.js"><link rel="prefetch" href="/assets/mobile.html.ea9f4507.js"><link rel="prefetch" href="/assets/network.html.f830d4cc.js"><link rel="prefetch" href="/assets/performance.html.59635c36.js"><link rel="prefetch" href="/assets/ssr.html.c36598e4.js"><link rel="prefetch" href="/assets/thought.html.f5b9de62.js"><link rel="prefetch" href="/assets/websocket.html.c8cd49a2.js"><link rel="prefetch" href="/assets/index.html.51d16b26.js"><link rel="prefetch" href="/assets/achieve.html.578c01a2.js"><link rel="prefetch" href="/assets/alwaysNote.html.695933f7.js"><link rel="prefetch" href="/assets/context_execution_stack_this.html.f7a94b2f.js"><link rel="prefetch" href="/assets/event_loop.html.8e7dbbcd.js"><link rel="prefetch" href="/assets/extend.html.d74cdb4f.js"><link rel="prefetch" href="/assets/learn.html.6ea6a0a4.js"><link rel="prefetch" href="/assets/prototype.html.b229711a.js"><link rel="prefetch" href="/assets/type_conversion.html.3ff094c9.js"><link rel="prefetch" href="/assets/usedFunc.html.3990e5f7.js"><link rel="prefetch" href="/assets/var_type.html.e3fb9e7f.js"><link rel="prefetch" href="/assets/index.html.0592ef58.js"><link rel="prefetch" href="/assets/ahooks.html.8800918c.js"><link rel="prefetch" href="/assets/build_mini_react.html.7a612060.js"><link rel="prefetch" href="/assets/collection.html.f6c30145.js"><link rel="prefetch" href="/assets/next.html.a80dcfdf.js"><link rel="prefetch" href="/assets/react_around.html.4fc7c087.js"><link rel="prefetch" href="/assets/react_hooks.html.e1631c1a.js"><link rel="prefetch" href="/assets/react_native.html.fb20f501.js"><link rel="prefetch" href="/assets/Combat.html.a6cbafdf.js"><link rel="prefetch" href="/assets/index.html.b71f7b76.js"><link rel="prefetch" href="/assets/guideAndConfigSetting.html.3f037b6c.js"><link rel="prefetch" href="/assets/jest.html.139dcba9.js"><link rel="prefetch" href="/assets/rtl.html.1002d838.js"><link rel="prefetch" href="/assets/index.html.0dfc29b6.js"><link rel="prefetch" href="/assets/typescript_with_react.html.96bf6c82.js"><link rel="prefetch" href="/assets/index.html.3f4db987.js"><link rel="prefetch" href="/assets/alwaysNote.html.b2b6c364.js"><link rel="prefetch" href="/assets/vue3.html.0fa33c98.js"><link rel="prefetch" href="/assets/vuex.html.027cf6de.js"><link rel="prefetch" href="/assets/index.html.c6de05f2.js"><link rel="prefetch" href="/assets/babel.html.e717e2db.js"><link rel="prefetch" href="/assets/buildAndModuleFederation.html.f9118144.js"><link rel="prefetch" href="/assets/study_video_summary.html.507ea37c.js"><link rel="prefetch" href="/assets/vite2.html.af0dc41a.js"><link rel="prefetch" href="/assets/webpack5.html.f8079cc6.js"><link rel="prefetch" href="/assets/404.html.dc00881d.js"><link rel="prefetch" href="/assets/404.ec588716.js"><link rel="prefetch" href="/assets/Layout.85c1d8ed.js"><link rel="prefetch" href="/assets/BlogLayout.e149c777.js"><link rel="prefetch" href="/assets/iconfont.81ae27d8.js"><link rel="prefetch" href="/assets/index.0b6f9a66.js">
    <link rel="stylesheet" href="/assets/style.d41d4842.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/icons/128.ico" alt="Sysuke&#39; World"><span class="site-name can-hide">Sysuke&#39; World</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/fe/js" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/vue" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/typescript" class="" aria-label="Typescript"><!--[--><!--]--> Typescript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/react" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/css" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/dom" class="" aria-label="Dom"><!--[--><!--]--> Dom <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/webpack" class="" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/test" class="" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/frameWork" class="" aria-label="frameWork"><!--[--><!--]--> frameWork <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/MicroFrontends" class="" aria-label="微前端"><!--[--><!--]--> 微前端 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/algorithm/" class="" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/binaryTree" class="" aria-label="二叉树"><!--[--><!--]--> 二叉树 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/sort" class="" aria-label="排序算法"><!--[--><!--]--> 排序算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/leetcode" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/dynamic" class="" aria-label="动态规划"><!--[--><!--]--> 动态规划 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/backTrack" class="" aria-label="回溯算法"><!--[--><!--]--> 回溯算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/interview" class="" aria-label="面试记录"><!--[--><!--]--> 面试记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/backEnd/node" class="" aria-label="后端"><!--[--><!--]--> 后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/interview/" class="" aria-label="面试"><!--[--><!--]--> 面试 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/demo" class="" aria-label="Demo"><!--[--><!--]--> Demo <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/qinsong77/qinsong77.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/fe/js" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/vue" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/typescript" class="" aria-label="Typescript"><!--[--><!--]--> Typescript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/react" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/css" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/dom" class="" aria-label="Dom"><!--[--><!--]--> Dom <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/webpack" class="" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/test" class="" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/frameWork" class="" aria-label="frameWork"><!--[--><!--]--> frameWork <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/MicroFrontends" class="" aria-label="微前端"><!--[--><!--]--> 微前端 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/algorithm/" class="" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/binaryTree" class="" aria-label="二叉树"><!--[--><!--]--> 二叉树 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/sort" class="" aria-label="排序算法"><!--[--><!--]--> 排序算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/leetcode" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/dynamic" class="" aria-label="动态规划"><!--[--><!--]--> 动态规划 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/backTrack" class="" aria-label="回溯算法"><!--[--><!--]--> 回溯算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/interview" class="" aria-label="面试记录"><!--[--><!--]--> 面试记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/backEnd/node" class="" aria-label="后端"><!--[--><!--]--> 后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/interview/" class="" aria-label="面试"><!--[--><!--]--> 面试 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/demo" class="" aria-label="Demo"><!--[--><!--]--> Demo <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/qinsong77/qinsong77.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--[--><div class="theme-default-content"><h1 style="padding-bottom:0;margin-bottom:0;">Rollup 打包 React 组件库</h1></div><!--]--><!--]--><div class="theme-default-content"><!--[--><hr><nav class="table-of-contents"><ul><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#webpack-vs-rollup" class="router-link-active router-link-exact-active">webpack vs rollup</a><ul><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#为什么不用-webpack" class="router-link-active router-link-exact-active">为什么不用 webpack</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#webpack打包实现按需加载" class="router-link-active router-link-exact-active">webpack打包实现按需加载</a></li></ul></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#正题rollup" class="router-link-active router-link-exact-active">正题rollup</a><ul><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#first-打包一个-js-文件" class="router-link-active router-link-exact-active">first, 打包一个 js 文件</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#rollup-配置文件" class="router-link-active router-link-exact-active">rollup 配置文件</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#rollup-插件" class="router-link-active router-link-exact-active">rollup 插件</a></li></ul></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#项目基本配置说明" class="router-link-active router-link-exact-active">项目基本配置说明</a><ul><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#typescript配置" class="router-link-active router-link-exact-active">typescript配置</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#babel" class="router-link-active router-link-exact-active">babel</a></li></ul></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#rollup配置" class="router-link-active router-link-exact-active">rollup配置</a><ul><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#怎么处理typescript" class="router-link-active router-link-exact-active">怎么处理Typescript</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#如何排除公共依赖不打包仅组件中" class="router-link-active router-link-exact-active">如何排除公共依赖不打包仅组件中</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#rollup-plugin-babel" class="router-link-active router-link-exact-active">@rollup/plugin-babel</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#完整配置" class="router-link-active router-link-exact-active">完整配置</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#如何支持-scss-less" class="router-link-active router-link-exact-active">如何支持 scss/less</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#组件按目录结构输出" class="router-link-active router-link-exact-active">组件按目录结构输出</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#如何调试" class="router-link-active router-link-exact-active">如何调试</a></li></ul></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#总结" class="router-link-active router-link-exact-active">总结</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#踩坑记录" class="router-link-active router-link-exact-active">踩坑记录</a></li><li><a aria-current="page" href="/blog/architecture/rollup-build-react-library.html#reference" class="router-link-active router-link-exact-active">Reference</a></li></ul></nav><p><a href="https://rollupjs.org/guide/en/" target="_blank" rel="noopener noreferrer"><code>rollup</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 是一个 <code>JavaScript</code> 模块打包器，在功能上要完成的事和<code>webpack</code>性质一样，就是将 小块代码编译成大块复杂的代码，例如 <code>library</code> 或应用程序。但应用程序<code>webpack</code>都是首选，相比之下，<code>rollup</code>更多是用于 <code>library</code> 打包，比如熟悉 的<a href="https://github.com/vuejs/vue/blob/main/scripts/config.js" target="_blank" rel="noopener noreferrer">vue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="https://github.com/facebook/react/tree/main/scripts/rollup" target="_blank" rel="noopener noreferrer">react<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<code>vuex</code>、 等都是用 <code>rollup</code> 进行打包的。</p><h2 id="webpack-vs-rollup" tabindex="-1"><a class="header-anchor" href="#webpack-vs-rollup" aria-hidden="true">#</a> webpack vs rollup</h2><blockquote><p>webpack 更适合对于应用的打包，rollup 更适合对于库的打包。</p></blockquote><h3 id="为什么不用-webpack" tabindex="-1"><a class="header-anchor" href="#为什么不用-webpack" aria-hidden="true">#</a> 为什么不用 webpack</h3><ul><li>webpack 打包成<code>ES module</code>在目前版本<code>5.74.0</code>还是实验性质的 Api，见<a href="https://webpack.js.org/configuration/output/#type-module" target="_blank" rel="noopener noreferrer">output-type<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>， 而<a href="https://juejin.cn/post/7135217402983235592" target="_blank" rel="noopener noreferrer"><code>tree-shaking</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 是建立在<code>ES module</code>之上的，无论是作为一个 JS library 还 是组件库，这个特性在 2022 年的今天都是必备可少的（tree-shaking 按需加载）。而这个恰好是 <code>rollup</code> 的强项，要知道 <code>tree-shaking</code> 就是 rollup 率先提出的。</li><li>webpack 打包后得代码不精简，注入代码多，比如webpack打包的文件会添加一些自定义的模块加载代码<code>__webpack_require__</code>等工具函数，这些是一个library 库所不需要的。打包后的体积也比 <code>rollup</code> 的大。</li><li>rollup Api 更简单纯粹（只是相比 webpack, config option 还是挺多的，但核心api就那几个，其实大部分用不上)，更容易配置出自己想要的 <code>output</code></li></ul><p>而 <code>Webpack </code>对于代码分割、静态资源导入、热更新、dev server等有着先天优势，相比 <code>rollup</code> 大而全，所以更适合 App 打包。所以常说<em>Rollup for libraries, Webpack for apps</em></p><h3 id="webpack打包实现按需加载" tabindex="-1"><a class="header-anchor" href="#webpack打包实现按需加载" aria-hidden="true">#</a> webpack打包实现按需加载</h3><p>其实 <code>webpack</code> 在不开启实验性质输出<code>ES module</code>而是输出<code>cjs</code>下，也能实现按需加载，但要<strong>借助 babel 插件</strong>，即像<code>element-ui</code>这样</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;element-ui&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>打包输出的是 <code>cjs</code>，但是按<strong>固定的文件夹目录输出</strong>，即你的每个函数或者组件的入口都是 <code>webpack</code> 配置的<code>entry</code>，把每个组件打包成一个单独 的文件，再配合插件<a href="https://www.npmjs.com/package/babel-plugin-component" target="_blank" rel="noopener noreferrer">babel-plugin-component<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，就会转成</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> button <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;element-ui/lib/button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;element-ui/lib/theme-chalk/button.css&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>同时实现了js和css的按需加载。</p><p>老版本的 <code>ant-design</code> 也是类似的，使用<a href="https://www.npmjs.com/package/babel-plugin-import" target="_blank" rel="noopener noreferrer">babel-plugin-import<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>按需加载 js 和 css 文件，最新的也是使用打包成 ES module <code>tree-shaking</code>了。 <code>babel-plugin-import</code> 插件通过<strong>引入固定路径</strong>的组件及组件 样式，替代手动 shaking 的过程。由此也可以确定打包后的文件路径（组件要求 lib/xx，样式文件要求 lib/xx/style/xx）和文件模 块<strong>CommonJs</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span>xxxx<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// then</span>
<span class="token keyword">var</span> _button <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;antd/lib/button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;antd/lib/button/style/css&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>_button<span class="token operator">&gt;</span>xxxx<span class="token operator">&lt;</span><span class="token operator">/</span>_button<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>但都 2022 年了，这种方式直接 pass 吧。</p><h2 id="正题rollup" tabindex="-1"><a class="header-anchor" href="#正题rollup" aria-hidden="true">#</a> 正题rollup</h2><h3 id="first-打包一个-js-文件" tabindex="-1"><a class="header-anchor" href="#first-打包一个-js-文件" aria-hidden="true">#</a> first, 打包一个 js 文件</h3><p>初始化</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token string">&quot;rollup-react-component-library&quot;</span>
<span class="token builtin class-name">cd</span> rollup-react-component-library
<span class="token function">pnpm</span> init
<span class="token function">pnpm</span> <span class="token function">add</span> rollup -D
<span class="token function">mkdir</span> src
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在 <code>package.json</code> 的 <code>script</code> 字段中添加并执行：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token string">&quot;dev&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rollup -i src/index.js -o dist/bundle.js -f es&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="/assets/bundle1.d3b8ad8c.png" alt=""></p><p>在这段指令中：</p><ul><li><p><code>-i</code>指定要打包的文件，<code>-i</code>是<code>--input</code>的缩写。</p></li><li><p><code>src/index.js</code>是<code>-i</code>的参数，即打包入口文件。</p></li><li><p><code>-o</code>指定输出的文件，是<code>--output.file</code>或<code>--file</code>的缩写。(如果没有这个参数，则直接输出到控制台)</p></li><li><p><code>dist/bundle.js</code>是<code>-o</code>的参数，即输出文件。</p></li><li><p><code>-f</code>指定打包文件的格式，<code>-f</code>是<code>--format</code>的缩写。</p></li><li><p><code>es</code>是<code>-f</code>的参数，表示打包文件使用 ES6 模块规范。</p></li></ul><p><code>rollup</code> 支持的打包文件的格式有<code>amd, cjs, es\esm, iife, umd</code>。其中，amd 为 AMD 标准，cjs 为 CommonJS 标准(NodeJs)，esm\es 为 ES 模块标准，iife 为立即调用函数(浏览器)， <code>umd</code>同时支持 amd、cjs 和 iife。</p><h3 id="rollup-配置文件" tabindex="-1"><a class="header-anchor" href="#rollup-配置文件" aria-hidden="true">#</a> rollup 配置文件</h3><p>在实际的工程中，都是使用配置文件，这不仅可以简化命令行操作，同时还能启用 <code>rollup</code> 的高级特性。</p><p>在项目根目录下创建<code>rollup.config.js</code>。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&#39;./dist/my-lib-umd.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;umd&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 当入口文件有export时，&#39;umd&#39;格式必须指定name</span>
      <span class="token comment">// 这样，在通过&lt;script&gt;标签引入时，才能通过name访问到export的内容。</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;myLib&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&#39;./dist/my-lib-es.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;es&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&#39;./dist/my-lib-cjs.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;cjs&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>使用 <code>Rollup</code> 的配置文件，可以使用<code>rollup --config</code>或者<code>rollup -c</code>指令。</p><div class="language-json5 ext-json5 line-numbers-mode"><pre class="language-json5"><code><span class="token comment">//修改package.json的script字段</span>
<span class="token punctuation">{</span>
  <span class="token property unquoted">dev</span><span class="token operator">:</span> <span class="token string">&#39;rollup -c&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 默认使用rollup.config.js</span>
  <span class="token property unquoted">dev</span><span class="token operator">:</span> <span class="token string">&#39;rollup -c my.config.js&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 使用自定义的配置文件，my.config.js</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/assets/bundle2.2ed8834d.png" alt=""> 可以看出，同样的入口文件，<code>es</code>格式的文件体积最小。</p><p>在没有其他开发依赖，其实这样一个简单的 Js Sdk 的打包就配置完成的了。但现实往往没那么简单啊。</p><h3 id="rollup-插件" tabindex="-1"><a class="header-anchor" href="#rollup-插件" aria-hidden="true">#</a> rollup 插件</h3><p>rollup 插件只有插件扩展功能，相当于兼顾了 webpack 的<code>loader</code>和<code>plugin</code>，常用插件：</p><ul><li><code>@rollup/plugin-node-resolve</code>, 使用<a href="https://nodejs.org/api/modules.html#all-together" target="_blank" rel="noopener noreferrer">node resolution algorithm <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>查找 模块，让 rollup 能够识别<code>node_modules</code>的第三方模块。这些<code>dependencies</code>应该在<code>package.json</code>中。</li><li><code>@rollup/plugin-commonjs</code>, rollup 默认是不支持 CommonJS 模块的，将 <code>CommonJS </code>的模块转换为 ES2015 供 rollup 处理。所以 应该搭配<code>@rollup/plugin-node-resolve</code>使用，去打包那些 CommonJS dependencies</li><li><code>@rollup/plugin-babel</code>, rollup 的集成 babel 插件，即使用 babel 编译文件</li><li><code>@rollup/plugin-typescript</code>, 更好的集成 ts 的插件，比如可以做 ts=&gt;js</li><li><code>rollup-plugin-visualizer</code>, 类似 webpack-bundle-analyzer,但展示的 bundle-size 图没有 webpack 那个好用</li><li><code>rollup-plugin-terser</code>, <a href="https://www.npmjs.com/package/terser" target="_blank" rel="noopener noreferrer">terser<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>代码压缩</li><li><code>rollup-plugin-postcss</code>，处理 css，支持 css 文件的加载、css 加前缀、css 压缩、scss/less 等</li><li><code>rollup-plugin-peer-deps-external</code>，自动提取 package.json 中的依赖，再放入 <code>external</code> 配置中</li><li><code>@rollup/plugin-replace</code>，打包时替换设置的字符串</li><li><code>rollup-plugin-dts</code> 生成<code>.d.ts</code>文件</li><li><a href="https://github.com/rollup/plugins" target="_blank" rel="noopener noreferrer">官方插件列表<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="项目基本配置说明" tabindex="-1"><a class="header-anchor" href="#项目基本配置说明" aria-hidden="true">#</a> 项目基本配置说明</h2><p>这里最终的产出是一个按需加载的 React 组件库，使用的技术即<code>react、typescript、@emotion/react, Material UI</code></p><ul><li>这里 css 方案采用的 <code>css-in-js</code>，打包会比其他方案更简单， React组件库的 css 方案没有一种占统治地位，现有的各种方案都有各 自的优缺点，因此选择一种合适的样式方案需要综合考虑很多方面。推荐文 章<a href="https://segmentfault.com/a/1190000041840130" target="_blank" rel="noopener noreferrer">React 组件库 CSS 样式方案分析<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。后面会讲一下怎么处理要单独输出 style 文件。</li><li><code>Material UI </code>引入是想更好的测试 <code>tree-shaking</code>，二次封装组件库也是实际业务常见的需求。</li></ul><p>组件结构，button 简单示列：</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>|-- src 
    |-- Button 
    | |-- Button.tsx 
    | |-- index.ts
    | |-- types.d.ts 
|-- index.ts
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>Button.tsx</code></p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> css <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@emotion/react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ButtonProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./types&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token string">&#39;white&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cssBtn <span class="token operator">=</span> css<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  padding: 8px;
  background-color: hotpink;
  font-size: 14px;
  border-radius: 4px;
  &amp;:hover {
    color: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
  }
  border: 1px solid gray;
  transition: color 0.3s ease-in-out;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Button<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>ButtonProps<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">css</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>cssBtn<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hover to change color.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Button<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><code>types.d.ts</code></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ButtonProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>index.ts</code></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./Button&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./Button&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ButtonProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./types&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>src/index.ts</code></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./Button&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./Button&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// export type { ButtonProps } from &#39;./Button&#39;;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="typescript配置" tabindex="-1"><a class="header-anchor" href="#typescript配置" aria-hidden="true">#</a> typescript配置</h3><p>这里打包时输出的类型文件时使用<code>tsc</code>构建输出的，</p><p><code>tsconfig.type.json</code></p><div class="language-json5 ext-json5 line-numbers-mode"><pre class="language-json5"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./tsconfig.json&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/*__tests__&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 允许输出</span>
    <span class="token property">&quot;noEmit&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;declaration&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 只输出类型</span>
    <span class="token property">&quot;emitDeclarationOnly&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rootDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;outDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>package.json</code></p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build:type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc -b --force --verbose tsconfig.type.json&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>tsc: <code>-b</code> 即代表<code>--build</code>,<code>tsc -b</code>还支持其它一些选项： <ul><li>--verbose：打印详细的日志（可以与其它标记一起使用）</li><li>--dry: 显示将要执行的操作但是并不真正进行这些操作</li><li>--clean: 删除指定工程的输出（可以与<code>--dry一</code>起使用）</li><li>--force: 把所有工程当作非最新版本对待</li><li>--watch: 观察模式（可以与<code>--verbose</code>一起使用）</li></ul></li></ul><h3 id="babel" tabindex="-1"><a class="header-anchor" href="#babel" aria-hidden="true">#</a> babel</h3><p>babel配置可见后续<code>@rollup/plugin-babel</code>小节。</p><h2 id="rollup配置" tabindex="-1"><a class="header-anchor" href="#rollup配置" aria-hidden="true">#</a> rollup配置</h2><p>先安装rollup两个必用到基础插件，作用见上插件列表说明。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">add</span> @rollup/plugin-node-resolve @rollup/plugin-commonjs -D
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="怎么处理typescript" tabindex="-1"><a class="header-anchor" href="#怎么处理typescript" aria-hidden="true">#</a> 怎么处理Typescript</h3><p>借助 <code>@babel/preset-typescript</code> 的能力，直接转译 ts 代码，一步到位，而不是采用<code> @rollup/plugin-typescript</code> 先将 ts 转成 js 然后再交给<code> @rollup/plugin-babel</code> 再转换一次，增加了适配成本。</p><h3 id="如何排除公共依赖不打包仅组件中" tabindex="-1"><a class="header-anchor" href="#如何排除公共依赖不打包仅组件中" aria-hidden="true">#</a> 如何排除公共依赖不打包仅组件中</h3><p>使用 <a href="https://rollupjs.org/guide/en/#external" target="_blank" rel="noopener noreferrer"><code>external</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 配置，将不需要打包依赖加进去；有些时候会使用依赖的子一级文件 ，所以这个 <code>external</code> 可以是一个函数，其参数是引用的依赖地址，返回值是一个 boolean <code>true</code> 则表示，这个依赖不会被打包进去. 可以使用<a href="https://www.npmjs.com/package/rollup-plugin-peer-deps-external" target="_blank" rel="noopener noreferrer">rollup-plugin-peer-deps-external<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>插件。</p><h3 id="rollup-plugin-babel" tabindex="-1"><a class="header-anchor" href="#rollup-plugin-babel" aria-hidden="true">#</a> <code>@rollup/plugin-babel</code></h3><p>用于转换 es6 语法、ts、react-jsx。安装</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">add</span> @rollup/plugin-babel -D
<span class="token function">pnpm</span> <span class="token function">add</span> @babel/core @babel/preset-env @babel/preset-react @babel/preset-typescript -D
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>babel.config.js</code>配置如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;@babel/preset-env&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token string">&#39;@babel/preset-react&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">runtime</span><span class="token operator">:</span> <span class="token string">&#39;automatic&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">importSource</span><span class="token operator">:</span> <span class="token string">&#39;@emotion/react&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&#39;@babel/preset-typescript&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@emotion&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;@babel/plugin-transform-runtime&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这里<code>@babel/plugin-transform-runtime</code> 用于避免污染全局函数（不是必须要用到，但作为类库最好要加上）。 rollup 中的配置如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-babel&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      extensions<span class="token punctuation">,</span>
      <span class="token literal-property property">babelHelpers</span><span class="token operator">:</span> <span class="token string">&#39;runtime&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">&#39;node_modules/**&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="plugin-transform-runtime" tabindex="-1"><a class="header-anchor" href="#plugin-transform-runtime" aria-hidden="true">#</a> plugin-transform-runtime</h5><blockquote><p>A plugin that enables the re-use of Babel&#39;s injected helper code to save on codesize.</p></blockquote><p>为了浏览器向下兼容，会使用 <code>@babel/preset-env</code> 对每个文件的 ES6 语法进行转换，我们称之为辅助函数。</p><p>但样这做存在一个问题。在正常的前端工程开发的时候，少则几十个 js 文件，多则上千个。如果每个文件里都使用了 class 类语法， 那会导致每个转换后的文件上部都会注入这些相同的函数声明。这会用构建工具打包出来的包非常大,包含大量重复代码。一个思路就是 ，把这些函数声明都放在一个<code>npm包</code>里，需要使用的时候直接从这个包里引入到我们的文件里。这样即使上千个文件，也会从相同地包 里引用这些函数。通过 <code>rollup/webpack</code> 这一类的构建工具打包的时候，只会把使用到的 npm 包里的函数引入一次，这样就做到了复 用，减少了体积。</p><p>安装 <code>@babel/runtime</code>包提供辅助函数模块，且是安装到<code>dependencies</code>，安装 Babel 插件 <code>@babel/plugin-transform-runtime</code> 来 自动替换辅助函数。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">add</span> @babel/runtime
<span class="token function">pnpm</span> <span class="token function">add</span> @babel/plugin-transform-runtime -D
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>效果如下：即如是这样导入 help 函数的<code>import _defineProperty from &#39;@babel/runtime/helpers/defineProperty&#39;;</code><img src="/assets/bundlebabel.e18a7ff8.png" alt=""></p><h3 id="完整配置" tabindex="-1"><a class="header-anchor" href="#完整配置" aria-hidden="true">#</a> 完整配置</h3><h4 id="package-json" tabindex="-1"><a class="header-anchor" href="#package-json" aria-hidden="true">#</a> package.json</h4><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dist&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.cjs.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.esm.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.d.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;.&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.esm.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.cjs.js&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;copy-d.ts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;copyfiles -u 1 src/**/*.d.ts dist&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc -b --force --verbose tsconfig.type.json &amp;&amp; pnpm run copy-d.ts&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pnpm run build:type &amp;&amp; rollup -c -w --environment NODE_ENV:development&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:all&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rm -rf dist &amp;&amp; pnpm run build:type &amp;&amp; rollup -c --environment NODE_ENV:production&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;peerDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;react&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&gt;=16.8.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;react-dom&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&gt;=16.8.0&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@babel/runtime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.18.9&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@emotion/react&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^11.10.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@emotion/styled&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^11.10.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@mui/icons-material&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.10.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@mui/material&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.10.3&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><ul><li>files: 定义你的 NPM 包中要包含哪些文件</li><li>main: 定义 CommonJS 入口,<code>main</code> 是一个当打包工具或运行时不支持 <code>package.json#exports</code> 时的兜底方案；如果打包工具或运行 时支持 <code>package exports</code>，则不会使用 <code>main</code>。 <code>main</code> 应该指向一个兼容 <code>CommonJS</code> 格式的产出；它应该与 <code>package exports</code> 中的 <code>require</code> 保持一致。</li><li>types: 定义 TypeScript 类型</li><li>exports: 为你的库定义公共 API</li><li>sideEffects: 来允许 <code>treeshaking</code>, <code>false</code>代表所有模块都是“纯”的，没有副作用</li><li>peerDependencies：如果你依赖别的框架或库，将它设置为 peer dependency</li></ul><p>更多的详细自动可参 考<a href="https://github.com/frehner/modern-guide-to-packaging-js-library/blob/main/README-zh_CN.md" target="_blank" rel="noopener noreferrer">打包 JavaScript 库的现代化指南<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ul><li>copyfiles: 后续会讲到，主要是 <code>tsc build </code>时不会处理<code>.d.ts</code>文件，单独复制。</li><li>tsc: <code>-b</code> 即代表<code>--build</code>,<code>tsc -b</code>还支持其它一些选项： <ul><li><code>--verbose</code>：打印详细的日志（可以与其它标记一起使用）</li><li><code>--dry</code>: 显示将要执行的操作但是并不真正进行这些操作</li><li><code>--clean</code>: 删除指定工程的输出（可以与<code>--dry一</code>起使用）</li><li><code>--force</code>: 把所有工程当作非最新版本对待</li><li><code>--watch</code> : 观察模式（可以与<code>--verbose</code>一起使用）</li></ul></li><li>rollup: <code>-w</code> 即<code>-watch</code>监听模式</li><li>rollup: <code>--environment NODE_ENV:development</code>, 设置环境变量<a href="https://rollupjs.org/guide/en/#--environment-values" target="_blank" rel="noopener noreferrer">environment-values<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h4 id="rollup-config-js" tabindex="-1"><a class="header-anchor" href="#rollup-config-js" aria-hidden="true">#</a> rollup.config.js</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-node-resolve&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-commonjs&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-babel&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> replace <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-replace&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> externalDep <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-peer-deps-external&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-terser&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> visualizer <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-visualizer&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token string">&#39;./src/index.ts&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> extensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;.ts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.tsx&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.jsx&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isProd <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    input<span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&#39;dist/index.esm.js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;esm&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&#39;dist/index.cjs.js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;cjs&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 设置打入output file，包括peerDependencies和dependencies</span>
      <span class="token function">externalDep</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// dependencies也不打包进output</span>
        <span class="token literal-property property">includeDependencies</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        extensions<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        extensions<span class="token punctuation">,</span>
        <span class="token literal-property property">babelHelpers</span><span class="token operator">:</span> <span class="token string">&#39;runtime&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">&#39;node_modules/**&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// production时压缩</span>
      isProd <span class="token operator">&amp;&amp;</span>
      <span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// drop_console: true,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token operator">!</span>isProd <span class="token operator">&amp;&amp;</span>
      <span class="token function">visualizer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;rollup-bundle-report.html&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>输出大概是这样： <img src="/assets/output1.90d14f09.png" alt=""></p><p>虽然是输出的单文件的打包文件，但支持 <code>es module</code>，也是支持 <code>tree-shaking</code> 的。这样一个组件库的打包就基本完成了。</p><h3 id="如何支持-scss-less" tabindex="-1"><a class="header-anchor" href="#如何支持-scss-less" aria-hidden="true">#</a> 如何支持 scss/less</h3><p>组件的样式方案是<strong>样式和逻辑分离</strong>，这种方案的优点有：</p><ul><li><p>适用性广泛，可以支持组件库使用者的各种开发环境。</p></li><li><p>不限制组件库的技术栈，同一套样式可以用在基于多个框架的组件库上。</p></li><li><p>无需考虑对 SSR（服务端渲染）的支持，对外提供的是 CSS 文件，因此 SSR 流程完全交给组件库的使用者控制。</p></li><li><p>可以直接对外提供 less、sass 等源文件，便于外部覆盖变量，实现主题定制或换肤等功能。但是这种方案也有一些问题：</p></li><li><p>需要使用者手动引入样式文件。如果直接引入了完整的 CSS 文件，而在实际使用中并没有用到组件库里的全部组件，就会造成一些无 用的样式被打包进项目中。</p></li><li><p>让组件库支持 CSS 按需引入的功能会比较复杂，既需要组件库的开发者在打包流程和产物上进行处理，又需要使用者按照一定规则引 入样式文件。首先组件库开发者需要定一套样式文件的目录组织规范，使其能在打包流程中支持以组件为单位打包样式文件，之后使用 者就可以按需手动引入对应组件的样式文件。对于具有特定目录组织规范的组件库，目前已经有插件可以在编译阶段辅助生成引入样式 的 import 语句，例如 <code>babel-plugin-import</code>、<code>unplugin-vue-components</code> 等。如开篇讲的列子</p></li><li><p>如果组件库内部的组件存在引用关系，为了实现按需引入，打包出来的组件的样式可能会存在冗余。</p></li></ul><h4 id="如何配置" tabindex="-1"><a class="header-anchor" href="#如何配置" aria-hidden="true">#</a> 如何配置</h4><p>安装插件，<code>rollup-plugin-postcss</code>支持 css 文件的加载、css 加前缀、css 压缩、对 scss/less 的支持，用这个就能搞定。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">add</span> postcss rollup-plugin-postcss --dev
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>添加到 rollup</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> postcss <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-postcss&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// input: ...,</span>
  <span class="token comment">// output: ...,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这样子只会在 umd 下生效，css 样式生成<code>style</code>标签内联到<code>head</code>中。在工程中使用一般需要额外引入样式文件。所以需要抽离单独的 css 文件。<code>rollup-plugin-postcss</code>配置即可，另外还要启用<code>modules</code>, 即<strong>CSS modules</strong>，隔离组件库样式。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">extract</span><span class="token operator">:</span> <span class="token string">&#39;index.css&#39;</span><span class="token punctuation">,</span>
  <span class="token comment">// 压缩</span>
  <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// Enable CSS modules</span>
  <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>启用<code>CSS modules</code>后，样式引用要改为：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> AlertProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./types&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> css <span class="token keyword">from</span> <span class="token string">&#39;./style.css&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Alert<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>AlertProps<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>css<span class="token punctuation">.</span>alert<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Alert</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Alert<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>输出的<code>className</code>才能和 <code>index.css</code> 中匹配</p><p><code>index.css</code></p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.style_alert__ZRjcy</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #535bf2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>额外配置</li></ul><ol><li><code>css modules</code> typescript 报错，新增文件<code>global.d.ts</code>:</li></ol><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&#39;*.css&#39;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> css<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> css<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>在测试包时，<code>import &#39;rollup-react-component-library/dist/index.css&#39;</code>引入<code>dist</code>的<code>index.css</code>时 webpack 出现错误找不到模块；</li></ol><p>参考问题<a href="https://github.com/vitejs/vite/discussions/2657" target="_blank" rel="noopener noreferrer">Declare .css in package.json exports<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，package.json 新增配置即可</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;.&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.esm.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.cjs.js&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;./dist/index.css&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.css&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.css&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.sass&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.scss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.css&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="3"><li>sideEffects 要从<code>false</code> =&gt; 如上，不然 <code>webpack</code>会把<code>import</code>的css tree-shaking 掉</li></ol><h4 id="css-加前缀" tabindex="-1"><a class="header-anchor" href="#css-加前缀" aria-hidden="true">#</a> css 加前缀</h4><p>借助<code>autoprefixer</code>插件来给<code>css3</code>的一些属性加前缀。安装<code>pnpm i autoprefixer@8.0.0 -D</code>，配置：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> postcss <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-postcss&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> autoprefixer <span class="token keyword">from</span> <span class="token string">&#39;autoprefixer&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">autoprefixer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>使用<code>autoprefixer</code>除了以上配置，还需要配置<code>browserslis</code>t，有 2 种方式，一种是建立<code>.browserslistrc</code>文件，另一种是直接在 package.json 里面配置，我们在 package.json 中，添加<code>browserslist</code>字段。</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;browserslist&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;defaults&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;not ie &lt; 8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;last 2 versions&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&gt; 1%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;iOS 7&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;last 3 iOS versions&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="css-压缩" tabindex="-1"><a class="header-anchor" href="#css-压缩" aria-hidden="true">#</a> css 压缩</h4><p>即开启<code>minimize</code>选项。实际上使用的<a href="https://www.npmjs.com/package/cssnano" target="_blank" rel="noopener noreferrer">cssnano<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>压缩。</p><h4 id="支持-scss-less" tabindex="-1"><a class="header-anchor" href="#支持-scss-less" aria-hidden="true">#</a> 支持 scss/less</h4><p>项目中一般不会写 css，而是用<code>scss</code>或<code>less</code>等预编译器。<code>rollup-plugin-postcss</code>默认集成了对<code>scss、less、stylus</code>的支持。但额外需要 安装依赖，如官网所示：</p><ul><li>For Sass install node-sass: <code>pnpm add node-sass --dev</code></li><li>For Stylus Install stylus: <code>pnpm add stylus --dev</code></li><li>For Less Install less: <code>pnpm add less --dev</code></li></ul><p>以上的<strong>样式和逻辑分离</strong>方案才基本可用，可以发现比<code>css-in-js</code>麻烦多了，而且现在还未实现样式的按需加载，要想使用者使用方便，就要按组件目录结构输出样式目录，用于<code>sideEffects</code>配置和<code>babel</code>插件（这块开头有讲过）。</p><h3 id="组件按目录结构输出" tabindex="-1"><a class="header-anchor" href="#组件按目录结构输出" aria-hidden="true">#</a> 组件按目录结构输出</h3><h4 id="rollup-plugin-postcss-rollup-plugin-styles" tabindex="-1"><a class="header-anchor" href="#rollup-plugin-postcss-rollup-plugin-styles" aria-hidden="true">#</a> <code>rollup-plugin-postcss</code> =&gt; <code>rollup-plugin-styles</code></h4><p>上面的<code>rollup-plugin-postcss</code> 这个插件只会把所有组件的样式抽离抽离出一个单独的文件，适合输出到<code>dist</code>文件夹，但这个场景下， 在查找一番后，要使用<a href="https://www.npmjs.com/package/rollup-plugin-styles" target="_blank" rel="noopener noreferrer"><code>rollup-plugin-styles</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 这个插件，它可以与 以下会用到的rollup output的<code>preserveModules </code>做适配，即输出按照组件维度拆分的 css 文件，不过要想正确地实现这个功能需要做一些配置。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">add</span> rollup-plugin-styles -D
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="output-preservemodules" tabindex="-1"><a class="header-anchor" href="#output-preservemodules" aria-hidden="true">#</a> <a href="https://rollupjs.org/guide/en/#outputpreservemodules" target="_blank" rel="noopener noreferrer">output.preserveModules<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>这里组件按原始目录结构输出使用 <a href="https://rollupjs.org/guide/en/#outputpreservemodules" target="_blank" rel="noopener noreferrer">output.preserveModules<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> , <code>output.preserveModulesRoot</code>，中文官网还没有配置，所以文档还是看英文的最新，关于这个配置，看了挺多 比较常见的组件库，都没有用这个配置输出，一般都是用<code>rollup</code>输出单一打包文件，后来是翻到一下文章有提到这样也可以实现，而这个配置主要是</p><blockquote><p>Instead of creating as few chunks as possible, this mode will create separate chunks for all modules using the original module names as file names. Requires the <code>output.dir</code> option. Tree-shaking will still be applied, suppressing files that are not used by the provided entry points or do not have side effects when executed. This mode can be used to transform a file structure to a different module format.</p></blockquote><p>和常规模式尽可能创建更少的<code>chunk</code>不一样，这个模式会按原始的模块划分，分别输出文件，要求<code>output.dir</code>必须声明，即输出的是目录，之前的<code>out.file</code>就不能用了，且Tree-shaking依然适用。</p><p>实现主要思路是查找每个<code>component</code>的入口，并放入<code>input</code>数组，再开启<code>preserveModules</code>模式。</p><p><code>rollup.esm.js</code>具体配置</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 同之前</span>
<span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-styles&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> extensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;.ts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.tsx&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.jsx&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isProd <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> entryFile <span class="token operator">=</span> <span class="token string">&#39;src/index.ts&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 可以时在多一级也可以，&#39;src/components&#39;</span>
<span class="token keyword">const</span> componentDir <span class="token operator">=</span> <span class="token string">&#39;src&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> componentEntryFiles <span class="token operator">=</span> fs
  <span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>componentDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">withFileTypes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dirent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> dirent<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[A-Z]\w*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>dirent<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dirent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>componentDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dirent<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.ts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">[</span>entryFile<span class="token punctuation">,</span> <span class="token operator">...</span>componentEntryFiles<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">&#39;esm&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;esm&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">preserveModules</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">preserveModulesRoot</span><span class="token operator">:</span> <span class="token string">&#39;src&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token string">&#39;named&#39;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">assetFileNames</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// console.log(name);</span>
          <span class="token comment">// 抽离后的样式文件会作为 asset 输出，这里可以配置一下 样式文件的输出位置（为 babel-plugin-import 做准备）</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> ext<span class="token punctuation">,</span> dir<span class="token punctuation">,</span> base <span class="token punctuation">}</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// console.log(ext);</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>ext <span class="token operator">!==</span> <span class="token string">&#39;.css&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&#39;[name].[ext]&#39;</span><span class="token punctuation">;</span>
          <span class="token comment">// 输出到style目录，便于tree-shaking</span>
          <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">&#39;style&#39;</span><span class="token punctuation">,</span> base<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 其他插件一样</span>
      <span class="token function">styled</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 抽出css，而不是打包进js</span>
        <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;extract&#39;</span><span class="token punctuation">,</span>
        <span class="token comment">// use: [&#39;less&#39;],</span>
        <span class="token comment">// less: {</span>
        <span class="token comment">//   javascriptEnabled: true,</span>
        <span class="token comment">// },</span>
        <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;.less&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.css&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// CSS Modules</span>
        <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">inline</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">onExtract</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 以下操作用来确保每个组件目录只输出一个 index.css，实际上每一个子级组件都会输出样式文件，index.css 会包含所有子组件的样式</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> css<span class="token punctuation">,</span> name<span class="token punctuation">,</span> map <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> base <span class="token punctuation">}</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>base <span class="token operator">!==</span> <span class="token string">&#39;index.css&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><blockquote><p><code>rollup-plugin-styles</code>文档不全，目前发现使用<code>css module</code>的模式下，代码并没有抽离，目前还是使用的常规class。</p></blockquote><p>另外还需要修改<code>package.json</code>才能使输出生效</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dist&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;esm&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.cjs.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esm/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.d.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;.&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./esm/index.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.cjs.js&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;esm/**/style/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;lib/**/style/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;*.css&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>再搭配<a href="https://www.npmjs.com/package/babel-plugin-import" target="_blank" rel="noopener noreferrer">babel-plugin-import<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>即可，可以看到整个实现真的麻烦，所以还是选择<code>css-in-js</code>把，也有支持零运行的框架，比如<a href="https://vanilla-extract.style/" target="_blank" rel="noopener noreferrer">Vanilla-extract<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><h3 id="如何调试" tabindex="-1"><a class="header-anchor" href="#如何调试" aria-hidden="true">#</a> 如何调试</h3><ol><li>monorepo架构下的项目，比如<code>pnpm+workspace</code>，直接安装即可</li></ol><p>比如在本地把<code>pkg1</code>安装到 <code>pkg2</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">install</span> @sysuke/pkg1 --filter @sysuke/pkg2
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li><code>pnpm/yarn link</code>， 不好用，会出现<a href="https://reactjs.org/warnings/invalid-hook-call-warning.html" target="_blank" rel="noopener noreferrer">Invalid Hook Call Warning<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>的错误</li><li>webpack alias</li></ol><p><code>webpack.config.js</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>webpack: <span class="token punctuation">{</span>
  resolve: <span class="token punctuation">{</span>
    alias: <span class="token punctuation">{</span>
      <span class="token string">&#39;react&#39;</span><span class="token builtin class-name">:</span> path.resolve<span class="token punctuation">(</span>__dirname, <span class="token string">&#39;node_modules/react&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="4"><li><a href="https://www.npmjs.com/package/yalc" target="_blank" rel="noopener noreferrer">yalc<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol><p>可参考文章<a href="https://mp.weixin.qq.com/s/I4hhrgI3-Y18HD8zw_9g9w" target="_blank" rel="noopener noreferrer">居然有比 npm link 更好的调试？<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>使用rollup打包一个可用的react组件库基本实现，源代码见<a href="https://github.com/qinsong77/sysuke/tree/rollup-react-component-library-save-version/demos/rollup-react-component-library" target="_blank" rel="noopener noreferrer">rollup-react-component-library<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，其实一些常见的组件库，如<code>mui</code>，<code>ant-design</code>, <a href="https://github.com/tusen-ai/naive-ui" target="_blank" rel="noopener noreferrer">naive-ui<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>等，在打包成es module，按模块 打包输出时，都是用的其他方式，比如babel，tsc等，后面会补一篇文章去解析其他开源的组件库是如何打包的。</p><h2 id="踩坑记录" tabindex="-1"><a class="header-anchor" href="#踩坑记录" aria-hidden="true">#</a> 踩坑记录</h2><h4 id="rollup插件是数组-有的插件使用是有顺序的" tabindex="-1"><a class="header-anchor" href="#rollup插件是数组-有的插件使用是有顺序的" aria-hidden="true">#</a> rollup插件是数组，有的插件使用是有顺序的</h4><p>比如 <code>@rollup/plugin-babel</code>就要求 <code>@rollup/plugin-commonjs</code>必须在前面，所以要好好看插件文档再使用。</p><h4 id="rollup-plugin-dts输出单个文件的类型文件-不适合组件库这种类型输出很多的library-不如使用tsc-还能按目录输出-无其他依赖配置也简单" tabindex="-1"><a class="header-anchor" href="#rollup-plugin-dts输出单个文件的类型文件-不适合组件库这种类型输出很多的library-不如使用tsc-还能按目录输出-无其他依赖配置也简单" aria-hidden="true">#</a> <code>rollup-plugin-dts</code>输出单个文件的类型文件，不适合组件库这种类型输出很多的library，不如使用<code>tsc</code>，还能按目录输出，无其他依赖配置也简单</h4><h5 id="tsc-build-构建输出的类型文件-并不会处理-d-ts文件" tabindex="-1"><a class="header-anchor" href="#tsc-build-构建输出的类型文件-并不会处理-d-ts文件" aria-hidden="true">#</a> <code>tsc --build ...</code>构建输出的类型文件，并不会处理<code>.d.ts</code>文件</h5><p>即如果 <code>src</code> 的类型文件是<code>.d.ts</code>结尾的，编译构建时<code>tsc</code>不会处理，导致文件不会复制到<code>outDir</code>。解决方式主要有 2 种</p><ul><li><code>.d.ts</code>重命名为<code>.ts</code>, 正确的方式，类型文件不该<code>.d.ts</code>，一般全局的才用这个。</li><li>构建阶段单独处理，复制文件到输出目录，这里使用的<a href="https://www.npmjs.com/package/copyfiles" target="_blank" rel="noopener noreferrer">copyfiles<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;copy-d.ts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;copyfiles -u 1 src/**/*.d.ts dist&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>其实类型文件不应该以<code>.d.ts</code>声明，除了能限制在<code>.d.ts</code>中不写非类型的代码，其他的基本上都是不好的地方，比如<code>.d.ts</code>是全局共享的，不需要<code>export</code> 和<code>import</code>就能使用。</p><p>TypeScript与ECMAScript 2015一样，任何包含<strong>顶级import或者export</strong>的文件都被当成一个模块。相反地，如果一个文件不带有顶级的import或者export声明，那么它的内容被视为<strong>全局可见</strong>的（因此对模块也是可见的）（全局就是以<code>tsconfig.json</code>文件为根目录的所有文件都能访问到） 所以在<code>.d.ts</code>如果使用了<code>export</code>和<code>import</code>就失去了global type的属性。</p><h4 id="用-tsc-编译的后-映射的路径-即配置的path-不会处理-将导致编译后的代码找不到模块。" tabindex="-1"><a class="header-anchor" href="#用-tsc-编译的后-映射的路径-即配置的path-不会处理-将导致编译后的代码找不到模块。" aria-hidden="true">#</a> 用 <code>tsc</code> 编译的后，映射的路径（即配置的<a href="https://www.typescriptlang.org/tsconfig#paths" target="_blank" rel="noopener noreferrer">path<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ）不会处理，将导致编译后的代码找不到模块。</h4><p>TypeScript 编译时并不会重写 <code>module paths</code>， <code>path</code>是设计用来让 typescript 理解其他 bundle 工具的路径别名，比如 webpack 的 <code>resolve alias</code>，项目中我选的以下方案的 <code>tsc-alias</code>，只需配置到script，本demo暂未用到。</p><ul><li><a href="https://dev.to/larswaechter/path-aliases-with-typescript-in-nodejs-4353" target="_blank" rel="noopener noreferrer">Path aliases with TypeScript in Node.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.npmjs.com/package/tsc-alias" target="_blank" rel="noopener noreferrer">tsc-alias<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.npmjs.com/package/module-alias" target="_blank" rel="noopener noreferrer">module-alias<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h4 id="不止是peerdependencies要external-dependencies的依赖也需要。" tabindex="-1"><a class="header-anchor" href="#不止是peerdependencies要external-dependencies的依赖也需要。" aria-hidden="true">#</a> 不止是<code>peerDependencies</code>要<code>external</code>,<code>dependencies</code>的依赖也需要。</h4><p>在最开始使用<code>rollup</code>打包时，只把<code>peerDependencies</code>设置到external了，发现打包体积比较大，且在使用<code>output.preserveModules</code>时有问题，打包的结果还会多个 <code>node_modules</code>目录，当时完全找不到头绪，后来看了一些组件库源码，比如 <code>ant-design</code>:</p><p><img src="/assets/antd.25bed5a5.png" alt=""> 其实<code>dependencies</code>也要<code>external</code>掉（当然不是amd格式时），使用时这些依赖也会安装。</p><h4 id="如果在已经使用了babel-babel-preset-typescript时-rollup-plugin-typescript2插件不需要-转换-ts-同样的事没必要做-2-次。" tabindex="-1"><a class="header-anchor" href="#如果在已经使用了babel-babel-preset-typescript时-rollup-plugin-typescript2插件不需要-转换-ts-同样的事没必要做-2-次。" aria-hidden="true">#</a> 如果在已经使用了<code>babel + @babel/preset-typescript</code>时, <code>rollup-plugin-typescript2</code>插件不需要，转换 ts 同样的事没必要做 2 次。</h4><h4 id="babel-runtime" tabindex="-1"><a class="header-anchor" href="#babel-runtime" aria-hidden="true">#</a> <code>@babel/runtime</code></h4><ul><li>应该作为<code>dependency</code>，并且当作<code>external</code></li><li>配置到<code>external</code>, <code>external: [&quot;@babel/runtime&quot;]</code> 这样配置是不工作的，得<code>external: [/@babel\/runtime/]</code>或者一个函数<code>(external: id =&gt; id.includes(&#39;@babel/runtime&#39;)</code>,<code>@emotion/react</code>也是</li><li><a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime" target="_blank" rel="noopener noreferrer">@babel/plugin-transform-runtime<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 的<a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime#useesmodules" target="_blank" rel="noopener noreferrer">useESModules<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>自<code>7.13.0</code>就遗弃了，不用去考虑 打包时<code>esm</code>和<code>cjs</code>这块有影响，去区分对待</li></ul><p>文档其实这块写得很清楚<a href="https://github.com/rollup/plugins/tree/master/packages/babel#babelhelpers" target="_blank" rel="noopener noreferrer">@rollup/plugin-babel.babelHelpers.runtime<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="sideeffects" tabindex="-1"><a class="header-anchor" href="#sideeffects" aria-hidden="true">#</a> sideEffects</h4><p><code>package.json</code> 中声明 <code>sideEffects</code> 属性</p><blockquote><p>在一个纯粹的 ESM 模块世界中，识别出哪些文件有副作用很简单。然而，我们的项目无法达到这种纯度，所以，此时有必要向 webpack 的 compiler 提供提示哪些代码是“纯粹部分”。 —— 《webpack 文档》</p></blockquote><p>注意：样式部分是有副作用的！即不应该被 tree-shaking！</p><p>若是直接声明 <code>sideEffects</code> 为 <code>false</code>，那么打包时将不包括样式！所以应该像下面这样配置：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.sass&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.scss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.css&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="rollup-plugin-multi-entry不好用-自己写脚本处理多入口吧" tabindex="-1"><a class="header-anchor" href="#rollup-plugin-multi-entry不好用-自己写脚本处理多入口吧" aria-hidden="true">#</a> <a href="https://github.com/rollup/plugins/tree/master/packages/multi-entry" target="_blank" rel="noopener noreferrer">@rollup/plugin-multi-entry<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>不好用，自己写脚本处理多入口吧</h4><p>简单试了下，会有些额外的输出，比如这个<code>_virtual</code>文件夹。 <img src="/assets/plugin-multi-entry.3c8fd607.png" alt=""></p><ul><li><code>entryFileName</code>不支持函数</li><li><code>index.ts</code> 输出到一个<code>_virtual</code>文件夹，不知道怎么出现的, 可能用这个插件<a href="https://www.npmjs.com/package/@rollup/plugin-virtual" target="_blank" rel="noopener noreferrer">@rollup/plugin-virtual<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>解决</li><li>只输出了 <code>entry index</code> ，component 目录没有按原始目录输出文件</li></ul><h4 id="output-preservemodules也不太好用" tabindex="-1"><a class="header-anchor" href="#output-preservemodules也不太好用" aria-hidden="true">#</a> <a href="https://rollupjs.org/guide/en/#outputpreservemodules" target="_blank" rel="noopener noreferrer">output.preserveModules<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>也不太好用</h4><p>虽然用这个配置成功按模块输出，但有的情况下有问题，比如上面也提到过，<code>dependencies</code>不排除（external）时，会多输出文件夹，比如<code>node_modules</code></p><ul><li><a href="https://github.com/rollup/rollup/issues/3743" target="_blank" rel="noopener noreferrer">preserveModules creates wrong output<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/rollup/rollup/issues/3684" target="_blank" rel="noopener noreferrer">Why does the preserveModules option generate node_modules folder<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h4 id="当把dependencies打包入output时-比如会发现react同时打入了react-development-js和react-production-js" tabindex="-1"><a class="header-anchor" href="#当把dependencies打包入output时-比如会发现react同时打入了react-development-js和react-production-js" aria-hidden="true">#</a> 当把dependencies打包入output时，比如会发现react同时打入了<code>react.development.js</code>和<code>react.production.js</code></h4><p>使用<code>@rollup/plugin-replace</code>解决，参考react官网，<a href="https://reactjs.org/docs/optimizing-performance.html#rollup" target="_blank" rel="noopener noreferrer">Optimizing Performance<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="reference" tabindex="-1"><a class="header-anchor" href="#reference" aria-hidden="true">#</a> Reference</h2><ul><li><a href="https://rollupjs.org/guide/en/" target="_blank" rel="noopener noreferrer">rollup<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://juejin.cn/post/7126394898445500423" target="_blank" rel="noopener noreferrer">从 package.json 来聊聊如何管理一款优秀的 Npm 包<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://mp.weixin.qq.com/s/Rk729v6VI0IbwVPsuaPdOw" target="_blank" rel="noopener noreferrer">rollup 从入门到打包一个按需加载的组件库<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://stackoverflow.com/questions/56018167/typescript-does-not-copy-d-ts-files-to-build" target="_blank" rel="noopener noreferrer">Typescript does not copy d.ts files to build<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://medium.com/@PepsRyuu/why-i-use-rollup-and-not-webpack-e3ab163f4fd3" target="_blank" rel="noopener noreferrer">Why I use Rollup, and not Webpack<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.codefeetime.com/post/rollup-config-for-react-component-library-with-typescript-scss/" target="_blank" rel="noopener noreferrer">Rollup Config for React Component Library With TypeScript + SCSS<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://dev.to/alexeagleson/how-to-create-and-publish-a-react-component-library-2oe" target="_blank" rel="noopener noreferrer">How to Create and Publish a React Component Library<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/mjzhang1993/article/details/112575745" target="_blank" rel="noopener noreferrer">Rollup2.x 搭建 React 组件库<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://medium.com/singapore-gds/how-to-support-subpath-imports-using-react-rollup-typescript-1d3d331f821b" target="_blank" rel="noopener noreferrer">How to support subpath imports using React+Rollup+Typescript<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: xyqinsong@163.com">notend</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><a class="svg-icon-middle toggle-nav-button" title="toggle nav" aria-expanded="false" role="button" tabindex="0"><svg class="svg-icon" aria-hidden="true"><use xlink:href="#icon-menu"></use></svg><!----></a><div class="my-footer">Life is hard, but still have to move on</div><!--]--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.a96f585b.js" defer></script>
  </body>
</html>
